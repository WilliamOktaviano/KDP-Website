function Dashboard(e){function a(){}function n(){var e=$("#dashboard"),a=e.find(".dashboard-settings");a.find("[name^=chkWidget-]").val(0).change(),e.find(".dashboard-stage").each(function(){var e=$(this).attr("relkey");a.find("[name=chkWidget-"+e+"]").val(1).change()})}function t(a){$("#dashboard");a=a?a:!1;var n,t,o;if(a){$("#widgets-panel").html("");for(var r=!0,l=0;l<e.length;l++)n="width:"+(e[l].width?e[l].width:"100%")+";",t="height:"+(e[l].height?e[l].height:"250px")+";",o=e[l].additionalClass?e[l].additionalClass:"",additionalStyle=e[l].additionalStyle?e[l].additionalStyle:"",r&&"auto"!=e[l].height&&(r=!r,$("#widgets-panel").append('<div style="clear:both"></div>')),$("#widgets-panel").append('<div class="dashboard-stage" style="'+n+t+'" relkey="'+e[l].pkey+'"><div class="dashboard-panel '+e[l].panel+" "+o+' " style="'+additionalStyle+'"></div></div>')}i(e)}function i(e){for(var a=$("#dashboard"),n=[],t=0;t<e.length;t++){var i=e[t];a.find("."+i.panel).html(_LOADING_ICON_);var o={};o.action=i.panel,o.startPeriod=$("#dashboard [name=trStartPeriod]").val(),o.endPeriod=$("#dashboard [name=trEndPeriod]").val(),n.push(o)}$.ajax({type:"POST",url:"getDashboardData.php",data:{data:n},success:function(a){if(a){for(var n=JSON.parse(a),t=0;t<e.length;t++){var i=e[t],o=n[i.panel];r(o,i)}columnConform(".auto-height")}}})}function o(){var a=$("#dashboard"),n=a.find("[name=form-widget-setting]"),i=n.serialize();$.ajax({type:"POST",url:"ajax-widget-setting.php",data:i+"&action=updateSettings"}).done(function(n){a.find(".dashboard-settings").hide(),e=JSON.parse(n),t(!0)})}function r(e,a){var n=$("#dashboard"),t=n.find("."+a.panel);return e?(t.html(e),void n.find("."+a.panel).find(".remove-widget").bind("click",function(){var e=$(this).closest(".dashboard-stage");$.ajax({type:"POST",url:"ajax-widget-setting.php",data:"action=removeWidget&widgetkey="+e.attr("relkey"),success:function(){e.remove()}})})):void t.html('<div class="text-muted" style="text-align:center; padding: 0.5em" >'+a.title+"</div>")}this.loadOnReady=function(){var e=$("#dashboard");e.find(".refresh-graph").click(function(){t()}),e.find(".input-month").datepicker({dateFormat:"MM yy",changeMonth:!0,changeYear:!0,showButtonPanel:!0,onClose:function(){function e(){return $("#ui-datepicker-div").html().indexOf("ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all ui-state-hover")>-1}if(e()){var a=$("#ui-datepicker-div .ui-datepicker-month :selected").val(),n=$("#ui-datepicker-div .ui-datepicker-year :selected").val();$(this).datepicker("setDate",new Date(n,a,1)).trigger("change"),$(".input-month").focusout()}},beforeShow:function(e,a){if(a.dpDiv.addClass("month-year-datepicker"),(datestr=$(this).val()).length>0){var n=new Date(datestr);year=n.getFullYear(),month=n.getMonth(),$(this).datepicker("option","defaultDate",new Date(year,month,1)),$(this).datepicker("setDate",new Date(year,month,1))}}}),e.find(".input-month").change(function(){var e;$(this).closest(".mnv-date-range").find(".input-month").each(function(){if(e){var a=Date.parse(convertDateToStandartFormat(e.val())),n=Date.parse(convertDateToStandartFormat($(this).val()));a>n&&$(this).val(e.val())}e=$(this)})}),e.find(".btn-dashboard-settings").bind("click",function(){e.find(".dashboard-settings").show(),n()}),e.find(".btn-close-overlay").bind("click",function(){e.find(".dashboard-settings").fadeOut(300)}),e.find("[name='btnSaveDashboardSettings']").bind("click",function(){o()}),e.find("[name='chkAllWidget']").bind("change",function(){var a=e.find(".dashboard-settings");a.find("[name^=chkWidget-]").val($(this).val()).change()}),e.find("[name^=chkWidget-]").bind("change",function(){var a=e.find(".dashboard-settings"),n=!0;a.find("[name^=chkWidget-]").each(function(){return 0==$(this).val()?void(n=!1):void 0}),a.find("[name=dummychkAllWidget]").prop("checked",n),a.find("[name=chkAllWidget]").val(n?1:0)}),t(!0),$("#widgets-panel").sortable({handle:".title",stop:function(){a()}})}}function CarServiceMaintenance(e,a,n,t){var o=this,r=$("#"+e);this.tabID=e,this.tablekey=a,this.conversion={};var l=new Array;l.push({object:"hidItemKey[]",value:"pkey"}),l.push({object:"hidItemType[]",value:"itemtype"}),l.push({object:"priceInUnit[]",value:"cogs"}),l.push({object:"hidCOGS[]",value:"cogs"}),l.push({object:"isPackage[]",value:"ispackage"}),l.push({object:"selUnit[]",value:"deftransunitkey"});var d=l;this.updateDetail=function(e,a,t){var l=$(e).closest(".transaction-detail-row"),d=l.find('[name="hidItemKey[]"]').first(),c=l.find('[name="selUnit[]"]').first(),s=r.find(" [name=chkIsOutsource]").val();for(i=0;i<a.length;i++)l.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).blur();l.find('[name="itemName[]"]').first().val(t.item.value),updateAvailableUnit(d,c),(1==s||t.item.itemtype==n.SERVICE)&&l.find('[name="priceInUnit[]"]').first().val(0),l.find('[name="priceInUnit[]"]').change(),o.updateReadonlyDetailRow(l),o.updateConversionVariable(l)},this.updateConversionVariable=function(e){var a=e.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",async:!1,url:"ajax-item.php",data:"action=getAvailableConversion&itemkey="+a}).done(function(e){for(e=JSON.parse(e),o.conversion[a]={},i=0;i<e.length;i++)o.conversion[a][e[i].conversionunitkey]=e[i].conversionmultiplier})},this.updateReadonlyDetailRow=function(e){var a=r.find(" [name=chkIsOutsource]").val(),t=r.find("[name='supplierName']"),i=r.find("[name='hidSupplierKey']"),o=e.find("[name='hidItemType[]']").val(),l=e.find("[name='priceInUnit[]']");1==a?setReadonly(l,!1):(t.val(""),i.val(""),o==n.SERVICE?setReadonly(l,!1):setReadonly(l,!0))},this.updateCarInformation=function(){r.find("[name=policeNumber]").val(""),r.find("[name=year]").val(""),r.find("[name=carSeriesName]").val(""),r.find("[name=fuelType]").val("");var e=r.find("[name=hidCarKey]").val();e&&$.ajax({type:"GET",url:"ajax-car.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),0!=e.length&&(e=e[0],r.find("[name=policeNumber]").val(e.policenumber),r.find("[name=year]").val(e.year),r.find("[name=carSeriesName]").val(e.seriesname),r.find("[name=fuelType]").val(e.fueltype))})},this.calculateDetail=function(e){var a=e?$(e).closest(".transaction-detail-row"):r.find(".item-row .transaction-detail-row"),n=r.find("[name=chkIsOutsource]").val();a.each(function(){var e=$(this),a=e.find("[name='selUnit[]']").val(),t=e.find("[name='hidItemKey[]']").val();if(void 0!=t){var i=o.conversion[t]?o.conversion[t][a]:1,r=unformatCurrency(e.find("[name='hidCOGS[]']").val()),l=unformatCurrency(e.find("[name='qty[]']").val()),d=unformatCurrency(e.find("[name='discountValueInUnit[]']").val()),c=unformatCurrency(e.find("[name='selDiscountType[]']").val()),s=e.find("[name='hidItemType[]']").val(),u=0;1==n||3==s?u=unformatCurrency(e.find("[name='priceInUnit[]']").val()):(u=r*i,e.find("[name='priceInUnit[]']").val(u).blur()),0!=d&&2==c&&(d=d/100*u);var m=l*(u-d);e.find("[name='subtotal[]']").val(m).blur()}}),o.calculateTotal()},this.calculateTotal=function(){var e=0;r.find(" [name='subtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),r.find(" [name='subtotal']").val(e).blur();var a=parseFloat(unformatCurrency(r.find(" [name='finalDiscount']").val()))||0,n=parseInt(unformatCurrency(r.find(" [name='selFinalDiscountType']").val()))||0,t=parseInt(unformatCurrency(r.find(" [name='etcCost']").val()))||0,i=r.find(" [name='chkIncludeTax']").val(),o=parseFloat(unformatCurrency(r.find(" [name='taxPercentage']").val()))||0;0!=a&&2==n&&(a=a/100*e),e-=a,r.find(" [name='beforeTaxTotal']").val(e).blur();var l=0;0==i?(l=e*o/100,e+=l):(l=o/(100+o)*e,r.find(" [name='beforeTaxTotal']").val(e-l).blur()),r.find(" [name='taxValue']").val(l).blur();var d=e+t;r.find(" [name='total']").val(d).blur(),totalPayment=parseInt(unformatCurrency(r.find("[name='totalPayment']").val()));var c=totalPayment-d;r.find(" [name='balance']").val(c).blur()},this.showSupplier=function(e){1==$(e).val()?(r.find(" [name=supplierName]").prop("readonly",!1),r.find(" .external-workshop").removeClass("display-none"),r.find(" .inhouse-workshop").addClass("display-none")):(r.find(" [name=supplierName]").prop("readonly",!0),r.find(" .external-workshop").addClass("display-none"),r.find(" .inhouse-workshop").removeClass("display-none")),r.find(" [name='hidItemType[]']").each(function(){o.updateReadonlyDetailRow($(this).closest(".div-table-row"))})},this.updateDisplay=function(e){var a=e.val();r.find(".vehicle-type").hide(),r.find(".type-"+a).show()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",d,"ajax-item.php?action=searchData&itemtype=1,3","getTabObj().updateDetail"),bindEl(r.find("[name='qty[]'], [name='priceInUnit[]'], [name='discountValueInUnit[]'],  [name='selUnit[]']"),"change",function(){o.calculateDetail(this)}),bindEl(r.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),o.calculateDetail(this)})},this.onChangePaymentMethodHandler=function(){o.calculateTotal()},this.afterRemoveRowHandler=function(){o.calculateTotal()},this.loadOnReady=function(){r.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<t.length;i++)if($(this).val()==t[i])return r.find("[name='paymentMethodValue[]']").each(function(){$(this).closest(".transaction-detail-row").find(".remove-button").click()}),void r.find(".cashTOP").hide();r.find(".cashTOP").show()}),r.find("[name=selTermOfPaymentKey]").change(),r.find(".form-detail-field").toggle(),r.find(".form-detail-button").click(function(){r.find(".form-detail-field").toggle("highlight");var e=r.find(".form-detail-button").attr("relalt");r.find(".form-detail-button").attr("relalt",r.find(".form-detail-button").text()),r.find(".form-detail-button").text(e)}),r.find("[name=chkIsOutsource]").change(function(){o.showSupplier(this),o.calculateDetail()}),r.find("[name=selFinalDiscountType], [name=finalDiscount], [name=beforeTaxTotal], [name=chkIncludeTax], [name=etcCost], [name=taxPercentage]").change(function(){o.calculateTotal(this)}),r.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),r.find("[name=selType]").change(function(){o.updateDisplay($(this))}),o.rebindEl()}}function Container(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function EMKLJobOrder(e,a,n){var t=this,o=$("#"+e);this.tabID=e;var r=new Array;r.push({object:"hidCustomerDetailKey[]",value:"pkey"});var l=r,r=new Array;r.push({object:"hidCommissionRecipientKey[]",value:"pkey"});var d=r,r=new Array;r.push({object:"hidDestinationDetailKey[]",value:"pkey"});var c=r,r=new Array;r.push({object:"hidWarehouseDetailKey[]",value:"pkey"});var s=r,r=new Array;r.push({object:"hidContainerDetailKey[]",value:"pkey"});var u=r,r=new Array;r.push({object:"hidServiceKey[]",value:"pkey"});var m=r,r=new Array;r.push({object:"hidSalesDetailKey[]",value:"pkey"});var f=r,r=new Array;r.push({object:"hidChargeToDetailKey[]",value:"pkey"});var h=r;this.updateCommissionDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),o=t.find('[name="selCommissionRecipientType[]"]').first();for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();o.val(n.item.suppliertype),updateComboboxReadonly(o),t.find('[name="commissionRecipientDetailName[]"]').first().val(n.item.value)},this.updateAirOrSea=function(){var e=o.find("[name=selAirSea]"),a=o.find("[name=selContainerType]"),t=o.find("[name=selVolumeType]");t.val(e.val()==n.EMKL.shipping.sea?n.EMKL.volume.cbm:n.EMKL.volume.kg),a.change(),t.change()},this.updateJobType=function(){var e=o.find("[name=selContainerType]"),a=o.find("[name=selAirSea]"),i=o.find(".fcl-only"),r=o.find(".lcl-only"),l=(o.find(".customer-row").not(".row-template"),e.val());l==n.EMKL.container.lcl?(r.show(),i.hide(),o.find(".truckingfcl").hide(),o.find(".lcl").show(),$(".fcl-readonly").attr("readonly",!1)):l==n.EMKL.container.fcl||l==n.EMKL.container.trucking?(r.hide(),i.show(),$(".fcl-readonly").attr("readonly",!0),o.find("[name=chkIsMaster]").val(0),o.find(".truckingfcl").show(),o.find(".lcl").hide(),a.val()==n.EMKL.shipping.sea?o.find(".sea-only").show():o.find(".sea-only").hide()):(r.hide(),i.show(),$(".fcl-readonly").attr("readonly",!0),o.find("[name=chkIsMaster]").val(0),o.find(".truckingfcl").hide(),o.find(".lcl").hide(),a.val()==n.EMKL.shipping.sea?o.find(".sea-only").show():o.find(".sea-only").hide()),t.updateJobTypeLabel(),o.find("[name=chkIsMaster]").change()},this.updateJobTypeLabel=function(){var e=o.find("[name=selContainerType] option:selected").html(),a=o.find("[name=selAirSea] option:selected").html();o.find(".label-container-type").html(e),o.find(".label-air-sea").html(a)},this.updateFieldfForLCLDetail=function(){var e=o.find("[name=selStatus]").val();if(!(e>2)){var a=!1,t=o.find("[name=selContainerType]").val(),i=o.find("[name=chkIsMaster]").val(),r=o.find(".header-panel");t==n.EMKL.container.lcl&&0==i?(a=!0,r.find(".auto-complete .add-button").hide(),r.find(".input-date, [name=selAirSea],[name=selWarehouseKey]").not('[attr-header="true"]').addClass("force-readonly")):(r.find(".auto-complete .add-button").show(),r.find(".input-date, [name=selAirSea],[name=selWarehouseKey]").not('[attr-header="true"]').removeClass("force-readonly")),r.find("input").not('[name=jobOrderCode], [name=salesName],[name=code],[name=podName],[attr-header="true"]').prop("readonly",a),r.find(".input-date").prop("disabled",a),r.find("[name=containerNumber]").prop("disabled",a),r.find("[name=selAirSea],[name=selWarehouseKey]").not('[attr-header="true"]').attr("disabled",a)}},this.updateMasterDetailField=function(e){1==e.val()?(o.find(".doc-detail-only").hide(),o.find("[name=jobOrderCode]").prop("readonly",!0),o.find("[name=hidJobOrderKey]").val(0),o.find("[name=jobOrderCode]").val("")):(o.find(".doc-detail-only").show(),o.find("[name=jobOrderCode]").prop("readonly",!1)),t.updateFieldfForLCLDetail()},this.updateFromJobOrder=function(e){var a=o.find("[name=hidJobOrderKey]").val();$.ajax({type:"GET",url:"ajax-emkl-job-order.php",async:!1,data:"action=getDataRowById&jobtype="+e+"&pkey="+a}).done(function(e){if(e){if(e=JSON.parse(e),0==e.length)return void alert(phpErrorMsg[213]);e=e[0],o.find("[name=selWarehouseKey]").val(e.warehousekey),o.find("[name=trDate]").val(moment(e.trdate).format(_DATE_FORMAT_)),o.find("[name=poNumber]").val(e.ponumber),o.find("[name=bookingNumber]").val(e.bookingnumber),o.find("[name=selAirSea]").val(e.transportationtypekey),o.find("[name=selContainerType]").val(e.loadcontainertypekey).change(),o.find("[name=containerName]").val(decodeHTMLEntities(e.containername)),o.find("[name=selVolumeType]").val(e.volumetype),o.find("[name=trDesc]").val(e.trdesc),o.find("[name=mblNumber]").val(e.mblnumber),o.find("[name=polName]").val(e.polname),o.find("[name=hidPOLKey]").val(e.polkey),o.find("[name=podName]").val(e.podname),o.find("[name=hidPODKey]").val(e.podkey),o.find("[name=etdPol]").val(moment(e.etdpol).format(_DATE_FORMAT_)),o.find("[name=etaPod]").val(moment(e.etapod).format(_DATE_FORMAT_)),o.find("[name=carrierName]").val(e.carriername),o.find("[name=hidCarrierKey]").val(e.carrierkey),o.find("[name=vesselNumber]").val(e.vesselnumber),o.find("[name=vesselName]").val(e.vesselname),o.find("[name=hidVesselKey]").val(e.vesselkey),o.find("[name=depotName]").val(e.depotname),o.find("[name=hidDepotKey]").val(e.depotkey),o.find("[name=containerNumber]").val(e.containernumber),o.find("[name=agentName]").val(e.agentname),o.find("[name=hidAgentKey]").val(e.agentkey),o.find("[name=shipperName]").val(e.customername),o.find("[name=hidShipperKey]").val(e.shipperkey),o.find("[name=salesName]").val(e.salesname),o.find("[name=hidSalesKey]").val(e.employeekey),o.find("[name=hidCargoType]").val(e.containertypekey),o.find("select[readonly]").find("option:selected").attr("disabled",!1),o.find("select[readonly]").find("option:not(:selected)").attr("disabled",!0)}})},this.updateVolumeType=function(){o.find(".volume-type").html(o.find("[name=selVolumeType]").find("option:selected").text())},this.updateCustomerInformation=function(){var e=o.find("[name=selContainerType]");e.val()==n.EMKL.container.fcl&&t.updateDetailName(o.find(".customer-row").first())},this.updateDetailName=function(e){e.find("[name='customerDetailName[]']").val(o.find("[name=customerName]").val()),e.find("[name='hidCustomerDetailKey[]']").val(o.find("[name=hidCustomerKey]").val())},this.afterAddNewTemplateRowHandler=function(e){prevRow=e.prev();var a=prevRow.find("[name='containerDetailName[]']").val(),n=prevRow.find("[name='hidContainerDetailKey[]']").val(),t=prevRow.find("[name='selCurrencyDetail[]']").val();e.find("[name='containerDetailName[]']").val(a),e.find("[name='hidContainerDetailKey[]']").val(n),e.find("[name='selCurrencyDetail[]']").val(t)},this.getGroupObj=function(e){return e.closest(".customer-row")},this.getRowObj=function(e){return e.closest(".div-table-row")},this.calculateDetailGroupSubtotal=function(e){{var a=0,n=0,i=0,o=!1,r=e.find("[name='selSellingCurrency[]']").val();e.find("[name='sellingCurrencyRate[]']").val()}e.find(".detail-item .transaction-detail-row").each(function(){var e=parseFloat(unformatCurrency($(this).find("[name='detailRowCurrencySubtotal[]']").val())),t=$(this).find("[name='selCurrencyDetail[]']").val();t!=r?(o=!0,n+=e):a+=e;var l=parseFloat(unformatCurrency($(this).find("[name='detailRowSubtotal[]']").val()));i+=l}),e.find("[name='detailCurrencyTotal[]']").val(a).blur(),e.find("[name='detailOtherCurrencyTotal[]']").val(n).blur(),e.find("[name='detailTotal[]']").val(i).blur(),o?e.find(".idr-only").show():e.find(".idr-only").hide(),t.calculateTotal()},this.calculateTotal=function(){var e=0,a=0;o.find("[name='detailTotal[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0});var n=e;o.find("[name='totalSelling']").val(n).blur();var t=o.find("[name='totalBuying']").val(),i=o.find("[name='totalCommission']").val();a=n-t-i,o.find("[name='grandtotal']").val(a).blur()},this.updateAvailableCurency=function(e){e||(e=o.find(".customer-row")),e.each(function(){var e=$(this).find("[name='selCurrencyDetail[]']"),a=$(this).find("[name='selSellingCurrency[]']");a.val()==n.CURRENCY.idr?e.find("option:not(:selected)").attr("disabled",!0):e.find("option").attr("disabled",!1)})},this.onChangeCurrency=function(e){var a=t.getGroupObj(e),i=a.find("[name='sellingCurrencyRate[]']"),o=a.find("[name='selCurrencyDetail[]']");o.val(e.val());var r=!1;e.val()==n.CURRENCY.idr&&(r=!0,i.val(1)),i.prop("readonly",r),a.find(".subheader-active-currency").html(e.find("option:selected").text()),t.updateAvailableCurency(a),i.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){i.val(1)},success:function(e){if(e){var e=JSON.parse(e);i.val(e[0].rate).blur(),t.onChangeCurrencyRate(i)}}})},this.onChangeCurrencyRate=function(e){var a=t.getGroupObj(e);a.find("[name='detailRowSubtotal[]']").each(function(){t.calculateDetailRowSubtotal(t.getRowObj($(this)))})},this.calculateDetailRowSubtotal=function(e){var a=parseFloat(unformatCurrency(t.getGroupObj(e).find("[name='sellingCurrencyRate[]']").val()))||0,i=(e.find("[name='currencyDetail[]']").val(),parseFloat(unformatCurrency(e.find("[name='qty[]']").val()))||0),o=parseFloat(unformatCurrency(e.find("[name='priceInUnit[]']").val()))||0,r=i*o;e.find("[name='detailRowCurrencySubtotal[]']").val(r).blur();var l=e.find("[name='selCurrencyDetail[]']");l.val()!=n.CURRENCY.idr&&(r*=a),e.find("[name='detailRowSubtotal[]']").val(r).change().blur(),e.find(".active-currency").html(l.find("option:selected").text())},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("customerDetailName[]",l,"ajax-customer.php?action=searchData"),bindAutoCompleteForTransactionDetail("commissionRecipientDetailName[]",d,"ajax-supplier.php?action=searchData&suppliertype=1",t.updateCommissionDetail),bindAutoCompleteForTransactionDetail("destinationDetailName[]",c,"ajax-port.php?action=searchData"),bindAutoCompleteForTransactionDetail("warehouseDetailName[]",s,"ajax-depot.php?action=searchData"),bindAutoCompleteForTransactionDetail("containerDetailName[]",u,"ajax-container.php?action=searchData"),bindAutoCompleteForTransactionDetail("serviceName[]",m,"ajax-item.php?action=searchData&itemtype=3"),bindAutoCompleteForTransactionDetail("salesDetailName[]",f,"ajax-employee.php?action=searchData&issales=1"),bindAutoCompleteForTransactionDetail("chargeToName[]",h,"ajax-customer.php?action=searchData");var e=o.find("[name=btnDeleteCustomerRows]");bindEl(e,"mouseover",function(){$(this).closest(".row-panel").addClass("border-red-cardinal")}),bindEl(e,"mouseout",function(){$(this).closest(".row-panel").removeClass("border-red-cardinal")}),bindEl(o.find("[name='selSellingCurrency[]']"),"change",function(){t.onChangeCurrency($(this))}),bindEl(o.find("[name='sellingCurrencyRate[]']"),"change",function(){t.onChangeCurrencyRate($(this))}),bindEl(o.find("[name='detailRowSubtotal[]']"),"change",function(){t.calculateDetailGroupSubtotal(t.getGroupObj($(this)))}),bindEl(o.find("[name='detailTotal[]']"),"change",function(){t.calculateTotal()}),bindEl(o.find("[name='qty[]'], [name='priceInUnit[]'], [name='selCurrencyDetail[]']"),"change",function(){t.calculateDetailRowSubtotal(t.getRowObj($(this)))})},this.loadOnReady=function(){customerRows=o.find(".customer-row"),customerRows.each(function(){var e=$(this).find(".detail-commission .transaction-detail-row"),a=$(this).find(".detail-item .transaction-detail-row");0==e.length&&addNewTemplateRow("commission-row-template",null,$(this),t.rebindEl),0==a.length&&addNewTemplateRow("item-row-template",null,$(this),t.rebindEl)}),o.find("[name=selAirSea]").change(function(){t.updateAirOrSea()}),o.find("[name=selContainerType]").change(function(){t.updateJobType()}),o.find("[name=selVolumeType]").change(function(){t.updateVolumeType()}),o.find("[name=chkIsMaster]").change(function(){t.updateMasterDetailField($(this))}),t.updateAirOrSea(),o.find(" .section-panel .title").click(function(){$(this).closest(".section-panel").find(".section-panel-content").first().toggle()}),a.volumeDetail&&0!=a.volumeDetail.length||addNewTemplateRow("volume-row-template",null,null,t.rebindEl),a.containerNumberDetail&&0!=a.containerNumberDetail.length||addNewTemplateRow("container-row-template",null,null,t.rebindEl),t.updateAvailableCurency(),t.updateFieldfForLCLDetail(),o.find('[attr-header="true"]').attr("readonly",!0).addClass("force-readonly"),o.find("select[readonly]").find("option:not(:selected)").attr("disabled",!0),t.rebindEl()}}function EMKLPurchaseOrder(e,a,n,t){var o=this,r=$("#"+e);this.tabID=e,this.tablekey=a;var l=!0,d=new Array;d.push({object:"hidSupplierDetailKey[]",value:"pkey"});var d=new Array;d.push({object:"hidContainerDetailKey[]",value:"pkey"});var c=d,d=new Array;d.push({object:"hidServiceKey[]",value:"pkey"});var s=d,d=new Array;d.push({object:"hidSalesDetailKey[]",value:"pkey"});this.updateFromJobOrder=function(e){var a=r.find("[name=hidJobOrderKey]").val();$.ajax({type:"GET",url:"ajax-emkl-job-order.php",data:"action=getDataRowById&jobtype="+e+"&pkey="+a}).done(function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],r.find("[name=selTypeOfJob]").val(e.jobtypekey),r.find("[name=selAirSea]").val(e.transportationtypekey),r.find("[name=selContainerType]").val(e.loadcontainertypekey).change(),r.find("[name=volume]").val(e.volume).blur(),r.find("[name=selVolumeType]").val(e.volumetype),r.find("[name=selWarehouseKey]").val(e.warehousekey),r.find("[name=containerName]").val(decodeHTMLEntities(e.containername)),r.find("[name=bookingNumber]").val(e.bookingnumber),r.find("[name=shipperName]").val(e.customername),r.find("[name=poNumber]").val(e.ponumber),r.find("[name=mblNumber]").val(e.mblnumber),r.find("[name=containerNumber]").val(e.containernumber),r.find("[name=etdPol]").val(moment(e.etdpol).format(_DATE_FORMAT_)),r.find("[name=etaPod]").val(moment(e.etapod).format(_DATE_FORMAT_)),r.find("[name=pol]").val(e.polname),r.find("[name=pod]").val(e.podname),r.find("[name=terminal]").val(e.terminalname),r.find("[name=depot]").val(e.depotname),r.find("[name=location]").val(e.stuffinglocation),updateComboboxReadonly(r.find("[name=selTypeOfJob]")),void r.find("[name=selTypeOfJob]").change())})},this.updateFromJobHeader=function(e){var a=r.find("[name=hidJobHeaderKey]").val();$.ajax({type:"GET",url:"ajax-emkl-job-order-header.php",data:"action=getDataRowById&jobtype="+e+"&pkey="+a}).done(function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],r.find("[name=selTypeOfJob]").val(e.jobtypekey),r.find("[name=selAirSea]").val(e.transportationtypekey),r.find("[name=selContainerType]").val(e.loadcontainertypekey).change(),r.find("[name=volume]").val(e.volume).blur(),r.find("[name=selWarehouseKey]").val(e.warehousekey),r.find("[name=selVolumeType]").val(e.volumetype),r.find("[name=containerName]").val(decodeHTMLEntities(e.containername)),r.find("[name=bookingNumber]").val(e.bookingnumber),r.find("[name=shipperName]").val(e.customername),r.find("[name=poNumber]").val(e.invoicenumber),r.find("[name=mblNumber]").val(e.bookingnumber),r.find("[name=containerNumber]").val(e.containernumber),r.find("[name=etdPol]").val(moment(e.etdpol).format(_DATE_FORMAT_)),r.find("[name=etaPod]").val(moment(e.etapod).format(_DATE_FORMAT_)),r.find("[name=customerName]").val(e.customername),r.find("[name=pol]").val(e.polname),r.find("[name=pod]").val(e.podname),r.find("[name=location]").val(e.stuffing),updateComboboxReadonly(r.find("[name=selTypeOfJob]")),void r.find("[name=selTypeOfJob]").change())})},this.updateJobType=function(){var e=r.find("[name=selContainerType]"),a=r.find(".fcl-only"),n=r.find(".lcl-only"),i=(r.find(".supplier-row").not(".row-template"),e.val());i==t.EMKL.container.lcl?(n.show(),a.hide(),$(".fcl-readonly").attr("readonly",!1)):(n.hide(),a.show(),$(".fcl-readonly").attr("readonly",!0))},this.updateTransactionType=function(){var e=r.find("[name=selJOType]"),a=r.find(".isheader"),n=r.find(".isorder"),i=e.val();i==t.JOBTYPE.Order?(a.hide(),n.show()):(a.show(),n.hide())},this.updateVolumeType=function(){r.find(".volume-type").html(r.find("[name=selVolumeType]").find("option:selected").text())},this.getRowObj=function(e){return e.closest(".div-table-row")},this.onChangeCurrency=function(){var e=r.find("[name='selCurrency']"),a=r.find("[name='selCurrencyDetail[]']");a.val(e.val()),r.find(".mnv-active-currency").html(e.find("option:selected").text())},this.updateAvailableCurency=function(){var e=r.find("[name='selCurrency']"),a=r.find("[name='selCurrencyDetail[]']");e.val()==t.CURRENCY.idr?a.find("option:not(:selected)").attr("disabled",!0):a.find("option").attr("disabled",!1)},this.afterRemoveRowHandler=function(){o.calculateTotal()},this.onChangePaymentMethodHandler=function(){o.calculateTotal()},this.onChangeCurrencyRate=function(){r.find("[name='priceInUnit[]']").each(function(){o.calculateDetail(this)})},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=parseFloat(unformatCurrency(r.find("[name='currencyRate']").val()))||0,i=parseFloat(unformatCurrency(a.find("[name='qty[]']").val()))||0,l=parseFloat(unformatCurrency(a.find("[name='priceInUnit[]']").val()))||0,d=i*l;a.find("[name='detailRowCurrencySubtotal[]']").val(d).blur();var c=a.find("[name='selCurrencyDetail[]']"),s=(c.val()==t.CURRENCY.idr?!0:!1,r.find("[name=selCurrency]").val());s==t.CURRENCY.idr?c.val()!=t.CURRENCY.idr&&(d*=n):c.val()==t.CURRENCY.idr&&(d/=n),a.find("[name='detailSubtotal[]']").val(d).blur(),a.find(".mnv-active-currency-detail").html(c.find("option:selected").text()),o.calculateTotal()},this.calculateTotal=function(){var e=0;r.find("[name='detailSubtotal[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),r.find("[name='subtotal']").val(e).blur();var a=r.find("[name='chkIncludeTax']").val(),n=parseFloat(unformatCurrency(r.find("[name='taxPercentage']").val()))||0;r.find("[name='beforeTaxTotal']").val(e).blur();var t=0;0==a?(t=e*n/100,e+=t):(t=n/(100+n)*e,r.find("[name='beforeTaxTotal']").val(e-t).blur()),r.find("[name='taxValue']").val(t).blur();var i=e;r.find("[name='total']").val(i).blur();var o=parseFloat(unformatCurrency(r.find("[name='totalPayment']").val())),l=o-i;r.find("[name='balance']").val(l).blur()},this.updateSupplierInformation=function(e){r.find("[name=selTermOfPaymentKey] option[value='"+e+"']").length>0&&r.find("[name=selTermOfPaymentKey]").val(e).change()},this.updateDetailSupplierMasterPrice=function(){r.find("[name='serviceName[]']:not(:disabled)").each(function(){o.updateSupplierMasterPrice($(this))})},this.updateSupplierMasterPrice=function(e){var a=r.find("[name=hidSupplierKey]").val(),n=r.find("[name=hidLocationKey]").val(),t=$(e).closest(".transaction-detail-row"),i=t.find('[name="hidServiceKey[]"]').val(),o=t.find('[name="hidContainerDetailKey[]"]').val(),l=t.find('[name="selCurrencyDetail[]"]').val();t.find('[name="priceInUnit[]"]').val(0),$.ajax({type:"GET",url:"ajax-supplier.php",async:!1,data:"action=getSupplierPrice&pkey="+a+"&locationkey="+n+"&servicekey="+i+"&containerkey="+o+"&currencykey="+l}).done(function(e){e&&(e=JSON.parse(e),e[0]&&(e=e[0],t.find('[name="priceInUnit[]"]').val(e.price).change().blur()))})},this.updateTOP=function(){var e=r.find("[name=selTermOfPaymentKey]").val(),a=r.find("[name=hidSupplierKey]").val();$.ajax({type:"GET",url:"ajax-supplier.php",data:"action=getDataRowById&pkey="+a}).done(function(a){a=JSON.parse(a),a[0]&&(a=a[0],1==l?(l=!l,o.updateSupplierInformation(a.termofpaymentkey)):e!=a.termofpaymentkey&&($("#dialog-message").html("Apakah Anda ingin mengganti data pembayaran dengan data default untuk pemasok ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pembayaran",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.updateSupplierInformation(a.termofpaymentkey),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})))})},this.importData=function(a){var n=$(a).attr("relkey");$.ajax({type:"GET",url:"ajax-template-purchase-item.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e))},data:"action=getDetailById&pkey="+n,success:function(e){var a,n,e=JSON.parse(e);for(a=0;a<e.length;a++){var t=[];t.push({selector:"hidServiceKey",value:e[a].itemkey}),t.push({selector:"serviceName",value:e[a].costname}),n=addNewTemplateRow("detail-row-template",JSON.stringify(t))}o.rebindEl(),o.updateDetailSupplierMasterPrice()},error:function(){}})},this.onChangeSupplier=function(){o.updateTOP(),o.updateDetailSupplierMasterPrice()},this.onChangeJobOrder=function(e){o.updateFromJobOrder(e),o.updateDetailSupplierMasterPrice()},this.onChangeJobHeader=function(e){o.updateFromJobHeader(e)},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("containerDetailName[]",c,"ajax-container.php?action=searchData"),bindAutoCompleteForTransactionDetail("serviceName[]",s,"ajax-item.php?action=searchData&itemtype=3"),bindEl(r.find("[name='qty[]'], [name='priceInUnit[]'],  [name='selCurrencyDetail[]']"),"change",function(){o.calculateDetail(this)}),bindEl(r.find("[name='containerDetailName[]'],[name='serviceName[]'],[name='selCurrencyDetail[]']"),"change",function(){o.updateSupplierMasterPrice($(this))})},this.loadOnReady=function(){r.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return r.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void r.find(".cashTOP").hide();r.find(".cashTOP").show()}),r.find(".cost-template").click(function(){o.importData(this)}),r.find("[name=selTermOfPaymentKey]").change(),r.find("[name=beforeTaxTotal], [name=chkIncludeTax], [name=taxPercentage]").change(function(){o.calculateTotal(this)}),r.find("[name=selContainerType]").change(function(){o.updateJobType()
}),r.find("[name=selJOType]").change(function(){o.updateTransactionType()}),r.find("[name=selVolumeType]").change(function(){o.updateVolumeType()}),r.find("[name=selCurrency]").change(function(){o.onChangeCurrency(),o.updateDetailSupplierMasterPrice()}),r.find(".mnv-active-currency").html(r.find("[name=selCurrency]").find("option:selected").text()),r.find("[name=currencyRate]").change(function(){o.onChangeCurrencyRate()}),r.find("[name=selJOType]").change(),o.updateJobType(),o.rebindEl()}}function ItemAdjustment(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"qtyBefore[]",value:"qoh"}),o.push({object:"COGS[]",value:"cogs"});var r=o;this.tabID=e,this.rs=a.length>0?a[0]:null,this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-item.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e)),n.activeAjaxConnections++},data:"action=searchData&categorykey="+t.find("[name=selCategoryKey]").val()+"&trdate="+t.find("[name=trDate]").val()+"&getQOH=1&itemtype=1&warehousekey="+t.find("[name=selWarehouseKey]").val(),success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidItemKey",value:e[a].pkey}),i.push({selector:"itemName",value:e[a].value}),i.push({selector:"qtyBefore",value:e[a].qoh}),i.push({selector:"COGS",value:e[a].cogs}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i)),$newRow.find(".baseitemunit").html(e[a].baseunitname)}n.rebindEl(),t.find(".inputnumber").change().blur(),decreaseActiveAjaxConnections(n)},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateDetail=function(e,a,t){var o=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).change().blur();if(""!=t.item.value){var r=o.find('[name="itemName[]"]').first();r.val(t.item.value),o.find(".baseitemunit").html(t.item.baseunitname),n.updateQOH(r)}},this.calculateTotal=function(e){var a=$(e).closest(".transaction-detail-row"),n=parseFloat(unformatCurrency(a.find('[name="qtyBefore[]"]').val()))||0,t=parseFloat(unformatCurrency(a.find('[name="qtyAfter[]"]').val()))||0,i=t-n;a.find('[name="qtyAdjust[]"]').val(i).blur()},this.updateQOH=function(e){var a=t.find("[name=selWarehouseKey]").val(),i=t.find("[name=trDate]").val(),o=e.closest(".transaction-detail-row"),r=o.find(' [name="hidItemKey[]"]').first().val();$.ajax({beforeSend:function(){n.activeAjaxConnections++},type:"GET",url:"ajax-item.php",async:!1,data:"action=searchData&getQOH=1&pkey="+r+"&warehousekey="+a+"&trdate="+i,success:function(e){var a=JSON.parse(e)[0];void 0!=a&&(o.find('[name="qtyBefore[]"]').first().val(a.qoh).change().blur(),o.find('[name="COGS[]"]').first().val(a.cogs).change().blur()),decreaseActiveAjaxConnections(n)},error:function(){decreaseActiveAjaxConnections(n)}})},this.recalculateQOH=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_});var e=t.find('[name="itemName[]"]');e.each(function(){n.updateQOH($(this))}),hideOverlayScreen()},this.rebindEl=function(){bindEl(t.find("[name='qtyBefore[]'], [name='qtyAfter[]']"),"change",function(){n.calculateTotal(this)}),bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail)},this.loadOnReady=function(){t.find("[name=selWarehouseKey], [name=trDate]").change(function(){n.recalculateQOH()}),t.find("[name=btnImport]").on("click",function(){var e=!1,a=t.find('[name="hidItemKey[]"]');a.each(function(){0!=$(this).val()&&""!=$(this).val()&&(e=!0)});var i=$(this);i.prop("disabled",!0),1==e?($("#dialog-message").html("Import data akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Import Data",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){},buttons:{OK:function(){n.importData(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):n.importData(),i.prop("disabled",!1)}),n.rs&&1==n.rs.statuskey&&n.recalculateQOH(),n.rebindEl()}}function ItemIn(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"selUnit[]",value:"deftransunitkey"}),o.push({object:"COGS[]",value:"cogs"}),o.push({object:"hidNeedSN[]",value:"needsn"});var r=o,o=new Array;o.push({object:"hidVendorPartNumberKey[]",value:"pkey"}),o.push({object:"itemName[]",value:"itemname"}),o.push({object:"hidItemKey[]",value:"itemkey"}),o.push({object:"hidTempItemKey[]",value:"itemkey"}),o.push({object:"hidNeedSN[]",value:"needsn"}),o.push({object:"COGS[]",value:"cogs"});var l=o;this.tabID=e,this.tablekey=a,this.updateDetail=function(e,a,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(disabledButton(o.find("[name=btnMoreOptions]")),o.find(".options-row").hide(),i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).change().blur();if(updateAvailableUnit(r,l),o.find('[name="itemName[]"]').first().val(decodeHTMLEntities(t.item.value)),o.find(".baseitemunit").html(t.item.baseunitname),1==t.item.needsn&&n.calculateSNNeeded(e),o.find('[name="vendorPartNumber[]"]').is(":visible")){var d=o.find('[name="hidTempItemKey[]"]').first().val(),c=o.find('[name="hidItemKey[]"]').first().val();d!=c&&(o.find('[name="vendorPartNumber[]"]').first().val(""),o.find('[name="hidVendorPartNumberKey[]"]').first().val(""))}n.updateSNOptions(o)},this.updateItem=function(e,a,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(t.item[a[i].value]));o.find(".inputnumber").change().blur(),n.updateSNOptions(o),o.find('[name="vendorPartNumber[]"]').first().val(t.item.value),updateAvailableUnit(r,l)},this.updateSNOptions=function(e){var a=t.find("[name=chkIsFullReceive]").val();if(0==a)t.find(".btn-more-options").prop("disabled",!0),t.find(".options-row").hide();else{var i=e?e:t.find(".transaction-detail-row");i.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),n.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})}},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:t.find(".transaction-detail-row"),detailRow.each(function(){1==$(this).find("[name='hidNeedSN[]']").val()&&0!=$(this).find(".options-row").is(":visible")&&($(this).find(".total-sn-label").show(),disabledButton($(this).find("[name=btnMoreOptions]"),!1),$(this).find(".options-row").show(),totalQty=$(this).find("[name='qty[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=$(this).find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.updateWOItemDetail=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0;var a=t.find("[name=refkey]").val(),i="action=getDetailById&pkey="+a;$.ajax({type:"GET",url:"ajax-sales-order-rental-work-order.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e)),n.activeAjaxConnections++},data:i,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidItemKey",value:e[a].itemkey}),i.push({selector:"itemName",value:e[a].itemname}),i.push({selector:"qty",value:e[a].qty}),i.push({selector:"selUnit",value:e[a].unitkey}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i))}n.rebindEl(),t.find(".inputnumber").change().blur(),decreaseActiveAjaxConnections(n)},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateWorkInformation=function(){$.ajax({type:"GET",url:"ajax-sales-order-rental-work-order.php",async:!1,data:"action=getDataRowById&pkey="+t.find("[name=refkey]").val(),success:function(e){if(e){if(e=JSON.parse(e),0==e.length)return void alert(phpErrorMsg[213]);e=e[0],t.find("[name=customerName]").val(e.customername),t.find("[name=hidCustomerKey]").val(e.customerkey)}}})},this.updateOptions=function(e){var a=$(e).closest(".transaction-detail-row"),t=a.find(".form-panel");if(t.is(":visible")){var o=!1;$varSN=a.find("[name='snList[]']").val();var r=$varSN.split(/[\n, ]+/);if($varSN="",r.length>0){for($varSN='<ul class="tag-list">',i=0;i<r.length;i++)0!=r[i].length&&($varSN+="<li>"+r[i]+"</li>",o=!0);$varSN+="<ul>"}o?a.find(".form-panel-result").html($varSN).show():a.find(".form-panel-result").html("").hide()}n.calculateSNNeeded(a)},this.rebindEl=function(){bindEl(t.find("[name='qty[]'] "),"change",function(){n.calculateSNNeeded(this)}),bindEl(t.find(".btn-more-options"),"click",function(){n.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail),bindAutoCompleteForTransactionDetail("vendorPartNumber[]",l,"ajax-item.php?action=searchVendorPartNumber",n.updateItem)},this.loadOnReady=function(){t.find("[name=chkIsFullReceive]").on("change",function(){n.updateSNOptions()}),t.find(".transaction-detail-row").each(function(){n.calculateSNNeeded($(this))}),t.find("[name=selTransactionType]").change(function(){var e=parseInt($(this).val());999>e?$(".coa-link").hide():$(".coa-link").show()}),t.find("[name=selTransactionType]").change(),n.rebindEl()}}function ItemInReceive(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"});var r=o;this.rs=a.length>0?a[0]:null,this.tabID=e,this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-item-in.php",beforeSend:function(){n.activeAjaxConnections++},data:"action=getRelatedInformation&pkey="+t.find("[name=hidItemInKey]").val(),success:function(e){if(e){var e=JSON.parse(e);t.find("[name=reference]").val(e[0].refcode),t.find("[name=supplierName]").val(e[0].suppliername)}},error:function(){},complete:function(){n.updateSNOptions(),decreaseActiveAjaxConnections(n)}}),$.ajax({type:"GET",url:"ajax-item-in.php",beforeSend:function(){clearAllRows($("#"+e)),n.activeAjaxConnections++},data:"action=getOutstandingDetail&pkey="+t.find("[name=hidItemInKey]").val(),success:function(e){if(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidItemInDetailKey",value:e[a].pkey}),i.push({selector:"hidItemKey",value:e[a].itemkey}),i.push({selector:"itemName",value:e[a].itemname}),i.push({selector:"hidVendorPartNumberKey",value:e[a].vendorpartnumberkey}),i.push({selector:"vendorPartNumber",value:e[a].partnumber}),i.push({selector:"hidNeedSN",value:e[a].needsn}),i.push({selector:"orderedQtyInBaseUnit",value:e[a].qtyinbaseunit}),i.push({selector:"qtyMinusInBaseUnit",value:e[a].qtyinbaseunit-e[a].receivedqtyinbaseunit}),i.push({selector:"receivedQtyInBaseUnit",value:e[a].qtyinbaseunit-e[a].receivedqtyinbaseunit}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i)),$newRow.find(".baseitemunit").first().html(e[a].baseunitname)}t.find(".inputnumber").blur(),n.calculateSNNeeded(t.find('[name="hidItemKey[]"]')),n.rebindEl()}},complete:function(){n.updateSNOptions(),decreaseActiveAjaxConnections(n)}})},this.updateItemInReceiveMinusQty=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,$.ajax({beforeSend:function(){n.activeAjaxConnections++},type:"GET",url:"ajax-item-in.php",data:"action=getOutstandingDetail&pkey="+t.find("[name=hidItemInKey]").val(),success:function(e){if(e){var a,e=JSON.parse(e);for(t.find('[name="hidItemKey[]"]').each(function(){$(this).closest(".transaction-detail-row").hasClass("detail-row-template")||$(this).closest(".transaction-detail-row").addClass("will-delete")}),a=0;a<e.length;a++){var n=t.find('[name="hidItemKey[]"][value=\''+e[a].itemkey+"']").closest(".transaction-detail-row"),i=parseInt(e[a].qtyinbaseunit),o=parseInt(e[a].receivedqtyinbaseunit);n.find('[name="orderedQtyInBaseUnit[]"]').first().val(i),n.find('[name="qtyMinusInBaseUnit[]"]').first().val(i-o),i!=o&&n.removeClass("will-delete")}t.find(".inputnumber").change().blur(),t.find(".will-delete").remove()}},complete:function(){n.updateSNOptions(),decreaseActiveAjaxConnections(n)}})},this.updateSNOptions=function(e){var a=e?e:t.find(".transaction-detail-row");a.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),n.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:t.find(".transaction-detail-row"),detailRow.each(function(){1==detailRow.find("[name='hidNeedSN[]']").val()&&0!=detailRow.find(".options-row").is(":visible")&&(detailRow.find(".total-sn-label").show(),disabledButton(detailRow.find("[name=btnMoreOptions]"),!1),detailRow.find(".options-row").show(),totalQty=detailRow.find("[name='receivedQtyInBaseUnit[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=detailRow.find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.updateOptions=function(e){var a=$(e).closest(".transaction-detail-row"),t=a.find(".form-panel");if(t.is(":visible")){var o=!1;$varSN=a.find("[name='snList[]']").val();var r=$varSN.split(/[\n, ]+/);if($varSN="",r.length>0){for($varSN='<ul class="tag-list">',i=0;i<r.length;i++)0!=r[i].length&&($varSN+="<li>"+r[i]+"</li>",o=!0);$varSN+="<ul>"}o?a.find(".form-panel-result").html($varSN).show():a.find(".form-panel-result").html("").hide()}n.calculateSNNeeded(a)},this.rebindEl=function(){bindEl(t.find("[name='receivedQtyInBaseUnit[]']"),"change",function(){n.calculateSNNeeded(this)}),bindEl(t.find(".btn-more-options"),"click",function(){n.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail)},this.loadOnReady=function(){t.find("[name=chkIsFullReceive]").on("change",function(){n.updateSNOptions()}),t.find(".transaction-detail-row").each(function(){n.calculateSNNeeded($(this))}),n.rs&&1==n.rs.statuskey&&n.updateItemInReceiveMinusQty(),n.rebindEl()}}function ItemOut(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"selUnit[]",value:"deftransunitkey"}),o.push({object:"COGS[]",value:"cogs"}),o.push({object:"hidNeedSN[]",value:"needsn"});var r=o,o=new Array;o.push({object:"hidVendorPartNumberKey[]",value:"pkey"}),o.push({object:"itemName[]",value:"itemname"}),o.push({object:"hidItemKey[]",value:"itemkey"}),o.push({object:"hidTempItemKey[]",value:"itemkey"}),o.push({object:"hidNeedSN[]",value:"needsn"}),o.push({object:"COGS[]",value:"cogs"});var l=o;this.tabID=e,this.tablekey=a,this.updateDetail=function(e,a,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(disabledButton(o.find("[name=btnMoreOptions]")),o.find(".options-row").hide(),i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).change().blur();if(updateAvailableUnit(r,l),o.find('[name="itemName[]"]').first().val(decodeHTMLEntities(t.item.value)),o.find(".baseitemunit").html(t.item.baseunitname),1==t.item.needsn&&n.calculateSNNeeded(e),o.find('[name="vendorPartNumber[]"]').is(":visible")){var d=o.find('[name="hidTempItemKey[]"]').first().val(),c=o.find('[name="hidItemKey[]"]').first().val();d!=c&&(o.find('[name="vendorPartNumber[]"]').first().val(""),o.find('[name="hidVendorPartNumberKey[]"]').first().val(""))}n.updateSNOptions(o)},this.updateItem=function(e,a,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(t.item[a[i].value]));o.find(".inputnumber").change().blur(),n.updateSNOptions(o),o.find('[name="vendorPartNumber[]"]').first().val(t.item.value),updateAvailableUnit(r,l)},this.updateSNOptions=function(e){var a=t.find("[name=chkIsFullDelivered]").val();if(0==a)t.find(".btn-more-options").prop("disabled",!0),t.find(".options-row").hide();else{var i=e?e:t.find(".transaction-detail-row");i.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),n.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})}},this.showInternal=function(){t.find(".internal, .external").toggle()},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:t.find(".transaction-detail-row"),detailRow.each(function(){1==$(this).find("[name='hidNeedSN[]']").val()&&0!=$(this).find(".options-row").is(":visible")&&($(this).find(".total-sn-label").show(),disabledButton($(this).find("[name=btnMoreOptions]"),!1),$(this).find(".options-row").show(),totalQty=$(this).find("[name='qty[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=$(this).find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.updateOptions=function(e){var a=$(e).closest(".transaction-detail-row"),t=a.find(".form-panel");if(t.is(":visible")){var o=!1;$varSN=a.find("[name='snList[]']").val();var r=$varSN.split(/[\n, ]+/);if($varSN="",r.length>0){for($varSN='<ul class="tag-list">',i=0;i<r.length;i++)0!=r[i].length&&($varSN+="<li>"+r[i]+"</li>",o=!0);$varSN+="<ul>"}o?a.find(".form-panel-result").html($varSN).show():a.find(".form-panel-result").html("").hide()}n.calculateSNNeeded(a)},this.rebindEl=function(){bindEl(t.find("[name='qty[]'] "),"change",function(){n.calculateSNNeeded(this)}),bindEl(t.find(".btn-more-options"),"click",function(){n.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail),bindAutoCompleteForTransactionDetail("vendorPartNumber[]",l,"ajax-item.php?action=searchVendorPartNumber",n.updateItem)},this.loadOnReady=function(){t.find("[name=chkIsFullDelivered]").on("change",function(){n.updateSNOptions()}),t.find("[name=chkIsInternal]").change(function(){n.showInternal(this)}),t.find("[name=selTransactionType]").change(function(){var e=parseInt($(this).val());999>e?$(".coa-link").hide():$(".coa-link").show()}),t.find("[name=selTransactionType]").change(),t.find(".transaction-detail-row").each(function(){n.calculateSNNeeded($(this))}),n.rebindEl()}}function ItemOutDelivery(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"});var r=o;this.rs=a.length>0?a[0]:null,this.tabID=e,this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-item-out.php",beforeSend:function(){n.activeAjaxConnections++},data:"action=getRelatedInformation&pkey="+t.find("[name=hidItemOutKey]").val(),success:function(e){if(e){var e=JSON.parse(e);t.find("[name=reference]").val(e[0].refcode),t.find("[name=customerName]").val(e[0].customername)}},error:function(){},complete:function(){n.updateSNOptions(),decreaseActiveAjaxConnections(n)}}),$.ajax({type:"GET",url:"ajax-item-out.php",beforeSend:function(){clearAllRows($("#"+e)),n.activeAjaxConnections++},data:"action=getOutstandingDetail&pkey="+t.find("[name=hidItemOutKey]").val(),success:function(e){if(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=parseInt(e[a].qtyinbaseunit),o=parseInt(e[a].deliveredqtyinbaseunit),r=[];r.push({selector:"hidItemOutDetailKey",value:e[a].pkey}),r.push({selector:"hidItemKey",value:e[a].itemkey}),r.push({selector:"itemName",value:e[a].itemname}),r.push({selector:"hidVendorPartNumberKey",value:e[a].vendorpartnumberkey}),r.push({selector:"vendorPartNumber",value:e[a].partnumber}),r.push({selector:"hidNeedSN",value:e[a].needsn}),r.push({selector:"orderedQtyInBaseUnit",value:i}),r.push({selector:"qtyMinusInBaseUnit",value:i-o}),r.push({selector:"deliveredQtyInBaseUnit",value:i-o}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(r)),$newRow.find(".baseitemunit").first().html(e[a].baseunitname)}t.find(".inputnumber").blur(),n.calculateSNNeeded(t.find('[name="hidItemKey[]"]')),n.rebindEl()}},error:function(){},complete:function(){n.updateSNOptions(),decreaseActiveAjaxConnections(n)}})},this.updateItemOutDeliveryMinusQty=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,$.ajax({beforeSend:function(){n.activeAjaxConnections++},type:"GET",url:"ajax-item-out.php",data:"action=getOutstandingDetail&pkey="+t.find("[name=hidItemOutKey]").val(),success:function(e){if(e){var a,e=JSON.parse(e);for(t.find('[name="hidItemKey[]"]').each(function(){$(this).closest(".transaction-detail-row").hasClass("detail-row-template")||$(this).closest(".transaction-detail-row").addClass("will-delete")}),a=0;a<e.length;a++){var n=t.find('[name="hidItemKey[]"][value=\''+e[a].itemkey+"']").closest(".transaction-detail-row");n.find('[name="orderedQtyInBaseUnit[]"]').first().val(e[a].qtyinbaseunit),n.find('[name="qtyMinusInBaseUnit[]"]').first().val(e[a].qtyinbaseunit-e[a].deliveredqtyinbaseunit),e[a].qtyinbaseunit!=e[a].deliveredqtyinbaseunit&&n.removeClass("will-delete")}t.find(".inputnumber").change().blur(),t.find(".will-delete").remove()}},complete:function(){n.updateSNOptions(),decreaseActiveAjaxConnections(n)}})},this.updateSNOptions=function(e){var a=e?e:t.find(".transaction-detail-row");a.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),n.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:t.find(".transaction-detail-row"),detailRow.each(function(){1==detailRow.find("[name='hidNeedSN[]']").val()&&0!=detailRow.find(".options-row").is(":visible")&&(detailRow.find(".total-sn-label").show(),disabledButton(detailRow.find("[name=btnMoreOptions]"),!1),detailRow.find(".options-row").show(),totalQty=detailRow.find("[name='deliveredQtyInBaseUnit[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=detailRow.find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.updateOptions=function(e){var a=$(e).closest(".transaction-detail-row"),t=a.find(".form-panel");if(t.is(":visible")){var o=!1;$varSN=a.find("[name='snList[]']").val();var r=$varSN.split(/[\n, ]+/);if($varSN="",r.length>0){for($varSN='<ul class="tag-list">',i=0;i<r.length;i++)0!=r[i].length&&($varSN+="<li>"+r[i]+"</li>",o=!0);$varSN+="<ul>"}o?a.find(".form-panel-result").html($varSN).show():a.find(".form-panel-result").html("").hide()}n.calculateSNNeeded(a)},this.rebindEl=function(){bindEl(t.find("[name='deliveredQtyInBaseUnit[]']"),"change",function(){n.calculateSNNeeded(this)}),bindEl(t.find(".btn-more-options"),"click",function(){n.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail)},this.loadOnReady=function(){t.find("[name=chkIsFullDelivered]").on("change",function(){n.updateSNOptions()}),t.find(".transaction-detail-row").each(function(){n.calculateSNNeeded($(this))}),n.rs&&1==n.rs.statuskey&&n.updateItemOutDeliveryMinusQty(),n.rebindEl()}}function PurchaseOrder(e,a,n,t){var o=this,r=$("#"+e),l=new Array;l.push({object:"hidItemKey[]",value:"pkey"}),l.push({object:"selUnit[]",value:"deftransunitkey"});var d=l,c=!0;this.tabID=e,this.tablekey=n,this.updateSupplier=function(){var e=r.find("[name=hidPurchaseRequestKey]").val();$.ajax({type:"GET",url:"ajax-purchase-request.php",data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],r.find("[name=hidSupplierKey]").val(e.supplierkey),r.find("[name=supplierName]").val(e.suppliername))})},this.importData=function(){o.updateSupplier(),clearAllRows(r.find(".mnv-transaction")),loadOverlayScreen({content:_LOADING_TEMPLATE_}),o.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-purchase-request.php",beforeSend:function(){clearAllRows(r.find(".mnv-transaction")),o.activeAjaxConnections++},data:"action=getDetailById&pkey="+r.find("[name=hidPurchaseRequestKey]").val(),success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=[];a.push({selector:"hidDetailKey",value:e[i].pkey}),a.push({selector:"hidItemKey",value:e[i].itemkey}),a.push({selector:"itemName",value:e[i].itemname}),a.push({selector:"qty",value:e[i].qty}),a.push({selector:"priceInUnit",value:e[i].priceinunit}),a.push({selector:"selUnit",value:e[i].unitkey}),a.push({selector:"detailSubtotal",value:e[i].qty*e[i].priceinunit}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(a)),$newRow.find(".baseitemunit").first().html(e[i].baseunitname)}o.calculateTotal(),o.rebindEl(),r.find(".inputnumber, .inputdecimal").blur(),decreaseActiveAjaxConnections(o)}},complete:function(){decreaseActiveAjaxConnections(o)}})},this.updateDetailService=function(){clearAllRows(r.find(".mnv-transaction")),loadOverlayScreen({content:_LOADING_TEMPLATE_}),o.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-sales-order-car-service.php",beforeSend:function(){clearAllRows(r.find(".mnv-transaction")),o.activeAjaxConnections++},data:"action=getDetailById&pkey="+r.find("[name=hidServiceKey]").val(),success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=[];a.push({selector:"hidDetailKey",value:e[i].pkey}),a.push({selector:"hidItemKey",value:e[i].itemkey}),a.push({selector:"itemName",value:e[i].itemname}),a.push({selector:"qty",value:e[i].qty}),a.push({selector:"selUnit",value:e[i].unitkey}),a.push({selector:"priceInUnit",value:e[i].priceinunit}),a.push({selector:"discounValueInUnit",value:e[i].discount}),a.push({selector:"selDiscountType",value:e[i].discounttype}),a.push({selector:"detailSubtotal",value:e[i].total}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(a)),$newRow.find(".baseitemunit").first().html(e[i].baseunitname)}o.rebindEl(),r.find(".inputnumber, .inputdecimal").blur(),decreaseActiveAjaxConnections(o)}},complete:function(){decreaseActiveAjaxConnections(o)}})},this.updateTransactionType=function(){var e=r.find("[name=selType]"),a=r.find(".ispurchase"),n=r.find(".isservice"),i=e.val();i==t.TRANSACTIONTYPE.Request?(a.show(),n.hide()):(a.hide(),n.show())},this.onChangePurchaseRequest=function(e,a){var n=this;""!=r.find("[name=hidCurrentPurchaseRequestKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Penawaran Pembelian",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){r.find("[name=hidPurchaseRequestKey]").val(r.find("[name=hidCurrentPurchaseRequestKey]").val()),r.find("[name=purchaseRequestCode]").val(r.find("[name=hidCurrentPurchaseRequestCode]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),o.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidPurchaseRequestKey"),r.find("[name=hidCurrentPurchaseRequestKey]").val(""),r.find("[name=hidCurrentPurchaseRequestCode]").val("")):(r.find("[name=hidCurrentPurchaseRequestKey]").val(a.item.pkey),r.find("[name=hidCurrentPurchaseRequestCode]").val(a.item.value)),o.importData(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidPurchaseRequestKey"),r.find("[name=hidCurrentPurchaseRequestKey]").val(""),r.find("[name=hidCurrentPurchaseRequestCode]").val("")):(r.find("[name=hidCurrentPurchaseRequestKey]").val(a.item.pkey),r.find("[name=hidCurrentPurchaseRequestCode]").val(a.item.value),o.importData()),o.rebindEl())},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),r=t.find('[name="hidItemKey[]"]').first(),l=t.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(r,l),o.updatePrice(r),t.find('[name="itemName[]"]').first().val(n.item.value)},this.calculateDetail=function(e){{var a=$(e).closest(".transaction-detail-row"),n=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),t=unformatCurrency(a.find("[name='priceInUnit[]']").val()),i=unformatCurrency(a.find("[name='discountValueInUnit[]']").val()),r=unformatCurrency(a.find("[name='selDiscountType[]']").val());a.find("[name='selUnit[]']").val()}0!=i&&2==r&&(i=i/100*t);var l=n*(t-i);a.find("[name='detailSubtotal[]']").val(l).blur(),o.calculateTotal()},this.calculateTotal=function(){var e=0;r.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),r.find("[name='subtotal']").val(e).blur();var a=parseInt(unformatCurrency(r.find("[name='finalDiscount']").val()))||0,n=parseInt(unformatCurrency(r.find("[name='selFinalDiscountType']").val()))||0,t=parseInt(unformatCurrency(r.find("[name='shipmentFee']").val()))||0,i=parseInt(unformatCurrency(r.find("[name='etcCost']").val()))||0,o=r.find("[name='chkIncludeTax']").val(),l=parseInt(unformatCurrency(r.find("[name='taxPercentage']").val()))||0;0!=a&&2==n&&(a=a/100*e),e-=a,r.find("[name='beforeTaxTotal']").val(e).blur();var d=0;0==o?(d=e*l/100,e+=d):(d=l/(100+l)*e,r.find("[name='beforeTaxTotal']").val(e-d).blur()),r.find("[name='taxValue']").val(d).blur();var c=e+t+i;r.find("[name='total']").val(c).blur();var s=parseInt(unformatCurrency(r.find("[name='totalPayment']").val())),u=s-c;r.find("[name='balance']").val(u).blur()},this.updatePrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=r.find("[name=hidSupplierKey]").val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-purchase-order.php",async:!1,data:"action=getPriceDetail&itemkey="+t+"&supplierkey="+n}).done(function(e){e=JSON.parse(e),e=e[0];var n=e?e.priceinunit:0;a.find("[name='priceInUnit[]']").val(n).change(),r.find(".inputnumber").blur()})},this.updateTOP=function(){var e=r.find("[name=selTermOfPaymentKey]").val(),a=r.find("[name=hidSupplierKey]").val();$.ajax({type:"GET",url:"ajax-supplier.php",data:"action=getDataRowById&pkey="+a}).done(function(a){a&&(a=JSON.parse(a),a=a[0],1==c?(c=!c,o.updateSupplierInformation(a.termofpaymentkey)):e!=a.termofpaymentkey&&($("#dialog-message").html("Apakah Anda ingin mengganti data pembayaran dengan data default untuk pemasok ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pembayaran",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()
},buttons:{OK:function(){o.updateSupplierInformation(a.termofpaymentkey),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})))})},this.onChangeServiceOrder=function(){o.updateDetailService()},this.updateSupplierInformation=function(e){r.find("[name=selTermOfPaymentKey] option[value='"+e+"']").length>0&&r.find("[name=selTermOfPaymentKey]").val(e).change()},this.onChangePaymentMethodHandler=function(){o.calculateTotal()},this.afterRemoveRowHandler=function(){o.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",d,"ajax-item.php?action=searchData",o.updateDetail),bindEl(r.find("[name='qty[]'], [name='priceInUnit[]'], [name='discountValueInUnit[]'],  [name='selUnit[]']"),"change",function(){o.calculateDetail(this)}),bindEl(r.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),o.calculateDetail(this)})},this.loadOnReady=function(){r.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<a.length;i++)if($(this).val()==a[i])return r.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void r.find(".cashTOP").hide();r.find(".cashTOP").show()}),r.find("[name=selTermOfPaymentKey]").change(),r.find(" [name=chkIsFullReceive]").change(),r.find(".form-detail-field").toggle(),r.find(".form-detail-button").click(function(){r.find(".form-detail-field").toggle("highlight");var a=r.find(".form-detail-button").attr("relalt");$("#"+e+" .form-detail-button").attr("relalt",r.find(".form-detail-button").text()),r.find(".form-detail-button").text(a)}),r.find("[name=selType]").change(function(){o.updateTransactionType()}),r.find("[name=selFinalDiscountType], [name=finalDiscount], [name=beforeTaxTotal], [name=chkIncludeTax],[name=shipmentFee], [name=etcCost], [name=taxPercentage]").change(function(){o.calculateTotal(this)}),r.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),r.find("[name=selType]").change(),o.rebindEl()}}function PurchaseReceive(e,a,n){var t=this,o=$("#"+e),r=new Array;r.push({object:"hidItemKey[]",value:"pkey"});var l=r,d=!0;this.tabID=e,this.rs=a.length>0?a[0]:null,this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-purchase-order.php",beforeSend:function(){clearAllRows(o.find(".purchase-receive-detail")),t.activeAjaxConnections++},data:"action=getOutstandingDetail&pkey="+o.find("[name=hidPurchaseOrderKey]").val(),success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=parseInt(e[i].qtyinbaseunit),n=parseInt(e[i].receivedqtyinbaseunit),r=[];r.push({selector:"hidPODetailKey",value:e[i].pkey}),r.push({selector:"hidItemKey",value:e[i].itemkey}),r.push({selector:"itemName",value:e[i].itemname}),r.push({selector:"orderedQtyInBaseUnit",value:a}),r.push({selector:"qtyMinusInBaseUnit",value:a-n}),r.push({selector:"receivedQtyInBaseUnit",value:a-n}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(r)),$newRow.find(".baseitemunit").first().html(e[i].baseunitname)}t.rebindEl(),o.find(".inputnumber, .inputdecimal").blur(),decreaseActiveAjaxConnections(t)}},complete:function(){decreaseActiveAjaxConnections(t)}})},this.calculateTotal=function(){var e=parseInt(unformatCurrency(o.find("[name='shipmentFee']").val()))||0,a=e;o.find("[name='total']").val(a).blur();var n=parseInt(unformatCurrency(o.find("[name='totalPayment']").val())),t=n-a;o.find("[name='balance']").val(t).blur()},this.updatePurchaseReceiveMinusQty=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({beforeSend:function(){t.activeAjaxConnections++},type:"GET",url:"ajax-purchase-order.php",data:"action=getOutstandingDetail&pkey="+o.find("[name=hidPurchaseOrderKey]").val(),success:function(e){if(e){var a,e=JSON.parse(e);for(o.find('[name="hidItemKey[]"]').each(function(){$(this).closest(".transaction-detail-row").hasClass("detail-row-template")||$(this).closest(".transaction-detail-row").addClass("will-delete")}),a=0;a<e.length;a++){var n=o.find('[name="hidItemKey[]"][value=\''+e[a].itemkey+"']").closest(".transaction-detail-row");n.find('[name="qtyMinusInBaseUnit[]"]').first().val(e[a].qtyinbaseunit-e[a].receivedqtyinbaseunit),n.removeClass("will-delete")}o.find(".inputnumber, .inputdecimal").blur(),o.find(".will-delete").remove()}},complete:function(){decreaseActiveAjaxConnections(t)}})},this.updateTOP=function(){var e=o.find("[name=selTermOfPaymentKey]").val(),a=o.find("[name=hidSupplierKey]").val();$.ajax({type:"GET",url:"ajax-supplier.php",data:"action=getDataRowById&pkey="+a}).done(function(a){a=JSON.parse(a),a=a[0],1==d?(d=!d,t.updateSupplierInformation(a.termofpaymentkey)):e!=a.termofpaymentkey&&($("#dialog-message").html("Apakah Anda ingin mengganti data pembayaran dengan data default untuk pemasok ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pembayaran",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){t.updateSupplierInformation(a.termofpaymentkey),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}))})},this.updateSupplierInformation=function(e){o.find("[name=selTermOfPaymentKey] option[value='"+e+"']").length>0&&o.find("[name=selTermOfPaymentKey]").val(e).change()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",l,"ajax-item.php?action=searchData&itemtype=1")},this.loadOnReady=function(){o.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPaymentKey]").change(),t.rs&&1==t.rs.statuskey&&t.updatePurchaseReceiveMinusQty(),o.find("[name=shipmentFee]").change(function(){t.calculateTotal(this)}),t.rebindEl()}}function SalesOrder(e,a,n,t){var o=this,r=$("#"+e);this.tabObj=r,this.customCodeCache=[];var l=new Array;l.push({object:"hidItemKey[]",value:"pkey"}),l.push({object:"priceInUnit[]",value:"sellingprice"}),l.push({object:"selUnit[]",value:"deftransunitkey"}),l.push({object:"hidGramasi[]",value:"gramasi"});var d=l,l=new Array;l.push({object:"hidVoucherKey[]",value:"pkey"}),l.push({object:"voucherAmount[]",value:"vouchervalue"});var c=l;this.tabID=e,this.rs=a.length>0?a[0]:null;var s=new Array;$.each(t,function(e,a){s.push(a.voucherkey)}),s=JSON.stringify(s),this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),r=t.find('[name="hidItemKey[]"]').first(),l=t.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==n.item.weightunitkey&&(n.item[a[i].value]*=1e3),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(r,l),o.updateUnitPrice(l),t.find('[name="itemName[]"]').first().val(n.item.value),o.calculateDetail(r)},this.calculateVoucherAmount=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"voucherAmount[]"!=a[i].object?t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur():o.recalculateVoucherAmount(t);t.find('[name="voucherCode[]"]').first().val(n.item.value),o.calculateTotal(!1)},this.recalculateVoucherAmount=function(e){var a=0,n=parseFloat(unformatCurrency(r.find("[name='subtotal']").val()))||0,t=parseFloat(unformatCurrency(r.find("[name='finalDiscount']").val()))||0,i=parseInt(unformatCurrency(r.find("[name='selFinalDiscountType']").val()))||0;return 0!=t&&2==i&&(t=t/100*n),n-=t,$.ajax({type:"GET",url:"ajax-voucher-transaction.php",async:!1,data:"action=calculateVoucherValue&voucherkey="+e.find("[name='hidVoucherKey[]']").val()+"&totalSales="+n}).done(function(n){a+=n,e.find("[name='voucherAmount[]']").val(n).blur()}),a},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),t=unformatCurrency(a.find("[name='priceInUnit[]']").val()),i=unformatCurrency(a.find("[name='discountValueInUnit[]']").val()),r=unformatCurrency(a.find("[name='selDiscountType[]']").val()),l=a.find("[name='selUnit[]']"),d=(l.val(),parseFloat(l.find("option:selected").attr("relconversionmultiplier"))),c=parseFloat(a.find("[name='hidGramasi[]']").val());0!=i&&2==r&&(i=i/100*t);var s=n*(t-i);a.find("[name='detailSubtotal[]']").val(s).blur(),a.find("[name='hidGramasiSubtotal[]']").val(c*n*d).blur(),o.calculateTotal()},this.calculateTotal=function(e){e||(e=!0);var a=0;r.find("[name='detailSubtotal[]']").each(function(){a+=parseInt(unformatCurrency($(this).val()))||0}),r.find("[name='subtotal']").val(a).blur(),voucherList=r.find("[name='voucherAmount[]']");var n=0;voucherList.each(function(){var e=o.recalculateVoucherAmount($(this).closest(".transaction-detail-row"));e=parseFloat(e)||0,n+=e});var t=0;r.find("[name='hidGramasiSubtotal[]']").each(function(){t+=parseFloat($(this).val())||0}),r.find(".total-weight").html(Math.ceil(t/1e3));var i=parseFloat(unformatCurrency(r.find("[name='finalDiscount']").val()))||0,l=parseInt(unformatCurrency(r.find("[name='selFinalDiscountType']").val()))||0,d=parseInt(unformatCurrency(r.find("[name='pointValue']").val()))||0,c=parseInt(unformatCurrency(r.find("[name='shipmentFee']").val()))||0,s=parseInt(unformatCurrency(r.find("[name='etcCost']").val()))||0,u=r.find("[name='chkIncludeTax']").val(),m=parseFloat(unformatCurrency(r.find("[name='taxPercentage']").val()))||0;0!=i&&2==l&&(i=i/100*a),a-=i,a-=n,a-=d,r.find("[name='beforeTaxTotal']").val(a).blur();var f=0;0==u?(f=a*m/100,a+=f):(f=m/(100+m)*a,r.find("[name='beforeTaxTotal']").val(a-f).blur()),r.find("[name='taxValue']").val(f).blur();var h=a+c+s;r.find("[name='total']").val(h).blur();var p=parseInt(unformatCurrency(r.find("[name='totalPayment']").val())),v=p-h;r.find("[name='balance']").val(v).blur()},this.updateCustomerInformation=function(){var a=r.find("[name=hidCustomerKey]").val();a&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+a}).done(function(a){a=JSON.parse(a),a=a[0];var n=a.address;r.find("[name=hidCreditLimit]").val(a.creditlimit),$("#"+e+" [name=chkIsDropship]").prop("checked")?(r.find("[name=dropshiperName]").val(a.name),r.find("[name=dropshiperPhone]").val(a.phone),r.find("[name=dropshiperAddress]").val(n)):(r.find("[name=recipientName]").val(a.name),r.find("[name=recipientPhone]").val(a.phone),r.find("[name=recipientEmail]").val(a.email),r.find("[name=recipientAddress]").val(n),r.find("[name=hidRecipientCityKey]").val(a.recipientcitykey),r.find("[name=recipientCityName]").val(a.cityandcategoryname)),r.find("[name=selTermOfPaymentKey] option[value='"+a.termofpaymentkey+"']").length>0&&r.find("[name=selTermOfPaymentKey]").val(a.termofpaymentkey).change(),o.rebindVoucher()})},this.updateUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val(),i=r.find("[name=hidCustomerKey]").val()||0;$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getUnitSellingPrice&itemkey="+t+"&unitkey="+n+"&lastsellingprice=1&customerkey="+i}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.updateSalesman=function(){var e=r.find("[name=hidCustomerKey]").val();r.find("[name=hidSalesKey]").val(""),r.find("[name=salesName]").val(""),$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getSalesman&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),0!=e.length&&(r.find("[name=hidSalesKey]").val(e.pkey),r.find("[name=salesName]").val(e.name)))})},this.updateRecipients=function(){var a="",n="",t="",i="";$("#"+e+" [name=chkIsDropship]").prop("checked")?(a=r.find("[name=dropshiperName]").val(),n=r.find("[name=dropshiperPhone]").val(),i=r.find("[name=dropshiperAddress]").val()):(a=r.find("[name=recipientName]").val(),n=r.find("[name=recipientPhone]").val(),t=r.find("[name=recipientEmail]").val(),i=r.find("[name=recipientAddress]").val());var l=!1;if((""!=a||""!=n||""!=t||""!=i)&&(l=!0),0==l)o.updateCustomerInformation();else{var d=this;$("#dialog-message").html("Apakah Anda ingin mengganti data pengiriman dan pembayaran dengan data default untuk pelanggan ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){$(d).closest("form").bootstrapValidator("revalidateField",$(d).attr("name"))},buttons:{OK:function(){o.updateCustomerInformation(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}},this.onChangePaymentMethodHandler=function(){o.calculateTotal(),o.rebindVoucher()},this.afterRemoveRowHandler=function(){o.calculateTotal()},this.rebindVoucher=function(){var e=r.find("[name=hidCustomerKey]").val()||0;bindAutoCompleteForTransactionDetail("voucherCode[]",c,"ajax-voucher-transaction.php?action=searchData&statuskey=2&customerkey="+e,o.calculateVoucherAmount)},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",d,"ajax-item.php?action=searchData",o.updateDetail),bindEl(r.find("[name='qty[]'], [name='priceInUnit[]'], [name='discountValueInUnit[]']"),"change",function(){o.calculateDetail(this)}),bindEl(r.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),o.calculateDetail(this)}),bindEl(r.find("[name='selUnit[]']"),"change",function(){o.updateUnitPrice(this),o.calculateDetail(this)}),bindEl($(".voucher-row .remove-button"),"click",function(){removeDetailRows(this),o.calculateTotal()}),o.rebindVoucher()},this.loadOnReady=function(){r.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return r.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void r.find(".cashTOP").hide();r.find(".cashTOP").show()}),r.find("[name=selTermOfPaymentKey]").change(),r.find(" [name=chkIsFullDeliver]").change(),r.find(".form-detail-field").toggle(),r.find(".form-detail-button").click(function(){r.find(".form-detail-field").toggle("highlight");var e=r.find(".form-detail-button").attr("relalt");r.find(".form-detail-button").attr("relalt",r.find(".form-detail-button").text()),r.find(".form-detail-button").text(e)}),r.find("[name=selFinalDiscountType], [name=finalDiscount], [name=beforeTaxTotal], [name=chkIncludeTax],[name=shipmentFee], [name=etcCost], [name=taxPercentage]").change(function(){o.calculateTotal()}),r.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),r.find("[name=btnSaveEmail]").click(function(){r.find("[name=hidSendEmail]").val(1),r.find("#defaultForm").submit()}),r.find("[name=btnUpdate]").click(function(){$.ajax({type:"POST",url:"updateShipmentTracking.php",data:"value="+$("#"+e+" [name=shipmentTracking]").val()+"&id="+$("#"+e+" [name=hidId]").val()}).done(function(e){e=JSON.parse(e);var a="";for(i=0;i<e.length;i++)a=a+e[i].message+"\n";alert(a)})}),r.find("[name=chkIsDropship]").change(function(){r.find(".dropship-information").toggle(),o.updateCustomerInformation()}),o.rs&&1==o.rs.isdropship&&r.find(".dropship-information").toggle();var a=r.find("[name='voucherAmount[]']");a.length<=1&&addNewTemplateRow("voucher-row-template"),customCodeHandler(o),o.rebindEl()}}function SalesDelivery(e,a,n){var t=this,o=$("#"+e),r=new Array;r.push({object:"hidItemKey[]",value:"pkey"});var l=r,d=!0;this.tabID=e,this.rs=a.length>0?a[0]:null,this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-sales-order.php",beforeSend:function(){clearAllRows(o.find(".sales-delivery-detail")),t.activeAjaxConnections++},data:"action=getRelatedInformation&pkey="+o.find("[name=hidSalesOrderKey]").val(),success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=parseInt(e[i].qtyinbaseunit),n=parseInt(e[i].deliveredqtyinbaseunit),r=[];r.push({selector:"hidSODetailKey",value:e[i].pkey}),r.push({selector:"hidItemKey",value:e[i].itemkey}),r.push({selector:"itemName",value:e[i].itemname}),r.push({selector:"orderedQtyInBaseUnit",value:a}),r.push({selector:"qtyMinusInBaseUnit",value:a-n}),r.push({selector:"deliveredQtyInBaseUnit",value:a-n}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(r)),$newRow.find(".baseitemunit").first().html(e[i].baseunitname)}t.rebindEl(),o.find(".inputnumber, .inputdecimal").blur()}},complete:function(){decreaseActiveAjaxConnections(t)}})},this.calculateTotal=function(){var e=parseInt(unformatCurrency(o.find("[name='shipmentFee']").val()))||0,a=e;o.find("[name='total']").val(a).blur();var n=parseInt(unformatCurrency(o.find("[name='totalPayment']").val())),t=n-a;o.find("[name='balance']").val(t).blur()},this.updateSalesDeliveryMinusQty=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({beforeSend:function(){t.activeAjaxConnections++},type:"GET",url:"ajax-sales-order.php",data:"action=getRelatedInformation&pkey="+o.find("[name=hidSalesOrderKey]").val(),success:function(e){var a,e=JSON.parse(e);for(o.find('[name="hidItemKey[]"]').each(function(){$(this).closest(".transaction-detail-row").hasClass("detail-row-template")||$(this).closest(".transaction-detail-row").addClass("will-delete")}),a=0;a<e.length;a++){var n=o.find('[name="hidItemKey[]"][value=\''+e[a].itemkey+"']").closest(".transaction-detail-row");n.find('[name="qtyMinusInBaseUnit[]"]').first().val(e[a].qtyinbaseunit-e[a].deliveredqtyinbaseunit),n.removeClass("will-delete")}o.find(".inputnumber, .inputdecimal").blur(),o.find(".will-delete").remove()},complete:function(){decreaseActiveAjaxConnections(t)}})},this.updateTOP=function(){var e=o.find("[name=selTermOfPaymentKey]").val(),a=o.find("[name=hidSupplierKey]").val();$.ajax({type:"GET",url:"ajax-supplier.php",data:"action=getDataRowById&pkey="+a}).done(function(a){a=JSON.parse(a),a=a[0],1==d?(d=!d,t.updateCustomerInformation(a.termofpaymentkey)):e!=a.termofpaymentkey&&($("#dialog-message").html("Apakah Anda ingin mengganti data pembayaran dengan data default untuk pemasok ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pembayaran",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){t.updateCustomerInformation(a.termofpaymentkey),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}))})},this.updateCustomerInformation=function(e){o.find("[name=selTermOfPaymentKey] option[value='"+e+"']").length>0&&o.find("[name=selTermOfPaymentKey]").val(e).change()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",l,"ajax-item.php?action=searchData&itemtype=1")},this.loadOnReady=function(){o.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPaymentKey]").change(),t.rs&&1==t.rs.statuskey&&t.updateSalesDeliveryMinusQty(),o.find("[name=shipmentFee]").change(function(){t.calculateTotal(this)}),t.rebindEl()}}function WarehouseTransfer(e){var a=this,n=$("#"+e);this.tabID=e;var t=new Array;t.push({object:"hidItemKey[]",value:"pkey"}),t.push({object:"selUnit[]",value:"deftransunitkey"}),t.push({object:"hidNeedSN[]",value:"needsn"});var o=t,t=new Array;t.push({object:"hidItemDestKey[]",value:"pkey"}),t.push({object:"selDestUnit[]",value:"deftransunitkey"});var r=t;this.updateDetail=function(e,n,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(disabledButton(o.find("[name=btnMoreOptions]")),o.find(".options-row").hide(),i=0;i<n.length;i++)o.find("[name='"+n[i].object+"']").first().val(t.item[n[i].value]).change().blur();updateAvailableUnit(r,l),o.find('[name="itemName[]"]').first().val(decodeHTMLEntities(t.item.value)),o.find(".baseitemunit").html(t.item.baseunitname),1==t.item.needsn&&a.calculateSNNeeded(e),a.updateSNOptions(o)},this.updateDestinationDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),o=t.find('[name="hidItemDestKey[]"]').first(),r=t.find('[name="selDestUnit[]"]').first();for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).change().blur();updateAvailableUnit(o,r),t.find('[name="itemDestName[]"]').first().val(decodeHTMLEntities(n.item.value)),t.find(".baseitemunit").html(n.item.baseunitname)},this.updateSNOptions=function(e){var t=e?e:n.find(".transaction-detail-row");t.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),a.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:n.find(".transaction-detail-row"),detailRow.each(function(){1==$(this).find("[name='hidNeedSN[]']").val()&&0!=$(this).find(".options-row").is(":visible")&&($(this).find(".total-sn-label").show(),disabledButton($(this).find("[name=btnMoreOptions]"),!1),$(this).find(".options-row").show(),totalQty=$(this).find("[name='qty[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=$(this).find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.updateOptions=function(e){var n=$(e).closest(".transaction-detail-row"),t=n.find(".form-panel");if(t.is(":visible")){var o=!1;$varSN=n.find("[name='snList[]']").val();var r=$varSN.split(/[\n, ]+/);if($varSN="",r.length>0){for($varSN='<ul class="tag-list">',i=0;i<r.length;i++)0!=r[i].length&&($varSN+="<li>"+r[i]+"</li>",o=!0);$varSN+="<ul>"}o?n.find(".form-panel-result").html($varSN).show():n.find(".form-panel-result").html("").hide()}a.calculateSNNeeded(n)},this.rebindEl=function(){bindEl(n.find("[name='qty[]']"),"change",function(){a.calculateSNNeeded(this)}),bindEl(n.find(".btn-more-options"),"click",function(){a.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindAutoCompleteForTransactionDetail("itemName[]",o,"ajax-item.php?action=searchData&itemtype=1",getTabObj().updateDetail),bindAutoCompleteForTransactionDetail("itemDestName[]",r,"ajax-item.php?action=searchData&itemtype=1",getTabObj().updateDestinationDetail)},this.loadOnReady=function(){if(n.find(".transaction-detail-row").each(function(){a.calculateSNNeeded($(this))}),n.find("[name=btnAddDestinationRows]").on("click",function(){addNewTemplateRow("destination-row-template");bindAutoCompleteForTransactionDetail("itemDestName[]",r,"ajax-item.php?action=searchData&itemtype=1",getTabObj().updateDestinationDetail)}),n.find('[name="hidItemDestKey[]"]').length<=1){{addNewTemplateRow("destination-row-template")}bindAutoCompleteForTransactionDetail("itemDestName[]",r,"ajax-item.php?action=searchData&itemtype=1",getTabObj().updateDestinationDetail)}a.rebindEl()}}function WarrantyClaim(e){var a=this,n=$("#"+e),t=new Array;t=new Array,t.push({object:"hidItemkey[]",value:"pkey"});var t=new Array;t=new Array,t.push({object:"hidVendorPartNumberKey[]",value:"pkey"}),t.push({object:"itemName[]",value:"itemname"}),t.push({object:"hidItemKey[]",value:"itemkey"}),t.push({object:"hidTempItemKey[]",value:"itemkey"});var t=new Array;t.push({object:"hidIssueKey[]",value:"pkey"});var o=t;this.tabID=e,this.updateCustomerInformation=function(){var e=n.find("[name=hidCustomerKey]").val();e&&$.ajax({type:"GET",url:"ajax-customer.php",data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0];var a=e.address;n.find("[name=customerName]").val(e.name),n.find("[name=customerPhone]").val(e.phone),n.find("[name=customerEmail]").val(e.email),n.find("[name=customerAddress]").val(a),n.find("form").bootstrapValidator("revalidateField","customerPhone"),n.find("form").bootstrapValidator("revalidateField","customerEmail")})},this.updateItem=function(e){var a=$(e).closest(".transaction-detail-row"),n=a.find('[name="serialNumber[]"]').val();a.find(".reset-on-data-not-found input").val(""),a.find("[name='hidSNKey[]']").val(""),a.find(".date-diff").html("0"),clearAllRows(a.find(".content-of-package")),n&&$.ajax({type:"GET",url:"ajax-item.php",data:"action=searchSerialNumberInMarket&sn="+n}).done(function(e){e=JSON.parse(e),e.length>0?(e=e[0],a.find('[name="itemName[]"]').val(decodeHTMLEntities(e.itemname)),a.find('[name="hidItemKey[]"]').val(e.itemkey),a.find('[name="hidTempItemKey[]"]').val(e.itemkey),a.find('[name="vendorPartNumber[]"]').val(e.partnumber),a.find('[name="hidVendorPartNumberKey[]"]').val(e.vendorpartnumberkey),warrantyClaim.updateSNInformation(a),warrantyClaim.updateItemContent(a)):alert(phpErrorMsg[213])})},this.updateSNInformation=function(e){var a=e.find(".expired-date");a.removeClass("col-red-cardinal"),$.ajax({type:"GET",url:"ajax-sn.php",data:"action=getSNInformation&sn="+e.find('[name="serialNumber[]"]').val(),success:function(n){if(n){var n=JSON.parse(n);n=n[0];var t=""!=n.itemoutdate?moment(n.itemoutdate).format("DD / MM / YYYY"):"";e.find('[name="itemOutDate[]"]').val(t);var i=""!=n.warrantyperiodexpireddate?moment(n.warrantyperiodexpireddate).format("DD / MM / YYYY"):"";e.find('[name="warrantyPeriodExpiredDate[]"]').val(i),e.find('[name="hidSellerKey[]"]').val(n.recipientkey),e.find('[name="sellerName[]"]').val(n.recipientname),e.find(".date-diff").html(n.warrantyperiodexpireddatediff).blur(),n.warrantyperiodexpireddatediff<0&&a.addClass("col-red-cardinal")}}})},this.updateItemContent=function(e){loadOverlayScreen({content:_LOADING_TEMPLATE_}),a.activeAjaxConnections=0;var n="content-of-package-row-template";$.ajax({type:"GET",url:"ajax-item.php",beforeSend:function(){clearAllRows(e.find(".content-of-package")),a.activeAjaxConnections++},async:!1,data:"action=getItemPackageOfContent&pkey="+e.find('[name="hidItemKey[]"]').val(),success:function(t){if(t){var t=JSON.parse(t);for(i=0;i<t.length;i++){var o=[];o.push({selector:"qtyDetail",value:0}),o.push({selector:"itemNameDetail",value:t[i].itemchecklistname}),o.push({selector:"hidItemDetailKey",value:t[i].itemkey}),newrow=addNewTemplateRow(n,JSON.stringify(o),e),newrow.find(".inputnumber").blur()}decreaseActiveAjaxConnections(a)}},error:function(){decreaseActiveAjaxConnections(a)}})},this.updateIssueKey=function(e){var a=e.closest(".transaction-detail-row").find("[name='hidIssueKey[]']");a.val(e.val())},this.rebindEl=function(){bindEl(n.find("[name='serialNumber[]']"),"change",function(){a.updateItem($(this))}),bindAutoCompleteForTransactionDetail("issueName[]",o,"ajax-issue-category.php?action=searchData")},this.loadOnReady=function(){n.find(".section-panel .title").click(function(){$(this).closest(".section-panel").find(".section-panel-content").first().toggle()});var e=n.find(".item-row");e.each(function(){var e=$(this).find(".issue-list .transaction-detail-row");0==e.length&&addNewTemplateRow("issue-row-template",null,$(this),a.rebindEl)}),a.rebindEl()}}function WarrantyClaimProgress(e,a){var n=this,t=$("#"+e);this.tabID=e,this.updatePartNumberInformation=function(){var e=t.find("[name=newVendorPartNumber]").val();t.find("[name=newItemName]").val(""),t.find("[name=hidNewItemKey]").val(""),e&&$.ajax({type:"GET",url:"ajax-item.php",data:"action=searchVendorPartNumber&term="+e}).done(function(e){return e?(e=JSON.parse(e),e=e[0],t.find("[name=newItemName]").val(e.itemname),void t.find("[name=hidNewItemKey]").val(e.itemkey)):void alert(phpErrorMsg[213])})},this.updateNewItem=function(){var e=t.find("[name=newSerialNumber]").val();t.find("[name=newItemName]").val(""),t.find("[name=hidNewItemKey]").val(""),t.find("[name=newVendorPartNumber]").val(""),t.find("[name=hidNewVendorPartNumberKey]").val(""),e&&$.ajax({type:"GET",url:"ajax-item.php",data:"action=searchAvailableSerialNumber&sn="+e}).done(function(e){return e?(e=JSON.parse(e),e=e[0],t.find("[name=newItemName]").val(decodeHTMLEntities(e.itemname)),t.find("[name=hidNewItemKey]").val(e.itemkey),t.find("[name=newVendorPartNumber]").val(e.partnumber),void t.find("[name=hidNewVendorPartNumberKey]").val(e.vendorpartnumberkey)):void alert(phpErrorMsg[213])})},this.updateWarranty=function(){var e=t.find("[name=hidRefKey]").val();t.find("[name=customerName]").val(""),t.find("[name=hidCustomerKey]").val(""),$.ajax({type:"GET",url:"ajax-warranty-claim.php",data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e.length>0?(e=e[0],t.find("[name=customerName]").val(e.customername),t.find("[name=hidCustomerKey]").val(e.customerkey)):alert(phpErrorMsg[213])})},this.updateReplacementPanel=function(){var e=t.find("[name=selClaimResult]").val(),n=t.find(".replacement-panel");e==a.CLAIM_TYPE.replace||e==a.CLAIM_TYPE.upgrade?n.show():n.hide(),e==a.CLAIM_TYPE.replace&&(t.find("[name=newVendorPartNumber]").val(t.find("[name=vendorPartNumber]").val()),t.find("[name=hidNewVendorPartNumberKey]").val(t.find("[name=hidVendorPartNumberKey]").val()),t.find("[name=newItemName]").val(t.find("[name=itemName]").val()),t.find("[name=hidNewItemKey]").val(t.find("[name=hidItemKey]").val()),t.find("[name=newWarrantyDate]").val(t.find("[name=warrantyDate]").val()))},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=newSerialNumber]").change(function(){n.updateNewItem()}),t.find("[name=refCode]").change(function(){n.updateWarranty()}),t.find("[name=selClaimResult]").change(function(){n.updateReplacementPanel()}),n.rebindEl()}}function Marketplace(e){var a=this,n=$("#"+e);this.tabID=e,this.updateMarginDecimal=function(e){var a=$(e).parent().parent(),n=a.find("[name='marginValue']"),t=$(e).val();n.removeClass("inputnumber").addClass("inputdecimal"),1==t?n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this))}):n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this),2)}),n.blur()},this.updateDiscDecimal=function(e){var a=$(e).parent().parent(),n=a.find("[name='discountValue']"),t=$(e).val();n.removeClass("inputnumber").addClass("inputdecimal"),1==t?n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this))}):n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this),2)}),n.blur()},this.updatePriceType=function(e){1==e.val()?n.find(".isDiscount").hide():n.find(".isDiscount").show()},this.rebindEl=function(){},this.loadOnReady=function(){n.find("[name=selFinalPriceType]").change(function(){a.updatePriceType($(this))}),n.find("[name=selFinalPriceType]").change(),a.rebindEl()}}function SalesOrderCarService(e,a,n){var t=this,o=$("#"+e),r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"priceInUnit[]",value:"sellingprice"}),r.push({object:"isPackage[]",value:"ispackage"}),r.push({object:"selUnit[]",value:"deftransunitkey"});var l=r,r=new Array;r.push({object:"hidDetailSalesKey[]",value:"pkey"});var d=r,r=new Array;r.push({object:"hidDetailWarehouseKey[]",value:"pkey"});var c=r;this.tabID=e,this.rewritePackageDetail=function(e,a){var n="";if(a.length>0){for(n+='<div class="div-table" style="width: 400px">',n+='<div class="div-table-caption">'+phpLang.itemPackage+"</div>",i=0;i<a.length;i++)n+='<div class="div-table-row"><div class="div-table-col">'+a[i].itemname+'</div><div class="div-table-col input-number" style="width:40px;  text-align:right">'+a[i].qty+'</div><div class="div-table-col" style="width:100px">'+a[i].unitname+"</div></div>";
n+="</div>"}e.html(n),e.find(".input-number").formatCurrency()},this.updateRowsDetails=function(e,a,n){{var i=e.find(".options-row .summary-panel");e.find('[name="hidItemKey[]"]').first().val()}i.html(_LOADING_ICON_SMALL_).show();var o="ajax-item-package.php",r="action=getDetailById&pkey="+a;n&&(o="ajax-sales-order-car-service.php",r="action=getPackageDetail&detailkey="+a),$.ajax({type:"GET",url:o,data:r}).done(function(e){e=JSON.parse(e),t.rewritePackageDetail(i,e)})},this.updateConversionVariable=function(e,a){var n="ajax-item.php";1==a&&(n="ajax-item-package.php"),$.ajax({type:"GET",async:!1,url:n,data:"action=getAvailableConversion&itemkey="+e}).done(function(a){for(a=JSON.parse(a),t.conversion[e]={},i=0;i<a.length;i++)t.conversion[e][a[i].conversionunitkey]=a[i].conversionmultiplier})},this.updateDetail=function(e,a,n){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(r,l),o.find('[name="itemName[]"]').first().val(n.item.value),1==n.item.ispackage&&t.updateRowsDetails(o,n.item.pkey),t.calculateDetail(r)},this.calculateDetail=function(e){{var a=$(e).closest(".transaction-detail-row"),n=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=unformatCurrency(a.find("[name='discountValueInUnit[]']").val()),r=unformatCurrency(a.find("[name='selDiscountType[]']").val());a.find("[name='selUnit[]']").val()}0!=o&&2==r&&(o=o/100*i);var l=n*(i-o);a.find("[name='detailSubtotal[]']").val(l).blur(),t.calculateTotal()},this.calculateTotal=function(){var e=0;o.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find(" [name='subtotal']").val(e).blur();var a=parseFloat(unformatCurrency(o.find(" [name='finalDiscount']").val()))||0,n=parseInt(unformatCurrency(o.find(" [name='selFinalDiscountType']").val()))||0,i=parseInt(unformatCurrency(o.find(" [name='pointValue']").val()))||0,r=parseInt(unformatCurrency(o.find(" [name='shipmentFee']").val()))||0,l=parseInt(unformatCurrency(o.find(" [name='etcCost']").val()))||0,d=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0,c=o.find(" [name='chkIncludeTax']").val(),s=0;0!=a&&2==n&&(a=a/100*e),e-=a,e-=i,o.find("[name='beforeTaxTotal']").val(e).blur(),0==c?(s=e*d/100,e+=s):(s=d/(100+d)*e,o.find("[name='beforeTaxTotal']").val(e-s).blur()),o.find("[name='taxValue']").val(s).blur();var u=e+r+l;o.find(" [name='total']").val(u).blur();var m=parseInt(unformatCurrency(o.find("[name='totalPayment']").val())),f=m-u;o.find(" [name='balance']").val(f).blur(),t.calculateTax23()},this.calculateTax23=function(){var e=parseFloat(unformatCurrency(o.find("[name='tax23Percentage']").val()))||0,a=0;o.find("[name='chkIsTax23[]']").each(function(){if(1==$(this).val()){row=$(this).closest(".transaction-detail-row");{var e=unformatCurrency(row.find("[name='qty[]']").val()),n=unformatCurrency(row.find("[name='priceInUnit[]']").val()),t=unformatCurrency(row.find("[name='discountValueInUnit[]']").val()),i=unformatCurrency(row.find("[name='selDiscountType[]']").val());row.find("[name='selUnit[]']").val()}0!=t&&2==i&&(t=t/100*n);var o=e*(n-t);a+=o}});var n=1,t=0;if(0!=n&&e>0){var i=o.find("[name='chkIncludeTax']").val(),r=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;1==i&&(a-=r/(100+r)*a),t=e/100*a}o.find("[name='tax23Value']").val(t).blur()},this.updateCarInformation=function(){o.find(" [name=policeNumber]").val(""),o.find(" [name=year]").val(""),o.find(" [name=carSeriesName]").val(""),o.find(" [name=capacity]").val(""),o.find(" [name=fuelType]").val(""),o.find(" [name=hidCustomerKey]").val(""),o.find(" [name=customerName]").val(""),o.find(" [name=phone]").val(""),o.find(" [name=mobile]").val(""),o.find(" [name=email]").val("");var e=o.find(" [name=hidCarKey]").val();e&&$.ajax({type:"GET",url:"ajax-car.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),0!=e.length&&(e=e[0],o.find(" [name=policeNumber]").val(e.policenumber),o.find(" [name=year]").val(e.year),o.find(" [name=carSeriesName]").val(e.seriesname),o.find(" [name=capacity]").val(e.capacity).blur(),o.find(" [name=fuelType]").val(e.fueltype),o.find(" [name=hidCustomerKey]").val(e.customerkey),t.updateCustomerInformation())})},this.updateCustomerInformation=function(){o.find(" [name=customerName]").val(""),o.find(" [name=phone]").val(""),o.find(" [name=mobile]").val(""),o.find(" [name=email]").val("");var e=o.find(" [name=hidCustomerKey]").val();e&&$.ajax({type:"GET",url:"ajax-customer.php",async:!0,data:"action=getDataRowById&pkey="+e}).done(function(e){if(e=JSON.parse(e),0!=e.length){e=e[0],o.find(" [name=hidCustomerKey]").val(e.pkey),o.find(" [name=customerName]").val(e.name),o.find(" [name=phone]").val(e.phone),o.find(" [name=mobile]").val(e.mobile),o.find(" [name=email]").val(e.email);var a=e.taxid?2:4;o.find("[name='tax23Percentage']").val(a).change().blur()}})},this.updateRecipientsInformation=function(e){var a="";a=e.address,""!=e.address2&&(a+="\n"+e.address2),o.find(" [name=hidCreditLimit]").val(e.creditlimit),o.find(" [name=recipientName]").val(e.name),o.find(" [name=recipientPhone]").val(e.phone),o.find(" [name=recipientEmail]").val(e.email),o.find(" [name=recipientAddress]").val(a),o.find(" [name=selTermOfPaymentKey] option[value='"+e.termofpaymentkey+"']").length>0&&o.find(" [name=selTermOfPaymentKey]").val(e.termofpaymentkey).change()},this.importPayment=function(){var e=o.find(" [name=total]").val();o.find(" [name='paymentMethodValue[]']").each(function(e){e>0&&$(this).closest(".transaction-detail-row").remove()}),o.find(" [name='paymentMethodValue[]']").first().val(e).change().blur(),t.calculateTotal()},this.updateCustomerAndRecipients=function(){var e=o.find(" [name=hidCustomerKey]").val();o.find(" [name=hidCustomerKey]").val(""),o.find(" [name=customerName]").val(""),e&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),0==e.length||(e=e[0],o.find(" [name=hidCustomerKey]").val(e.pkey),o.find(" [name=customerName]").val(e.name),o.find("form").bootstrapValidator("revalidateField","customerName"));var a=!1,n=o.find(" [name=recipientName]").val(),i=o.find(" [name=recipientPhone]").val(),r=o.find(" [name=recipientEmail]").val(),l=o.find(" [name=recipientAddress]").val();if((""!=n||""!=i||""!=r||""!=l)&&(a=!0),0==a)t.updateRecipientsInformation(e);else{var d=this;$("#dialog-message").html("Apakah Anda ingin mengganti data pengiriman dan pembayaran dengan data default untuk pelanggan ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){$(d).closest("form").bootstrapValidator("revalidateField",$(d).attr("name"))},buttons:{OK:function(){t.updateRecipientsInformation(e),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}})},this.onCLickAddPayment=function(){$newRow=addNewTemplateRow("payment-method-row-template")},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",l,"ajax-item.php?action=searchData",t.updateDetail),bindAutoCompleteForTransactionDetail("detailSalesName[]",d,"ajax-employee.php?action=searchData&issales=1"),bindAutoCompleteForTransactionDetail("detailWarehouseName[]",c,"ajax-warehouse.php?action=searchData"),bindEl(o.find("[name='qty[]'], [name='priceInUnit[]'], [name='discountValueInUnit[]'],  [name='selUnit[]']"),"change",function(){t.calculateDetail(this)}),bindEl(o.find("[name='chkIsTax23[]']"),"change",function(){t.calculateDetail(this)}),bindEl(o.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),t.calculateDetail(this)}),bindEl(o.find(".btn-more-options"),"click",function(){mnvOptionsRowOnClick($(this))})},this.loadOnReady=function(){o.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPaymentKey]").change(),o.find(".form-detail-field").toggle(),o.find(".form-detail-button").click(function(){o.find(".form-detail-field").toggle("highlight");var e=o.find(".form-detail-button").attr("relalt");o.find(".form-detail-button").attr("relalt",o.find(".form-detail-button").text()),o.find(".form-detail-button").text(e)}),o.find("[name=chkIsTax23], [name=tax23Percentage]").change(function(){t.calculateTax23()}),o.find("[name=selFinalDiscountType], [name=finalDiscount], [name=beforeTaxTotal], [name=chkIncludeTax],[name=shipmentFee], [name=etcCost],[name=pointValue],[name=taxValue], [name=taxPercentage]").change(function(){t.calculateTotal(this)}),o.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),o.find(" [name=btnSaveEmail]").click(function(){o.find(" [name=hidSendEmail]").val(1),o.find(" #defaultForm").submit()}),o.find(" .btn-pay").on("click",function(){t.importPayment()}),t.rebindEl()}}function ItemPackage(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidItemKey[]",value:"pkey"}),t.push({object:"priceInUnit[]",value:"sellingprice"}),t.push({object:"selUnit[]",value:"deftransunitkey"});var o=t;this.tabID=e,this.updateCommissionDecimal=function(e){var a=$(e).closest(".div-table-row"),n=a.find("[name='commissionValue']"),t=$(e).val();n.removeClass("inputnumber").addClass("inputdecimal"),1==t?n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this))}):n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this),2)}),n.blur()},this.updateDetail=function(e,n,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<n.length;i++)o.find("[name='"+n[i].object+"']").first().val(t.item[n[i].value]).blur();var d={};d[t.item.baseunitkey]=t.item.baseunitname;var c=l.prop?l.prop("options"):l.attr("options");$("option",l).remove(),$.each(d,function(e,a){c[c.length]=new Option(a,e)}),o.find('[name="itemName[]"]').first().val(t.item.value),o.find(".baseitemunit").html(t.item.baseunitname),a.calculateDetail(r)},this.calculateDetail=function(e){{var n=$(e).closest(".transaction-detail-row"),t=(n.find("[name='hidItemKey[]']").val(),unformatCurrency(n.find("[name='qty[]']").val())),i=unformatCurrency(n.find("[name='priceInUnit[]']").val()),o=unformatCurrency(n.find("[name='discountValueInUnit[]']").val()),r=unformatCurrency(n.find("[name='selDiscountType[]']").val());n.find("[name='selUnit[]']").val()}0!=o&&2==r&&(o=o/100*i);var l=t*(i-o);n.find("[name='detailSubtotal[]']").val(l).blur(),a.calculateTotal()},this.calculateTotal=function(){var a=0;n.find("[name='detailSubtotal[]']").each(function(){a+=parseInt(unformatCurrency($(this).val()))||0}),n.find("[name='subtotal']").val(a).blur();var t=parseFloat(unformatCurrency($("#"+e+" [name='finalDiscount']").val()))||0,i=parseInt(unformatCurrency($("#"+e+" [name='selFinalDiscountType']").val()))||0;0!=t&&2==i&&(t=t/100*a),a-=t;var o=a;n.find("[name='total']").val(o).blur()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",o,"ajax-item.php?action=searchData",a.updateDetail),bindEl(n.find("[name='qty[]'],  [name='selUnit[]'], [name='priceInUnit[]'], [name='discountValueInUnit[]']"),"change",function(){a.calculateDetail(this)}),bindEl(n.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),a.calculateDetail(this)})},this.loadOnReady=function(){n.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),a.rebindEl(),a.calculateTotal()}}function TruckingCostCashOut(e,a,n,t){var i=this,o=$("#"+e),r=new Array;r.push({object:"hidCOAKey[]",value:"pkey"}),objAndValueForDetailAutoComplete=r,this.tabID=e;var l=a,d="item-file-uploader",c=Array(),s=o.find("[name=hidId]").val();this.calculateTotal=function(){var e=0;o.find("[name='amount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='subtotal']").val(e).blur();var a=parseInt(unformatCurrency(o.find("[name='arEmployee']").val()))||0,n=e-a;o.find("[name='total']").val(n).blur()},this.updateEmployeeInformation=function(){var e=o.find("[name=hidEmployeeKey]").val();$.ajax({type:"GET",url:"ajax-employee.php",data:"action=getDataRowById&pkey="+e,beforeSend:function(){o.find("[name=recipientMobile]").val(""),o.find("[name=recipientBankName]").val(""),o.find("[name=recipientBankAccountName]").val(""),o.find("[name=recipientBankAccountNumber]").val(""),o.find(".ar-employee").html("0")},success:function(e){if(e){var e=JSON.parse(e);if(e=e[0],!e)return;e.mobile&&o.find("[name=recipientMobile]").val(e.mobile),e.bankname&&o.find("[name=recipientBankName]").val(e.bankname),e.bankaccountname&&o.find("[name=recipientBankAccountName]").val(e.bankaccountname),e.bankaccountnumber&&o.find("[name=recipientBankAccountNumber]").val(e.bankaccountnumber);var a=1==t?e.aroutstanding:0;o.find("[name=arEmployee]").val(a).blur()}}})},this.updateEmployeeAROutstanding=function(){var e=o.find("[name=hidEmployeeKey]").val();$.ajax({type:"GET",url:"ajax-employee.php",data:"action=getDataRowById&pkey="+e,beforeSend:function(){o.find(".ar-employee").html("0")},success:function(e){if(e){var e=JSON.parse(e);e=e[0]}}})},this.updateReference=function(){$.ajax({type:"GET",url:"ajax-trucking-cost-cash-out.php",data:"action=searchAvailableReference&code="+o.find("[name=refCode]").val(),beforeSend:function(){o.find("[name=refCode2]").val(""),o.find("[name=hidRefKey2]").val(0)},success:function(e){if(e){var e=JSON.parse(e);o.find("[name=hidRefTable]").val(e[0].reftabletype),o.find("[name=refCode2]").val(e[0].refcode2),o.find("[name=hidRefKey2]").val(e[0].refkey2),o.find("[name=selWarehouse]").val(e[0].warehousekey),updateComboboxReadonly(o.find("[name=selWarehouse]")),updateComboboxReadonly(o.find("[name=hidRefTable]")),o.find("[name=employeeName]").val(e[0].employeename),o.find("[name=hidEmployeeKey]").val(e[0].employeekey),o.find("[name=customerName]").val(e[0].customername),o.find("[name=consigneeName]").val(e[0].consigneename),i.updateEmployeeInformation()}}})},this.importData=function(){var a=o.find("[name=btnImport]"),n=o.find("[name=refCode]"),t=o.find("[name=employeeName]"),r=o.find("[name=hidRefKey]").val(),l=o.find("[name=hidRefTable]").val(),d=o.find("[name=hidEmployeeKey]").val(),c=o.find("[name=selWarehouse]").val(),s=261==l?"ajax-trucking-service-work-order.php":"ajax-trucking-service-order.php";return r&&l&&c&&(261!=l||d)?(loadOverlayScreen({content:_LOADING_TEMPLATE_}),i.activeAjaxConnections=0,void $.ajax({type:"GET",url:s,beforeSend:function(){a.prop("disabled",!0),clearAllRows($("#defaultForm-"+e)),i.activeAjaxConnections++},data:"action=getUnCashedCostDetail&pkey="+r+"&warehousekey="+c+"&reftablekey="+l+"&employeekey="+d,success:function(e){if(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"refheadercostkey",value:e[a].pkey}),n.push({selector:"hidCostKey",value:e[a].costkey}),n.push({selector:"costName",value:e[a].name}),n.push({selector:"hidCOAKey",value:e[a].coakey}),n.push({selector:"COAName",value:e[a].coacodename}),n.push({selector:"amount",value:e[a].requestamount}),n.push({selector:"detailDesc",value:e[a].description}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(n))}i.rebindEl(),o.find(".inputnumber").change().blur()}},complete:function(){a.prop("disabled",!1),decreaseActiveAjaxConnections(i)}})):($("#defaultForm-"+e).bootstrapValidator("revalidateField",n.attr("name")),void $("#defaultForm-"+e).bootstrapValidator("revalidateField",t.attr("name")))},this.sendMessage=function(){var e="https://api.whatsapp.com/send?",a=o.find("[name=recipientMobile]").val();if(!a)return void alert(phpErrorMsg.phone[1]);var n="";o.find("[name='costName[]']:not(:disabled)").each(function(){""!=n&&(n+=", "),n+="*"+$(this).val()+"*"});var t=o.find("[name=total]").val()||0,i="Biaya operasional sebesar *Rp. "+t+"* untuk "+n+" telah ditransfer. Terima Kasih.";e+="phone="+waFormat(a),e+="&text="+encodeURIComponent(i),window.open(e,"_blank")},this.afterRemoveRowHandler=function(){i.calculateTotal()},this.rebindEl=function(){bindEl(o.find("[name='amount[]'] "),"change",function(){i.calculateTotal()}),bindAutoCompleteForTransactionDetail("COAName[]",objAndValueForDetailAutoComplete,"ajax-coa.php?action=searchData&iscashbank=1")},this.loadOnReady=function(){if(s){for($i=0;$i<n.length;$i++)c.push(n[$i].file);createFileUploader(d,l,s,c,!0)}else createFileUploader(d,l,"","",!0);o.find(".file-list").disableSelection(),o.find("[name=btnImport]").on("click",function(){i.importData()}),o.find(".wa-button").on("click",function(){i.sendMessage()}),o.find("[name=arEmployee]").change(function(){i.calculateTotal()}),i.updateEmployeeAROutstanding(),i.rebindEl()}}function SalesReturn(e){var a=this,n=$("#"+e);this.tabID=e,this.calculateDetail=function(e){var n=$(e).closest(".transaction-detail-row"),t=unformatCurrency(n.find("[name='qty[]']").val()),i=unformatCurrency(n.find("[name='priceInUnit[]']").val()),o=t*i;n.find("[name='detailSubtotal[]']").val(o).blur(),a.calculateTotal()},this.calculateTotal=function(){var e=0;n.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0});var a=e;n.find("[name='total']").val(a).blur();var t=parseInt(unformatCurrency(n.find("[name='totalPayment']").val())),i=t-a;n.find("[name='balance']").val(i).blur()},this.updateInformation=function(){var e=n.find("[name=hidRefKey]").val();$.ajax({type:"GET",url:"ajax-sales-order-car-service.php",beforeSend:function(){a.activeAjaxConnections++},data:"action=getDataRowById&pkey="+e,success:function(e){if(e){var e=JSON.parse(e);n.find("[name=customerName]").val(e[0].customername)}},complete:function(){decreaseActiveAjaxConnections(a)}}),$.ajax({type:"GET",url:"ajax-sales-order-car-service.php",beforeSend:function(){clearAllRows(n.find(".sales-return-detail")),a.activeAjaxConnections++},data:"action=getDetailById&pkey="+e,success:function(e){if(e){var t,e=JSON.parse(e);for(t=0;t<e.length;t++){var i=[];i.push({selector:"hidSODetailKey",value:e[t].pkey}),i.push({selector:"hidItemKey",value:e[t].itemkey}),i.push({selector:"itemName",value:e[t].itemname}),i.push({selector:"qty",value:e[t].qty}),i.push({selector:"selUnit",value:e[t].unitkey}),i.push({selector:"priceInUnit",value:e[t].total/e[t].qty}),i.push({selector:"detailSubtotal",value:e[t].total}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i)),updateComboboxReadonly($newRow.find("[name='selUnit[]']"))}n.find(".inputnumber").blur(),a.calculateDetail(),a.rebindEl()}},complete:function(){decreaseActiveAjaxConnections(a)}})},this.onChangePaymentMethodHandler=function(){a.calculateTotal()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.rebindEl=function(){bindEl(n.find("[name='qty[]']"),"change",function(){a.calculateDetail(this)})},this.loadOnReady=function(){a.rebindEl()}}function Brand(e,a,n){var t=this,i=$("#"+e),o=new Array;o.push({object:"hidMarketplaceBrandKey[]",value:"pkey"});var r=o;this.tabID=e;var l=a,d="item-image-uploader",c=Array(),s=Array(),u=i.find("[name=hidId]").val(),m="";this.rebindEl=function(){bindAutoCompleteForTransactionDetail("marketplaceBrandName[]",r,"ajax-marketplace.php?action=getMarketplaceBrand&marketplaceKey="+m)},this.loadOnReady=function(){if(u){for($i=0;$i<n.length;$i++)c.push(n[$i].file),s.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:d},{folder:l,token:u,arrImage:c,phpThumbHash:s},!1)}else createImageUploader({tabID:e,name:d},{folder:l},!1);i.find("[name='marketplaceBrandName[]']").focus(function(){m=$(this).closest(".marketplace-brand-row").find("[name='hidMarketplaceKey[]']").val(),t.rebindEl()}),t.rebindEl()}}function CashBankRealization(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidCostKey[]",value:"pkey"});var i=t;this.tabID=e,this.calculateDetail=function(e){var n=$(e).closest(".transaction-detail-row"),t=unformatCurrency(n.find("[name='qty[]']").val()),i=unformatCurrency(n.find("[name='amount[]']").val()),o=i/t;n.find("[name='realCostValue[]']").val(o).blur(),a.calculateTotal()},this.calculateTotal=function(){{var e=0,t=0;n.find("[name='amount[]']")}n.find("[name='hidSubtotalCostValue[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),n.find("[name=total]").val(e).blur(),n.find("[name='amount[]']").each(function(){t+=parseInt(unformatCurrency($(this).val()))||0}),n.find("[name='totalRealization']").val(t).blur();var i=e-t;n.find("[name='totalReceived']").val(i).blur();var o=parseInt(unformatCurrency(n.find("[name='totalPayment']").val())),r=parseInt(unformatCurrency(n.find("[name='employeeAR']").val())),l=o-i+r;l*=-1,n.find("[name='balance']").val(l).blur(),a.updateAccountSattlement()},this.updateReference=function(){$.ajax({type:"GET",url:"ajax-trucking-cost-cash-out.php",data:"action=getDataRowById&pkey="+n.find("[name=hidRefKey]").val(),beforeSend:function(){n.find("[name=refCode2]").val(""),n.find("[name=hidRefKey2]").val(0),n.find("[name=refCode3]").val(""),n.find("[name=hidRefKey3]").val(0),n.find("[name=hidRefTable]").val(0),n.find("[name=employeeName]").val(""),n.find("[name=hidEmployeeKey]").val(0),n.find("[name=customerName]").val(""),n.find("[name=consigneeName]").val(""),clearAllRows(n.find(".mnv-transaction"))},success:function(e){if(e){var e=JSON.parse(e);0!=e.length&&(n.find("[name=hidRefTable]").val(e[0].reftabletype),n.find("[name=refCode2]").val(e[0].refcode),n.find("[name=hidRefKey2]").val(e[0].refkey),n.find("[name=refCode3]").val(e[0].refcode2),n.find("[name=hidRefKey3]").val(e[0].refkey2),n.find("[name=selWarehouse]").val(e[0].warehousekey),updateComboboxReadonly(n.find("[name=selWarehouse]")),updateComboboxReadonly(n.find("[name=hidRefTable]")),n.find("[name=employeeName]").val(e[0].employeename),n.find("[name=hidEmployeeKey]").val(e[0].employeekey),n.find("[name=customerName]").val(e[0].customername),n.find("[name=consigneeName]").val(e[0].consigneename),a.importData())}}})},this.importData=function(){var t=n.find("[name=btnImport]"),i=(n.find("[name=hidEmployeeKey]").val(),n.find("[name=hidRefKey]").val());i&&(loadOverlayScreen({content:_LOADING_TEMPLATE_}),a.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-trucking-cost-cash-out.php",beforeSend:function(){t.prop("disabled",!0),clearAllRows($("#defaultForm-"+e)),a.activeAjaxConnections++},data:"action=getDetailById&pkey="+i,success:function(e){if(e){var t,e=JSON.parse(e);for(t=0;t<e.length;t++){var i=[],o=parseInt(unformatCurrency(e[t].qty))||0,r=parseInt(unformatCurrency(e[t].costvalue))||0,l=o*r;i.push({selector:"refheadercostkey",value:e[t].refheadercostkey}),i.push({selector:"hidCostKey",value:e[t].costkey}),i.push({selector:"costName",value:e[t].costname}),i.push({selector:"qty",value:o}),i.push({selector:"costValue",value:r}),i.push({selector:"realCostValue",value:r}),i.push({selector:"amount",value:e[t].amount}),i.push({selector:"hidSubtotalCostValue",value:l}),i.push({selector:"detailDesc",value:e[t].description}),i.push({selector:"hidSettlementType",value:1}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i))}a.rebindEl(),a.calculateTotal(),n.find(".inputnumber").change().blur()}},complete:function(){t.prop("disabled",!1),decreaseActiveAjaxConnections(a)}}))},this.updateAccountSattlement=function(){var e=parseInt(unformatCurrency(n.find("[name=balance]").val()));e>0?n.find(".account").show():n.find(".account").hide()},this.onChangePaymentMethodHandler=function(){a.calculateTotal()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("costName[]",i,"ajax-item.php?action=searchData&itemtype=2&serviceCost=1"),bindEl(n.find("[name='amount[]'], [name='qty[]'] "),"change",function(){a.calculateDetail($(this))})},this.loadOnReady=function(){n.find("[name=employeeAR]").change(function(){a.calculateTotal()}),a.rebindEl()}}function ItemCategory(e,a,n){var t=this,i=$("#"+e),o=new Array;o.push({object:"hidMarketplaceCategoryKey[]",value:"pkey"});var r=o,o=new Array;o.push({object:"hidStorefrontKey[]",value:"pkey"});var l=o;this.tabID=e;var d=a,c="item-image-uploader",s=Array(),u=Array(),m=i.find("[name=hidId]").val(),f="";this.rebindEl=function(){bindAutoCompleteForTransactionDetail("marketplaceCategoryName[]",r,"ajax-marketplace.php?action=getMarketplaceCategory&marketplaceKey="+f),bindAutoCompleteForTransactionDetail("marketplaceStorefrontName[]",l,"ajax-marketplace.php?action=getMarketplaceStorefront&marketplaceKey="+f)},this.loadOnReady=function(){if(m){for($i=0;$i<n.length;$i++)s.push(n[$i].file),u.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:c},{folder:d,token:m,arrImage:s,phpThumbHash:u},!1)}else createImageUploader({tabID:e,name:c},{folder:d},!1);i.find("[name='marketplaceCategoryName[]']").focus(function(){f=$(this).closest(".marketplace-category-row").find("[name='hidMarketplaceKey[]']").val(),t.rebindEl()}),i.find("[name='marketplaceStorefrontName[]']").focus(function(){f=$(this).closest(".marketplace-storefront-row").find("[name='hidStoreFrontMarketplaceKey[]']").val(),t.rebindEl()}),t.rebindEl()}}function VendorWarrantyClaim(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidItemKey[]",value:"pkey"}),t.push({object:"selUnit[]",value:"deftransunitkey"}),t.push({object:"COGS[]",value:"cogs"}),t.push({object:"hidNeedSN[]",value:"needsn"});var o=t,t=new Array;t.push({object:"hidVendorPartNumberKey[]",value:"pkey"}),t.push({object:"itemName[]",value:"itemname"}),t.push({object:"hidItemKey[]",value:"itemkey"}),t.push({object:"hidTempItemKey[]",value:"itemkey"}),t.push({object:"hidNeedSN[]",value:"needsn"}),t.push({object:"COGS[]",value:"cogs"});var r=t;this.tabID=e,this.updateDetail=function(e,n,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(disabledButton(o.find("[name=btnMoreOptions]")),o.find(".options-row").hide(),i=0;i<n.length;i++)o.find("[name='"+n[i].object+"']").first().val(t.item[n[i].value]).change().blur();if(updateAvailableUnit(r,l),o.find('[name="itemName[]"]').first().val(decodeHTMLEntities(t.item.value)),o.find(".baseitemunit").html(t.item.baseunitname),1==t.item.needsn&&a.calculateSNNeeded(e),o.find('[name="vendorPartNumber[]"]').is(":visible")){var d=o.find('[name="hidTempItemKey[]"]').first().val(),c=o.find('[name="hidItemKey[]"]').first().val();d!=c&&(o.find('[name="vendorPartNumber[]"]').first().val(""),o.find('[name="hidVendorPartNumberKey[]"]').first().val(""))}a.updateSNOptions(o)},this.updateItem=function(e,n,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<n.length;i++)o.find("[name='"+n[i].object+"']").first().val(decodeHTMLEntities(t.item[n[i].value]));o.find(".inputnumber").change().blur(),a.updateSNOptions(o),o.find('[name="vendorPartNumber[]"]').first().val(t.item.value),updateAvailableUnit(r,l)},this.updateSNOptions=function(e){var t=1;if(0==t)n.find(".btn-more-options").prop("disabled",!0),n.find(".options-row").hide();else{var i=e?e:n.find(".transaction-detail-row");i.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),a.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})}},this.showInternal=function(){n.find(".internal, .external").toggle()},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:n.find(".transaction-detail-row"),detailRow.each(function(){1==$(this).find("[name='hidNeedSN[]']").val()&&0!=$(this).find(".options-row").is(":visible")&&($(this).find(".total-sn-label").show(),disabledButton($(this).find("[name=btnMoreOptions]"),!1),$(this).find(".options-row").show(),totalQty=$(this).find("[name='qty[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=$(this).find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.calculateDetail=function(e){var n=$(e).closest(".transaction-detail-row"),t=(n.find("[name='hidItemKey[]']").val(),unformatCurrency(n.find("[name='qty[]']").val())),i=unformatCurrency(n.find("[name='priceInUnit[]']").val()),o=(n.find("[name='selUnit[]']").val(),t*i);n.find("[name='subtotal[]']").val(o).blur(),a.calculateTotal()},this.calculateTotal=function(){var e=0;n.find("[name='subtotal[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),n.find("[name='grandtotal']").val(e).blur()},this.updateOutstanding=function(e){var e=$(e),a=e.closest(".transaction-detail-row");a.find("[name='qtyOutstanding[]']").val(e.val()).blur()},this.updateOptions=function(e){var n=$(e).closest(".transaction-detail-row"),t=n.find(".form-panel");if(t.is(":visible")){var o=!1;$varSN=n.find("[name='snList[]']").val();var r=$varSN.split(/[\n, ]+/);if($varSN="",r.length>0){for($varSN='<ul class="tag-list">',i=0;i<r.length;i++)0!=r[i].length&&($varSN+="<li>"+r[i]+"</li>",o=!0);$varSN+="<ul>"}o?n.find(".form-panel-result").html($varSN).show():n.find(".form-panel-result").html("").hide()}a.calculateSNNeeded(n)},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",o,"ajax-item.php?action=searchData&itemtype=1",a.updateDetail),bindAutoCompleteForTransactionDetail("vendorPartNumber[]",r,"ajax-item.php?action=searchVendorPartNumber",a.updateItem),bindEl(n.find(".btn-more-options"),"click",function(){a.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindEl(n.find("[name='priceInUnit[]'],  [name='selUnit[]']"),"change",function(){a.calculateSNNeeded(this),a.calculateDetail(this)}),bindEl(n.find("[name='qty[]']"),"change",function(){a.updateOutstanding(this),a.calculateSNNeeded(this),a.calculateDetail(this)})},this.loadOnReady=function(){n.find(".transaction-detail-row").each(function(){a.calculateSNNeeded($(this))}),a.rebindEl()}}function AP(e,a,n){var t=this,i=$("#"+e);this.tabID=e,this.tablekey=a.TABLEKEY,this.updateCurrency=function(e){e=$(e);var n=i.find("[name=amount]"),t=i.find("[name=outstanding]");e.val()==a.CURRENCY.idr?(changeNumberDecimal(n,!0),changeNumberDecimal(t,!0)):(changeNumberDecimal(n,!1),changeNumberDecimal(t,!1)),n.blur(),t.blur()},this.updateAmount=function(){apTypeObj=i.find("[name=selAPType]"),amountObj=i.find("[name=amount]");var e=Math.abs(unformatCurrency(amountObj.val()));e*=n[apTypeObj.val()].contra,amountObj.val(e).blur()},this.rebindEl=function(){},this.loadOnReady=function(){i.find("[name=selCurrency]").on("change",function(){t.updateCurrency(this)}),i.find("[name=selCurrency]").change(),i.find("[name=selAPType],[name=amount]").on("change",function(){t.updateAmount()})}}function AR(e,a,n,t){var i=this,o=$("#"+e);this.tabID=e,this.tablekey=a,this.updateCurrency=function(e){e=$(e);var a=o.find("[name=amount]"),t=o.find("[name=outstanding]");e.val()==n.CURRENCY.idr?(changeNumberDecimal(a,!0),changeNumberDecimal(t,!0)):(changeNumberDecimal(a,!1),changeNumberDecimal(t,!1)),a.blur(),t.blur()},this.updateAmount=function(){arTypeObj=o.find("[name=selARType]"),amountObj=o.find("[name=amount]");var e=Math.abs(unformatCurrency(amountObj.val()));e*=t[arTypeObj.val()].contra,amountObj.val(e).blur(),i.updateTotalIDR()
},this.updateTotalIDR=function(){var e=unformatCurrency(o.find("[name=currencyRate]").val()),a=unformatCurrency(o.find("[name=amount]").val()),n=a*e;o.find("[name=amountIDR]").val(n).blur()},this.rebindEl=function(){},this.loadOnReady=function(){o.find("[name=selCurrency]").on("change",function(){i.updateCurrency(this)}),o.find("[name=selCurrency]").change(),o.find("[name=selARType],[name=currencyRate],[name=amount]").on("change",function(){i.updateAmount()})}}function TruckingServiceOrderInvoice(e,a,n){var t=this,o=$("#"+e);this.tabObj=o,this.tablekey=n.tablekey,this.customCodeCache=[];var r=new Array;r.push({object:"hidSalesOrderKey[]",value:"pkey"}),r.push({object:"salesOrderSubtotal[]",value:"grandtotal"}),r.push({object:"doNumberDetail[]",value:"donumber"}),r.push({object:"salesOrderDate[]",value:"trdate",type:"date"});var l=r,r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"selUnit[]",value:"deftransunitkey"});var d=r,r=new Array;r.push({object:"hidDownpaymentKey[]",value:"pkey"}),r.push({object:"downpaymentAmount[]",value:"outstanding"});var c=r;this.tabID=e,this.getDownpaymentType=function(){return 1==o.find("[name='chkDownpayment']").val()?!0:!1},this.updateDetail=function(e,a,n){var i=$(e).closest(".transaction-detail-row");t.updateRowInformation(i,a,n),t.updateSODetail(i),t.calculateTotal(),t.updateDefaultDownpayment()},this.updateRowInformation=function(e,a,n){var i;for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),e.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur(),t.updatePartialInvoiceOutstanding(e);t.calculateTotal(),e.find("[name='salesOrderCode[]']").first().val(n.item.value)},this.updatePartialInvoiceOutstanding=function(e){var a=o.find("[name=selCustomCode]").val(),n=e.find("[name='hidSalesOrderKey[]']").first().val();n&&$.ajax({type:"GET",url:"ajax-trucking-service-order.php",async:!1,data:"action=getTotalInvoicedAndOutstanding&pkey="+n+"&invoiceType="+a,success:function(a){var a=JSON.parse(a);e.find("[name='salesOrderDownpayment[]']").first().val(a.outstanding).blur()}})},this.checkDownpaymentExist=function(e){var a=!1;return o.find("[name='hidDownpaymentKey[]']").each(function(){return $(this).val()==e?void(a=!0):void 0}),a},this.updateDefaultDownpayment=function(){var e=new Array;o.find("[name='hidSalesOrderKey[]']").each(function(){$(this).val()&&e.push($(this).val())});var a=o.find("[name='selCurrency']").val();$.ajax({type:"GET",url:"ajax-customer-downpayment.php",data:"action=getDownpaymentForTruckingServiceOrderInvoice&sokey="+JSON.stringify(e)+"&currencykey="+a,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++)if(!t.checkDownpaymentExist(e[a].pkey)){var n=[];n.push({selector:"downpaymentCode",value:e[a].code}),n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"downpaymentAmount",value:e[a].outstanding}),updateTemplateRow("downpayment-row-template",JSON.stringify(n))}t.rebindDownpayment(),o.find('[name="downpaymentAmount[]"]').change().blur(),t.calculateTotalDownpayment()}})},this.calculateTotalDownpayment=function(){var e=0;return o.find("[name='downpaymentAmount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='totalDownpayment']").val(e).blur(),e},this.updateSODetail=function(e){var a=[];e.each(function(){a.push($(this).find('[name="hidSalesOrderKey[]"]').val())});var r=t.getDownpaymentType(),l="service-row-template";e.find(".options-row").hide(),$.ajax({type:"GET",url:"ajax-trucking-service-order.php",beforeSend:function(){e.find(".transaction-detail-row").remove()},async:!1,data:{action:"getUnInvoicedItemDetail",pkey:a},success:function(a){if(""!=a){var d=JSON.parse(a);e.each(function(){var e=$(this),a=e.find('[name="hidSalesOrderKey[]"]').val(),t=d[a];for(i=0;i<t.length;i++){var o=[];o.push({selector:"hidRefSODetailKey",value:t[i].pkey}),o.push({selector:"qtyDetail",value:t[i].outstandingqty}),o.push({selector:"itemNameDetail",value:t[i].itemname}),o.push({selector:"hidItemDetailKey",value:t[i].itemkey}),o.push({selector:"doNumberDetail",value:t[i].donumber}),o.push({selector:"itemNameAliasDetail",value:t[i].aliasname}),o.push({selector:"priceInUnitDetail",value:t[i].priceinunit}),o.push({selector:"taxDetail",value:t[i].taxpercentage}),o.push({selector:"subtotalDetail",value:t[i].total}),1==n.usePPNDetail&&(o.push({selector:"afterTaxDetail",value:t[i].total}),o.push({selector:"beforeTaxDetail",value:t[i].total})),newrow=addNewTemplateRow(l,JSON.stringify(o),e),newrow.addClass("service-detail-row"),newrow.find("[name='chkService[]']").val(1).change(),newrow.find("[name='chkIsTax23[]']").val(t[i].istax23).change(),newrow.find("[name='chkIncludeTaxDetail[]']").val(t[i].ispriceincludetax).change()}}),o.find(".inputnumber, .input-integer").blur(),t.calculateTotal(),!r&&a.length>0&&e.find(".options-row").show(),t.rebindEl(),o.find("[name='taxDetail[]']").change()}}})},this.updateOnChange=function(e){var a=$(e).closest(".transaction-detail-row");t.disabledAmount(a)},this.disabledAmount=function(e){var a=e.find("[name='selInvoiceType[]']").first().val();1==a?($readonly=!0,t.calculateTotal()):(e.find("[name='amount[]']").val(0),$readonly=!1),t.getDownpaymentType()||e.find("[name='amount[]']").prop("readonly",$readonly),$readonly?e.find("[name='amount[]']").attr("tabIndex","-1"):e.find("[name='amount[]']").removeAttr("tabIndex")},this.resetDetails=function(){clearAllRows($("#"+e)),t.calculateTotal()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.calculateServiceDetail=function(e){var a=$(e).closest(".service-detail-row"),i=parseFloat(unformatCurrency(a.find("[name='qtyDetail[]']").val()))||0,o=parseFloat(unformatCurrency(a.find("[name='priceInUnitDetail[]']").val()))||0,r=i*o;if(1==n.usePPNDetail){var l=parseFloat(unformatCurrency(a.find("[name='taxDetail[]']").val()))||0,d=a.find("[name='chkIncludeTaxDetail[]']").val()||0,c=0,s=r;l>0&&(0==d?c=r*l/100:(c=l/(100+l)*r,s-=c)),a.find("[name='beforeTaxDetail[]']").val(s),a.find("[name='afterTaxDetail[]']").val(s+c),a.find("[name='taxValueDetail[]']").val(c)}a.find("[name='subtotalDetail[]']").val(r),a.find(".inputnumber, .input-integer").blur(),t.calculateTotal()},this.calculateTax23=function(){var e=parseFloat(unformatCurrency(o.find("[name='tax23Percentage']").val()))||0,a=parseFloat(unformatCurrency(o.find("[name='hidTotalBeforeTaxPPH23']").val()))||0;if(1==n.usePPNDetail)i=e/100*a;else{var t=1,i=0;if(0!=t&&e>0){var r=o.find("[name='chkIncludeTax']").val(),l=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;1==r&&(a-=l/(100+l)*a),i=e/100*a}}o.find("[name='tax23Value']").val(i).blur()},this.calculateTotal=function(){var e=0,a=0,i=0,r=t.getDownpaymentType(),l=0;o.find("[name='chkPick[]']").each(function(){if(1==$(this).val()){if(row=$(this).closest(".transaction-detail-row"),objSubtotal=row.find("[name='salesOrderSubtotal[]']"),objDownpayment=row.find("[name='salesOrderDownpayment[]']"),objTotal=row.find("[name='amount[]']"),invoiceType=row.find("[name='selInvoiceType[]']").val(),1!=invoiceType||r)t=parseInt(unformatCurrency(row.find("[name='amount[]']").val()))||0;else{var t=0;row.find("[name='chkService[]']").each(function(){if(1==$(this).val()){var e=$(this).closest(".service-detail-row"),o=parseInt(unformatCurrency(e.find("[name='beforeTaxDetail[]']").val()))||0,r=parseInt(unformatCurrency(e.find("[name='subtotalDetail[]']").val()))||0,d=parseInt(unformatCurrency(e.find("[name='taxDetail[]']").val()))||0,c=parseInt(unformatCurrency(e.find("[name='taxValueDetail[]']").val()))||0;1==n.usePPNDetail&&(l+=o),t+=r,1==e.find("[name='chkIsTax23[]']").val()&&(a+=1==n.usePPNDetail?o:r),d>0&&(i+=c)}}),objSubtotal.val(t).blur(),downpayment=parseInt(unformatCurrency(objDownpayment.val())),t-=downpayment,0>t&&(t=0),objTotal.val(t).blur()}e+=t}});var d=e;o.find("[name='subtotal']").val(d).blur();var c=t.calculateTotalDownpayment(),s=parseFloat(unformatCurrency(o.find("[name='finalDiscount']").val()))||0,u=parseInt(unformatCurrency(o.find("[name='selFinalDiscountType']").val()))||0,m=o.find("[name='chkIncludeTax']").val(),f=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;0!=s&&2==u&&(s=s/100*d),d-=s;var h=d,p=0;1==n.usePPNDetail?(h=l,p=i,d=h+p):0==m?(p=d*f/100,d+=p):(p=f/(100+f)*d,h=d-p),o.find("[name='hidTotalBeforeTaxPPH23']").val(a).blur(),o.find("[name='beforeTaxTotal']").val(h).blur(),o.find("[name='taxValue']").val(p).blur();var v=d;o.find("[name='total']").val(v).blur();var y=0;o.find("[name='paymentMethodValue[]']").each(function(){y+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(y).blur();var b=y+c-v;o.find("[name='balance']").val(b).blur(),t.calculateTax23()},this.resetDetails=function(){clearAllRows(o.find(".mnv-transaction")),clearAllRows(o.find(".mnv-downpayment")),addNewTemplateRow("downpayment-row-template"),t.rebindDownpayment(),t.calculateTotal()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0;var e=o.find("[name=hidCustomerKey]").val(),a=t.getDownpaymentType()?"downpayment":"sales";$.ajax({type:"GET",url:"ajax-trucking-service-order.php",beforeSend:function(){t.resetDetails(),t.activeAjaxConnections++},data:"action=searchDataForInvoice&statustype="+a+"&customerkey="+e,success:function(e){var a,n,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidSalesOrderKey",value:e[a].pkey}),i.push({selector:"salesOrderCode",value:e[a].value}),i.push({selector:"salesOrderSubtotal",value:e[a].grandtotal}),i.push({selector:"doNumberDetail",value:e[a].donumber}),i.push({selector:"salesOrderDate",value:moment(e[a].trdate).format(_DATE_FORMAT_)}),n=addNewTemplateRow("detail-row-template",JSON.stringify(i)),t.updatePartialInvoiceOutstanding(n)}t.updateFieldOnChangeInvoiveDownpayment(),t.rebindEl(),o.find(".inputnumber, .input-integer, .inputdecimal").blur(),t.calculateTotal(),decreaseActiveAjaxConnections(t),o.find("[name='chkPick-master']").val(1).change(),t.updateDefaultDownpayment()},error:function(){decreaseActiveAjaxConnections(t)}})},this.onChangeChk=function(){t.calculateTotal()},this.rebindDownpayment=function(){var e=o.find("[name=hidCustomerKey]").val()||0;bindAutoCompleteForTransactionDetail("downpaymentCode[]",c,"ajax-customer-downpayment.php?action=searchData&customerkey="+e+"&currencykey="+o.find("[name=selCurrency]").val())},this.updateCustomerInformation=function(e,a,n){var i=0,r=0;if(""!=o.find("[name=hidCurrentCustomerKey]").val())$("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){o.find("[name=hidCustomerKey]").val(o.find("[name=hidCurrentCustomerKey]").val()),o.find("[name=customerName]").val(o.find("[name=hidCurrentCustomerName]").val()),$(e).closest("form").bootstrapValidator("revalidateField",$(e).attr("name")),t.rebindEl()},buttons:{OK:function(){if(null==n.item)clearAutoCompleteInput(e,"hidCustomerKey"),o.find("[name=hidCurrentCustomerKey]").val(""),o.find("[name=hidCurrentCustomerName]").val("");else{o.find("[name=hidCurrentCustomerKey]").val(n.item.pkey),o.find("[name=hidCurrentCustomerName]").val(n.item.value);var a=n.item.taxid?2:4;o.find("[name='tax23Percentage']").val(a).change().blur(),i=n.item.termofpaymentkey,r=n.item.companybankkey}t.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});else{if(null==n.item)clearAutoCompleteInput(e,"hidCustomerKey"),o.find("[name=hidCurrentCustomerKey]").val(""),o.find("[name=hidCurrentCustomerName]").val("");else{o.find("[name=hidCurrentCustomerKey]").val(n.item.pkey),o.find("[name=hidCurrentCustomerName]").val(n.item.value);var l=n.item.taxid?2:4;o.find("[name='tax23Percentage']").val(l).change().blur(),i=n.item.termofpaymentkey,r=n.item.companybankkey}t.rebindEl()}o.find("[name=selTermOfPayment] option[value='"+i+"']").length>0&&o.find("[name=selTermOfPayment]").val(i).change(),o.find("[name=selBank] option[value='"+r+"']").length>0&&o.find("[name=selBank]").val(r)},this.changeInvoiceType=function(e){var a=$(e).val();$row=$(e).closest(".transaction-detail-row");var n=$row.find(".service-detail-row");$row.find("[class*=type-]").hide(),$row.find(".type-"+a).show(),$row.find(".options-row").hide(),1==a&&n.length>0&&$row.find(".options-row").show(),t.disabledAmount($row),t.calculateTotal()},this.updateFieldOnChangeInvoiveDownpayment=function(e){var a=e?e:o.find(".invoice-detail > .transaction-detail-row"),n=t.getDownpaymentType();n||t.updateSODetail(a),a.each(function(){{var e=$(this).find('[name="selInvoiceType[]"]'),a=$(this).find('[name="amount[]"]'),t=$(this).find(".options-row"),i=o.find(".not-downpayment-field");$(this).find('[name="salesOrderCode[]"]')}n?(i.hide(),o.find("[name=finalDiscount]").val(0),o.find("[name=selFinalDiscountType]").val(1),1!=e.val()?$(this).remove():(e.prop("disabled",!0),a.prop("readonly",!1),t.hide())):(i.show(),e.prop("disabled",!1),1==e.val()?(a.prop("readonly",!0),$(this).find(".options-row .transaction-detail-row").length>0&&t.show()):a.prop("readonly",!1))})},this.updateInvoiceType=function(e,a){var n=!0,i=$(a).val();$("#dialog-message").html("Merubah jenis faktur akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Jenis Faktur",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){n&&o.find("[name=chkDownpayment]").val(i).change()},buttons:{OK:function(){t.updateFieldOnChangeInvoiveDownpayment(),t.rebindEl(),n=!1,$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})},this.onChangePaymentMethodHandler=function(){t.calculateTotal(),t.rebindDownpayment()},this.afterRemoveRowHandler=function(){t.calculateTotal(),t.updateDefaultDownpayment()},this.showInvoiceRef=function(e){$obj=$(e),1==$obj.val()?o.find(".invoice-ref").hide():o.find(".invoice-ref").show()},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pelanggan ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.find("[name=hidCurrentCurrencyKey]").val(o.find("[name=selCurrency]").val()),t.resetDetails(),$(this).dialog("close")},Cancel:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.checkVA=function(e){var a=$(e).find("option:selected").attr("rel-va");1==a?o.find(".va-col").show():o.find(".va-col").hide()},this.afterAddNewTemplateRowHandler=function(){},this.rebindEl=function(){var e=[];e.onSelectFunction="getTabObj().updateDetail",e.onChangeFunction="getTabObj().updateOnChange";var a=o.find("[name=hidCustomerKey]").val(),n=t.getDownpaymentType()?"downpayment":"sales";bindAutoCompleteForTransactionDetail("salesOrderCode[]",l,"ajax-trucking-service-order.php?action=searchDataForInvoice&statustype="+n+"&customerkey="+a,e),bindAutoCompleteForTransactionDetail("itemName[]",d,"ajax-item.php?action=searchData&itemtype=2&serviceCost=1"),bindEl(o.find("[name='selInvoiceType[]']"),"change",function(){t.changeInvoiceType(this)}),bindEl(o.find("[name='amount[]'], [name='chkService[]'],[name='taxDetail[]'], [name='chkIsTax23[]']"),"change",function(){t.calculateTotal()}),bindEl(o.find("[name='qtyDetail[]'],[name='taxDetail[]'],[name='chkIncludeTaxDetail[]']"),"change",function(){t.calculateServiceDetail(this)}),bindEl(o.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,t.onChangeChk)});var i=o.find(".mnv-downpayment");bindEl(i.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(t,i,"downpayment-row-template")}),bindEl(i.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(t,i,"downpayment-row-template")}),t.rebindDownpayment()},this.loadOnReady=function(){o.find("[name=selTermOfPayment]").change(function(){for(i=0;i<a.length;i++)if($(this).val()==a[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selCustomCode]").change(function(){t.showInvoiceRef(this),o.find("[name='salesOrderCode[]']").each(function(){detailRow=$(this).closest(".transaction-detail-row"),t.updatePartialInvoiceOutstanding(detailRow)}),t.calculateTotal()}),o.find("[name=selTermOfPayment]").change(),o.find("[name=btnImport]").on("click",function(){t.importData()}),o.find("[name=chkDownpayment]").change(function(){t.updateInvoiceType(this)}),o.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,t.onChangeChk)}),o.find("[name=chkTax23], [name=tax23Percentage]").change(function(){t.calculateTax23()}),o.find("[name=beforeTaxTotal], [name=chkIncludeTax], [name=selFinalDiscountType], [name=taxPercentage], [name=finalDiscount]").change(function(){t.calculateTotal(this)}),o.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),o.find("[name=selCurrency]").change(function(){t.updateCurrency()}),o.find("[name=selBank]").change(function(){t.checkVA(this)}),addNewTemplateRow("downpayment-row-template"),o.find("[name='chkPick-master']").val(1).change(),customCodeHandler(t),t.rebindEl()}}function VendorWarrantyClaimReturn(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidItemKey[]",value:"pkey"}),t.push({object:"selUnit[]",value:"deftransunitkey"}),t.push({object:"COGS[]",value:"cogs"}),t.push({object:"hidNeedSN[]",value:"needsn"});var o=t,t=new Array;t.push({object:"hidOldItemKey[]",value:"pkey"}),t.push({object:"hidOldNeedSN[]",value:"needsn"});var r=t,t=new Array;t.push({object:"hidVendorPartNumberKey[]",value:"pkey"}),t.push({object:"itemName[]",value:"itemname"}),t.push({object:"hidItemKey[]",value:"itemkey"}),t.push({object:"hidTempItemKey[]",value:"itemkey"}),t.push({object:"hidNeedSN[]",value:"needsn"}),t.push({object:"COGS[]",value:"cogs"});var l=t;this.tabID=e,this.updateDetail=function(e,n,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(disabledButton(o.find("[name=btnMoreOptions]")),o.find(".options-row").hide(),i=0;i<n.length;i++)o.find("[name='"+n[i].object+"']").first().val(t.item[n[i].value]).change().blur();if(updateAvailableUnit(r,l),o.find('[name="itemName[]"]').first().val(decodeHTMLEntities(t.item.value)),o.find(".baseitemunit").html(t.item.baseunitname),1==t.item.needsn&&a.calculateSNNeeded(e),o.find('[name="vendorPartNumber[]"]').is(":visible")){var d=o.find('[name="hidTempItemKey[]"]').first().val(),c=o.find('[name="hidItemKey[]"]').first().val();d!=c&&(o.find('[name="vendorPartNumber[]"]').first().val(""),o.find('[name="hidVendorPartNumberKey[]"]').first().val(""))}a.updateSNOptions(o)},this.updateItem=function(e,n,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<n.length;i++)o.find("[name='"+n[i].object+"']").first().val(decodeHTMLEntities(t.item[n[i].value]));o.find(".inputnumber").change().blur(),a.updateSNOptions(o),o.find('[name="vendorPartNumber[]"]').first().val(t.item.value),updateAvailableUnit(r,l)},this.updateSNOptions=function(e){var t=1;if(0==t)n.find(".btn-more-options").prop("disabled",!0),n.find(".options-row").hide();else{var i=e?e:n.find(".transaction-detail-row");i.each(function(){var e=$(this).find('[name="hidNeedSN[]"]').val();1==e?($(this).find(".btn-more-options").prop("disabled",!1),$(this).find(".options-row").show(),a.calculateSNNeeded($(this))):($(this).find(".btn-more-options").prop("disabled",!0),$(this).find(".options-row").hide())})}},this.showInternal=function(){n.find(".internal, .external").toggle()},this.calculateSNNeeded=function(e){detailRow=e?e.nodeType?$(e).closest(".transaction-detail-row"):e:n.find(".transaction-detail-row"),detailRow.each(function(){1==$(this).find("[name='hidNeedSN[]']").val()&&0!=$(this).find(".options-row").is(":visible")&&($(this).find(".total-sn-label").show(),disabledButton($(this).find("[name=btnMoreOptions]"),!1),$(this).find(".options-row").show(),totalQty=$(this).find("[name='qty[]']").val(),totalQty=unformatCurrency(totalQty),totalSN=$(this).find(".tag-list li").length,remaining=totalSN-totalQty,$(this).find(".total-sn-remaining").html(remaining),$(this).find(".total-sn-label").removeClass("text-red-cardinal text-blue-munsell"),0>remaining?$(this).find(".total-sn-label").addClass("text-red-cardinal"):remaining>0&&$(this).find(".total-sn-label").addClass("text-blue-munsell"))})},this.calculateDetail=function(e){var t=$(e).closest(".transaction-detail-row"),i=(t.find("[name='hidItemKey[]']").val(),unformatCurrency(n.find("[name='currencyRate']").val()),unformatCurrency(t.find("[name='qty[]']").val())),o=unformatCurrency(t.find("[name='priceInUnit[]']").val()),r=(t.find("[name='selUnit[]']").val(),i*o);t.find("[name='subtotal[]']").val(r).blur(),a.calculateTotal()},this.calculateTotal=function(){var e=0;n.find("[name='subtotal[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),n.find("[name='grandtotal']").val(e).blur()},this.updateOutstanding=function(e){var e=$(e),a=e.closest(".transaction-detail-row");a.find("[name='qtyOutstanding[]']").val(e.val()).blur()},this.updateOptions=function(e,n){var t=$(e).closest(".transaction-detail-row"),o=t.find(".form-panel");if(o.is(":visible")||n){var r=!1,l=!1;$varSN=t.find("[name='snList[]']").val(),$varSNReplacement=t.find("[name='snReplacementList[]']").val();var d=$varSN.split(/[\n, ]+/),c=$varSNReplacement.split(/[\n, ]+/);if($varSN="",d.length>0){for($varSN='<ul class="tag-list">',i=0;i<d.length;i++)0!=d[i].length&&($varSN+="<li>"+d[i]+"</li>",r=!0);$varSN+="<ul>"}if($varSNReplacement="",c.length>0){for($varSNReplacement='<ul class="tag-list-replacement">',i=0;i<c.length;i++)0!=c[i].length&&($varSNReplacement+="<li>"+c[i]+"</li>",l=!0);$varSNReplacement+="<ul>"}r?t.find(".form-panel-result-rma").html($varSN).show():t.find(".form-panel-result-rma").html("").hide(),l?t.find(".form-panel-result-replacement").html($varSNReplacement).show():t.find(".form-panel-result-replacement").html("").hide()}a.calculateSNNeeded(t)},this.updateClaimInformation=function(){$.ajax({type:"GET",url:"ajax-vendor-warranty-claim.php",data:"action=getDataRowById&pkey="+n.find("[name=hidRefKey]").val(),beforeSend:function(){n.find("[name=hidSupplierKey]").val(""),n.find("[name=supplierName]").val(""),n.find("[name=selCurrency]").prop("selectedIndex",0).change(),n.find("[name=currencyRate]").val(1).blur()},success:function(e){if(e){var e=JSON.parse(e);n.find("[name=hidSupplierKey]").val(e[0].recipientkey),n.find("[name=supplierName]").val(e[0].recipientname),n.find("[name=selCurrency]").val(e[0].currencykey).change(),n.find("[name=currencyRate]").val(e[0].rate).blur()}}})},this.importData=function(){{var t=n.find("[name=btnImport]");n.find("[name=hidRefKey]").val()}loadOverlayScreen({content:_LOADING_TEMPLATE_}),a.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-vendor-warranty-claim.php",beforeSend:function(){t.prop("disabled",!0),clearAllRows($("#defaultForm-"+e)),a.activeAjaxConnections++},async:!1,data:"action=getDetailById&pkey="+n.find("[name=hidRefKey]").val(),success:function(e){if(e){var t,e=JSON.parse(e);for(t=0;t<e.length;t++){var i=[];i.push({selector:"hidClaimDetailKey",value:e[t].pkey}),i.push({selector:"hidItemKey",value:e[t].itemkey}),i.push({selector:"hidOldItemKey",value:e[t].itemkey}),i.push({selector:"itemName",value:e[t].itemname}),i.push({selector:"oldItemName",value:e[t].itemname}),i.push({selector:"qty",value:e[t].qty}),i.push({selector:"unitkey",value:e[t].unitkey}),i.push({selector:"qtyOutstanding",value:e[t].qtyoutstanding}),i.push({selector:"hidNeedSN",value:e[t].needsn}),i.push({selector:"hidVendorPartNumberKey",value:e[t].vendorpartnumberkey}),i.push({selector:"vendorPartNumber",value:e[t].partnumber}),i.push({selector:"hidTempItemKey",value:e[t].itemkey}),i.push({selector:"priceInUnit",value:e[t].priceinunit});var o="";$.ajax({type:"GET",url:"ajax-vendor-warranty-claim.php",async:!1,data:"action=getSNDetail&pkey="+e[t].pkey,success:function(e){if(e){var e=JSON.parse(e);o=e}}}),i.push({selector:"snList",value:o}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i)),a.updateSNOptions($newRow)}a.rebindEl(),n.find(".transaction-detail-row").each(function(){a.updateOptions(this,!0)}),n.find(".inputnumber, .inputdecimal").change().blur()}},complete:function(){t.prop("disabled",!1),decreaseActiveAjaxConnections(a)}})},this.updateRate=function(){n.find(".transaction-detail-row").each(function(){a.calculateDetail($(this))})},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",o,"ajax-item.php?action=searchData&itemtype=1",a.updateDetail),bindAutoCompleteForTransactionDetail("oldItemName[]",r,"ajax-item.php?action=searchData&itemtype=1"),bindAutoCompleteForTransactionDetail("vendorPartNumber[]",l,"ajax-item.php?action=searchVendorPartNumber",a.updateItem),bindEl(n.find(".btn-more-options"),"click",function(){a.updateOptions(this),mnvOptionsRowOnClick($(this))}),bindEl(n.find("[name='priceInUnit[]'],  [name='selUnit[]']"),"change",function(){a.calculateSNNeeded(this),a.calculateDetail(this)}),bindEl(n.find("[name='qty[]']"),"change",function(){a.updateOutstanding(this),a.calculateSNNeeded(this),a.calculateDetail(this)})},this.loadOnReady=function(){n.find(".transaction-detail-row").each(function(){a.calculateSNNeeded($(this)),a.calculateDetail($(this))}),n.find("[name=btnImport]").on("click",function(){a.importData()}),n.find("[name=currencyRate]").on("change",function(){a.updateRate()}),a.rebindEl()}}function EMKLOrderInvoice(e,a,n,t){var o=this,r=$("#"+e),l=new Array;l.push({object:"hidSalesOrderKey[]",value:"pkey"}),l.push({object:"salesOrderSubtotal[]",value:"subtotalcurrency"}),l.push({object:"doNumberDetail[]",value:"hbl"});var d=l,l=new Array;l.push({object:"hidItemKey[]",value:"pkey"}),l.push({object:"selUnit[]",value:"deftransunitkey"});var c=l,l=new Array;l.push({object:"hidInvoiceKey[]",value:"pkey"}),l.push({object:"amount[]",value:"grandtotal"}),l.push({object:"salesOrderSubtotal[]",value:"grandtotal"});var s=l,l=new Array;l.push({object:"hidDownpaymentKey[]",value:"pkey"}),l.push({object:"downpaymentAmount[]",value:"outstanding"});var u=l;this.tabID=e,this.tablekey=a,this.recordedCode=[],this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");o.updateRowInformation(t,a,n),o.updateSODetail(t),o.calculateTotal(),o.updateDefaultDownpayment()},this.updateDetailForInvoice=function(e,a,n){var t=$(e).closest(".transaction-detail-row");o.updateRowInvoiceInformation(t,a,n),o.updateInvoiceDetail(t),o.calculateTotal()},this.updateRowInvoiceInformation=function(e,a,n){var t;for(t=0;t<a.length;t++)e.find("[name='"+a[t].object+"']").first().val(n.item[a[t].value]).blur();o.calculateTotal(),e.find("[name='invoiceCode[]']").first().val(n.item.value)},this.updateRowInformation=function(e,a,n){var t;for(t=0;t<a.length;t++)e.find("[name='"+a[t].object+"']").first().val(n.item[a[t].value]).blur(),o.updatePartialInvoiceOutstanding(e);o.calculateTotal(),e.find("[name='salesOrderCode[]']").first().val(n.item.value)},this.updatePartialInvoiceOutstanding=function(){},this.checkDownpaymentExist=function(e){var a=!1;return r.find("[name='hidDownpaymentKey[]']").each(function(){return $(this).val()==e?void(a=!0):void 0}),a},this.updateDefaultDownpayment=function(){var e=new Array;r.find("[name='hidSalesOrderKey[]']").each(function(){$(this).val()&&e.push($(this).val())}),$.ajax({type:"GET",url:"ajax-customer-downpayment.php",data:"action=getDownpaymentForTruckingServiceOrderInvoice&sokey="+JSON.stringify(e),success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++)if(!o.checkDownpaymentExist(e[a].pkey)){var n=[];n.push({selector:"downpaymentCode",value:e[a].code}),n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"downpaymentAmount",value:e[a].outstanding}),updateTemplateRow("downpayment-row-template",JSON.stringify(n))}o.rebindDownpayment(),r.find('[name="downpaymentAmount[]"]').change().blur(),o.calculateTotalDownpayment()}})},this.calculateTotalDownpayment=function(){var e=0;return r.find("[name='downpaymentAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),r.find("[name='totalDownpayment']").val(e).blur(),e},this.updateSODetail=function(e){var a=[];e.each(function(){a.push($(this).find('[name="hidSalesOrderKey[]"]').val())});{var n="service-row-template";r.find(" [name=selCurrency]").val()}e.find(".options-row").hide(),$.ajax({type:"GET",url:"ajax-emkl-job-order.php",beforeSend:function(){e.find(".transaction-detail-row").remove()},async:!1,data:{action:"getUnInvoicedItemDetail",pkey:a},success:function(a){if(""!=a){var t=JSON.parse(a);e.each(function(){var e=$(this),a=e.find('[name="hidSalesOrderKey[]"]').val(),o=t[a];for(i=0;i<o.length;i++){var r=[];r.push({selector:"hidRefSODetailKey",value:o[i].pkey}),r.push({selector:"qtyDetail",value:o[i].outstandingqty}),r.push({selector:"itemNameDetail",value:o[i].itemname}),r.push({selector:"itemNameAliasDetail",value:o[i].aliasname}),r.push({selector:"hidItemDetailKey",value:o[i].itemkey}),r.push({selector:"priceInUnitDetail",value:o[i].priceinunit}),r.push({selector:"subtotalDetail",value:o[i].total}),r.push({selector:"detailRate",value:o[i].rate}),r.push({selector:"currencyName",value:o[i].currencyname}),r.push({selector:"hidCurrencyKey",value:o[i].currencykey}),newrow=addNewTemplateRow(n,JSON.stringify(r),e),newrow.addClass("service-detail-row"),newrow.find("[name='chkService[]']").val(1).change(),newrow.find("[name='chkIsTax23[]']").val(o[i].istax23).change()}}),r.find(".inputnumber, .inputdecimal, .inputautodecimal").blur(),o.calculateTotal(),a.length>0&&e.find(".options-row").show(),o.rebindEl(),r.find("[name='detailRate[]']").change()}}})},this.updateInvoiceDetail=function(e){var a=[];e.each(function(){a.push($(this).find('[name="hidInvoiceKey[]"]').val())});var n="service-row-template",t=(r.find(" [name=selCurrency]").val(),"ajax-emkl-order-invoice.php"),l="getInvoiceItemDetail";e.find(".options-row").hide(),$.ajax({type:"GET",url:t,beforeSend:function(){e.find(".transaction-detail-row").remove()},async:!1,data:{action:l,pkey:a},success:function(a){if(""!=a){var t=JSON.parse(a);e.each(function(){var e=$(this),a=e.find('[name="hidInvoiceKey[]"]').val(),o=t[a];for(i=0;i<o.length;i++){var r=[];r.push({selector:"hidRefSODetailKey",value:o[i].refsodetailkey}),r.push({selector:"qtyDetail",value:o[i].qtyinbaseunit}),r.push({selector:"itemNameDetail",value:o[i].itemname}),r.push({selector:"itemNameAliasDetail",value:o[i].aliasname}),r.push({selector:"hidItemDetailKey",value:o[i].itemkey}),r.push({selector:"priceInUnitDetail",value:o[i].priceinunit}),r.push({selector:"subtotalDetail",value:o[i].total}),r.push({selector:"detailRate",value:o[i].rate}),r.push({selector:"currencyName",value:o[i].currencyname}),r.push({selector:"hidCurrencyKey",value:o[i].currencykey}),newrow=addNewTemplateRow(n,JSON.stringify(r),e),newrow.addClass("service-detail-row"),newrow.find("[name='chkService[]']").val(1).change(),newrow.find("[name='chkIsTax23[]']").val(o[i].istax23).change()}}),r.find(".inputnumber, .inputdecimal, .inputautodecimal").blur(),o.calculateTotal(),a.length>0&&e.find(".options-row").show(),o.rebindEl(),r.find("[name='detailRate[]']").change()}}})},this.showInvoiceRef=function(e){$obj=$(e),25==$obj.val()?r.find(".invoice-ref").show():r.find(".invoice-ref").hide()
},this.updateOnChange=function(e){$(e).closest(".transaction-detail-row")},this.disabledAmount=function(e){var a=void 0==e?r.find("[name='selInvoiceType[]']"):e.find("[name='selInvoiceType[]']").first();a.each(function(){var e=$(this).closest(".transaction-detail-row"),a=$(this).val();$readonly=1==a?!1:!0;var n=e.find("[name='dummychkService[]'],[name='qtyDetail[]'],[name='itemNameAliasDetail[]'],[name='dummychkIsTax23[]']");if(n.prop("readonly",$readonly),$readonly){n.attr("tabIndex","-1");var t=e.find("[name='dummychkService[]']");t.prop("checked")||t.click().change()}else n.removeAttr("tabIndex")})},this.resetDetails=function(){clearAllRows($("#"+e)),o.rebindEl(),o.calculateTotal()},this.afterRemoveRowHandler=function(){o.calculateTotal()},this.calculateServiceDetail=function(e){var a=$(e).closest(".service-detail-row"),n=a.find("[name='hidCurrencyKey[]']").val(),i=r.find("[name=selCurrency]").val(),l=parseFloat(unformatCurrency(a.find("[name='qtyDetail[]']").val()))||0,d=parseFloat(unformatCurrency(a.find("[name='priceInUnitDetail[]']").val()))||0,c=parseFloat(unformatCurrency(a.find("[name='detailRate[]']").val()))||1,s=l*d;i==t.CURRENCY.idr?n!=t.CURRENCY.idr&&(s*=c):n==t.CURRENCY.idr&&(s/=c),a.find("[name='subtotalDetail[]']").val(s).blur(),o.calculateTotal()},this.calculateTax23=function(){var e=parseFloat(unformatCurrency(r.find("[name='tax23Percentage']").val()))||0,a=parseFloat(unformatCurrency(r.find("[name='hidTotalBeforeTaxPPH23']").val()))||0;if(useTax23=1,tax23Value=0,0!=useTax23&&e>0){var n=r.find("[name='chkIncludeTax']").val(),t=parseFloat(unformatCurrency(r.find("[name='taxPercentage']").val()))||0;1==n&&(a-=t/(100+t)*a),tax23Value=e/100*a}r.find("[name='tax23Value']").val(tax23Value).blur()},this.calculateTotal=function(){var e=0,a=0;r.find("[name='chkPick[]']").each(function(){if(1==$(this).val()){if(row=$(this).closest(".transaction-detail-row"),objSubtotal=row.find("[name='salesOrderSubtotal[]']"),objTotal=row.find("[name='amount[]']"),invoiceType=row.find("[name='selInvoiceType[]']").val(),1==invoiceType){var n=0;row.find("[name='chkService[]']").each(function(){if(1==$(this).val()){var e=$(this).closest(".service-detail-row"),t=parseFloat(unformatCurrency(e.find("[name='subtotalDetail[]']").val()))||0;n+=t,1==e.find("[name='chkIsTax23[]']").val()&&(a+=t)}}),objSubtotal.val(n).blur(),downpayment=0,n-=downpayment,0>n&&(n=0),objTotal.val(n).blur()}else n=parseFloat(unformatCurrency(row.find("[name='amount[]']").val()))||0;e+=n}});var n=e;r.find("[name='subtotal']").val(n).blur();var t=o.calculateTotalDownpayment(),i=parseFloat(unformatCurrency(r.find("[name='finalDiscount']").val()))||0,l=parseInt(unformatCurrency(r.find("[name='selFinalDiscountType']").val()))||0,d=r.find("[name='chkIncludeTax']").val(),c=parseFloat(unformatCurrency(r.find("[name='taxPercentage']").val()))||0,s=parseFloat(unformatCurrency(r.find("[name='otherCost']").val()))||0;0!=i&&2==l&&(i=i/100*n),n-=i;var u=n,m=0;0==d?(m=Math.floor(n*c/100),n+=m):(m=Math.floor(c/(100+c)*n),u=n-m),r.find("[name='hidTotalBeforeTaxPPH23']").val(a).blur(),r.find("[name='beforeTaxTotal']").val(u).blur(),r.find("[name='taxValue']").val(m).blur();var f=n+s;r.find("[name='total']").val(f).blur();var h=0;r.find("[name='paymentMethodValue[]']").each(function(){h+=parseFloat(unformatCurrency($(this).val()))||0}),r.find("[name='totalPayment']").val(h).blur();var p=h+t-f;r.find("[name='balance']").val(p).blur(),o.calculateTax23()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),o.activeAjaxConnections=0;{var a=r.find("[name=hidCustomerKey]").val();r.find(" [name=selCurrency]").val()}$.ajax({type:"GET",url:"ajax-emkl-job-order.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e)),o.activeAjaxConnections++},data:"action=searchDataForInvoice&customerkey="+a,success:function(e){var a,n,e=JSON.parse(e);for(a=0;a<e.length;a++){var t=[];t.push({selector:"hidSalesOrderKey",value:e[a].pkey}),t.push({selector:"hidSalesOrderHeaderKey",value:e[a].refheaderkey}),t.push({selector:"salesOrderCode",value:e[a].value}),t.push({selector:"salesOrderSubtotal",value:e[a].subtotalcurrency}),t.push({selector:"doNumberDetail",value:e[a].hbl}),n=addNewTemplateRow("detail-row-template",JSON.stringify(t)),o.updatePartialInvoiceOutstanding(n)}o.updateFieldOnChangeInvoiveDownpayment(),o.rebindEl(),r.find(".inputnumber, .inputdecimal, .inputautodecimal").blur(),o.calculateTotal(),decreaseActiveAjaxConnections(o),r.find("[name='chkPick-master']").val(1).change(),o.updateDefaultDownpayment()},error:function(){decreaseActiveAjaxConnections(o)}})},this.onChangeChk=function(){o.calculateTotal()},this.rebindDownpayment=function(){var e=r.find("[name=hidCustomerKey]").val()||0;bindAutoCompleteForTransactionDetail("downpaymentCode[]",u,"ajax-customer-downpayment.php?action=searchData&customerkey="+e)},this.updateCustomerInformation=function(e,a,n){var i=0,l=0,d=t.CURRENCY.idr;if(""!=r.find("[name=hidCurrentCustomerKey]").val())$("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){r.find("[name=hidCustomerKey]").val(r.find("[name=hidCurrentCustomerKey]").val()),r.find("[name=customerName]").val(r.find("[name=hidCurrentCustomerName]").val()),$(e).closest("form").bootstrapValidator("revalidateField",$(e).attr("name")),o.rebindEl()},buttons:{OK:function(){if(null==n.item)clearAutoCompleteInput(e,"hidCustomerKey"),r.find("[name=hidCurrentCustomerKey]").val(""),r.find("[name=hidCurrentCustomerName]").val("");else{r.find("[name=hidCurrentCustomerKey]").val(n.item.pkey),r.find("[name=hidCurrentCustomerName]").val(n.item.value);var a=n.item.taxid?2:4;r.find("[name='tax23Percentage']").val(a).change().blur(),i=n.item.termofpaymentkey,l=n.item.companybankkey,d=n.item.currencypreference,o.updateCurrencyAndOthers(i,l,d)}o.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});else{if(null==n.item)clearAutoCompleteInput(e,"hidCustomerKey"),r.find("[name=hidCurrentCustomerKey]").val(""),r.find("[name=hidCurrentCustomerName]").val("");else{r.find("[name=hidCurrentCustomerKey]").val(n.item.pkey),r.find("[name=hidCurrentCustomerName]").val(n.item.value);var c=n.item.taxid?2:4;r.find("[name='tax23Percentage']").val(c).change().blur(),i=n.item.termofpaymentkey,l=n.item.companybankkey,d=n.item.currencypreference,o.updateCurrencyAndOthers(i,l,d)}o.rebindEl()}},this.updateCurrencyAndOthers=function(e,a,n){r.find("[name=selTermOfPayment] option[value='"+e+"']").length>0&&r.find("[name=selTermOfPayment]").val(e).change(),r.find("[name=selBank] option[value='"+a+"']").length>0&&r.find("[name=selBank]").val(a).change(),r.find("[name=selCurrency]").val(n).change()},this.changeInvoiceType=function(e){var a=$(e).val();$row=$(e).closest(".transaction-detail-row");var n=$row.find(".service-detail-row");$row.find("[class*=type-]").hide(),$row.find(".type-"+a).show(),$row.find(".options-row").hide(),(1==a||3==a)&&n.length>0&&$row.find(".options-row").show(),o.disabledAmount($row),o.calculateTotal()},this.updateFieldOnChangeInvoiveDownpayment=function(e){var a=e?e:r.find(".invoice-detail > .transaction-detail-row");o.updateSODetail(a),a.each(function(){{var e=$(this).find('[name="selInvoiceType[]"]'),a=$(this).find('[name="amount[]"]'),n=$(this).find(".options-row"),t=r.find(".not-downpayment-field");$(this).find('[name="salesOrderCode[]"]')}t.show(),e.prop("disabled",!1),1==e.val()?(a.prop("readonly",!0),$(this).find(".options-row .transaction-detail-row").length>0&&n.show()):a.prop("readonly",!1)})},this.onChangeCurrency=function(){var e=r.find("[name=selCurrency]");r.find(".mnv-active-currency").html(e.find("option:selected").text()),r.find("[name='detailRate[]']").each(function(){o.calculateServiceDetail($(this))})},this.onChangePaymentMethodHandler=function(){o.calculateTotal()},this.afterRemoveRowHandler=function(){o.calculateTotal(),o.updateDefaultDownpayment()},this.afterAddNewTemplateRowHandler=function(){},this.rebindEl=function(){var e=[];e.onSelectFunction="getTabObj().updateDetail",e.onChangeFunction="getTabObj().updateOnChange";var a=r.find("[name=hidCustomerKey]").val();bindAutoCompleteForTransactionDetail("salesOrderCode[]",d,"ajax-emkl-job-order.php?action=searchDataForInvoice&customerkey="+a,e),bindAutoCompleteForTransactionDetail("itemName[]",c,"ajax-item.php?action=searchData&itemtype=2&serviceCost=1"),bindAutoCompleteForTransactionDetail("invoiceCode[]",s,"ajax-emkl-order-invoice.php?action=searchData&statuskey=2,3&customerkey="+a,o.updateDetailForInvoice),bindEl(r.find("[name='selInvoiceType[]']"),"change",function(){o.changeInvoiceType(this)}),bindEl(r.find("[name='amount[]'], [name='chkService[]'], [name='chkIsTax23[]']"),"change",function(){o.calculateTotal()}),bindEl(r.find("[name='qtyDetail[]'], [name='detailRate[]']"),"change",function(){o.calculateServiceDetail(this)}),bindEl(r.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,o.onChangeChk)});var n=r.find(".mnv-downpayment");bindEl(n.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(o,n,"downpayment-row-template")}),bindEl(n.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(o,n,"downpayment-row-template")}),o.rebindDownpayment()},this.updateRecordedCode=function(e){var a=r.find("[name=selCustomCode]");o.recordedCode[a.val()]=$(e).val()},this.updateCode=function(e){var a=$(e).val(),n=r.find("[name=code]"),t="";$.ajax({type:"GET",url:"ajax-custom-code.php",asyn:!1,data:"action=getDataRowById&pkey="+a,success:function(e){var e=JSON.parse(e);if(e=e[0],t=o.recordedCode[a]?o.recordedCode[a]:"",1==e.useautocode){var i=t?t:"[auto code]";n.val(i),n.prop("readonly",!0)}else n.val(t),n.prop("readonly",!1)}})},this.loadOnReady=function(){r.find("[name=selTermOfPayment]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return r.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void r.find(".cashTOP").hide();r.find(".cashTOP").show()}),r.find("[name=selCustomCode]").change(function(){r.find("[name='salesOrderCode[]']").each(function(){detailRow=$(this).closest(".transaction-detail-row"),o.updatePartialInvoiceOutstanding(detailRow)}),o.calculateTotal()}),r.find("[name=selTermOfPayment]").change(),r.find("[name=btnImport]").on("click",function(){o.importData()}),r.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,o.onChangeChk)}),r.find("[name=chkTax23], [name=tax23Percentage]").change(function(){o.calculateTax23()}),r.find("[name=otherCost], [name=beforeTaxTotal], [name=chkIncludeTax], [name=selFinalDiscountType], [name=taxPercentage], [name=finalDiscount]").change(function(){o.calculateTotal()}),r.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)});var e=r.find("[name=selCurrency]");e.change(function(){o.onChangeCurrency()}),addNewTemplateRow("downpayment-row-template"),r.find("[name='chkPick-master']").val(1).change(),r.find(".mnv-active-currency").html(e.find("option:selected").text()),o.recordedCode[r.find("[name=selCustomCode]").val()]=r.find("[name=code]").val(),r.find("[name=selCustomCode]").change(function(){o.updateCode(this)}),r.find("[name=selCustomCode]").change(),r.find("[name=code]").change(function(){o.updateRecordedCode(this)}),o.disabledAmount(),o.rebindEl()}}function EMKLCommission(e,a,n){var t=this,o=$("#"+e);this.tabID=e;var r=!0,l=new Array;l.push({object:"hidSalesDetailKey[]",value:"pkey"});this.updateFromJobOrder=function(){var e=o.find("[name=hidJobOrderKey]").val();$.ajax({type:"GET",url:"ajax-emkl-job-order.php",data:"action=getDataRowById&pkey="+e}).done(function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],o.find("[name=etdPol]").val(moment(e.etdpol).format(_DATE_FORMAT_)),o.find("[name=etaPod]").val(moment(e.etapod).format(_DATE_FORMAT_)),o.find("[name=selTypeOfJob]").val(e.jobtypekey),o.find("[name=selAirSea]").val(e.transportationtypekey),o.find("[name=selContainerType]").val(e.loadcontainertypekey).change(),o.find("[name=volume]").val(e.volume).blur(),o.find("[name=selVolumeType]").val(e.volumetype),o.find("[name=containerName]").val(decodeHTMLEntities(e.containername)),o.find("[name=bookingNumber]").val(e.bookingnumber),o.find("[name=poNumber]").val(e.ponumber),o.find("[name=mblNumber]").val(e.mblnumber),o.find("[name=containerName]").val(decodeHTMLEntities(e.containername)),o.find("[name=shipperName]").val(e.customername),o.find("[name=pol]").val(e.polname),o.find("[name=pod]").val(e.podname),o.find("[name=selWarehouseKey]").val(e.warehousekey),updateComboboxReadonly(o.find("[name=selTypeOfJob]")),void o.find("[name=selTypeOfJob]").change())})},this.updateJobType=function(){var e=o.find("[name=selContainerType]"),a=o.find(".fcl-only"),t=o.find(".lcl-only"),i=(o.find(".supplier-row").not(".row-template"),e.val());i==n.EMKL.container.lcl?(t.show(),a.hide(),$(".fcl-readonly").attr("readonly",!1)):(t.hide(),a.show(),$(".fcl-readonly").attr("readonly",!0))},this.getRowObj=function(e){return e.closest(".div-table-row")},this.onChangeCurrency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='currencyRate']"),i=o.find("[name='selCurrencyDetail[]']");i.val(e.val());var r=!1;e.val()==n.CURRENCY.idr&&(r=!0,a.val(1)),a.prop("readonly",r),o.find(".mnv-active-currency").html(e.find("option:selected").text()),t.updateAvailableCurency(),a.change().blur(),t.updateNumberDecimal(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur(),t.onChangeCurrencyRate()}}})},this.updateAvailableCurency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='selCurrencyDetail[]']");e.val()==n.CURRENCY.idr?a.find("option:not(:selected)").attr("disabled",!0):a.find("option").attr("disabled",!1)},this.updateTOP=function(){var e=o.find("[name=selTermOfPaymentKey]").val(),a=o.find("[name=hidSupplierKey]").val();$.ajax({type:"GET",url:"ajax-supplier.php",data:"action=getDataRowById&pkey="+a}).done(function(a){a=JSON.parse(a),a=a[0],1==r?(r=!r,t.updateSupplierInformation(a.termofpaymentkey)):e!=a.termofpaymentkey&&($("#dialog-message").html("Apakah Anda ingin mengganti data pembayaran dengan data default untuk pemasok ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pembayaran",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){t.updateSupplierInformation(a.termofpaymentkey),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}))})},this.updateSupplierInformation=function(e){o.find("[name=selTermOfPaymentKey] option[value='"+e+"']").length>0&&o.find("[name=selTermOfPaymentKey]").val(e).change()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.onChangeCurrencyRate=function(){o.find("[name='priceInUnit[]']").each(function(){t.calculateDetail(this)})},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),i=parseFloat(unformatCurrency(o.find("[name='currencyRate']").val()))||1,r=parseFloat(unformatCurrency(a.find("[name='qty[]']").val()))||0,l=parseFloat(unformatCurrency(a.find("[name='priceInUnit[]']").val()))||0,d=r*l;a.find("[name='detailRowCurrencySubtotal[]']").val(d).blur();var c=a.find("[name='selCurrencyDetail[]']"),s=o.find("[name=selCurrency]").val();s==n.CURRENCY.idr?c.val()!=n.CURRENCY.idr&&(d*=i):c.val()==n.CURRENCY.idr&&(d/=i),a.find("[name='detailSubtotal[]']").val(d).blur(),a.find(".mnv-active-currency-detail").html(c.find("option:selected").text()),t.updateDetailNumberDecimal(a),t.calculateTotal()},this.updateNumberDecimal=function(){var e=o.find("[name='selCurrency']"),a=e.val()==n.CURRENCY.idr?!0:!1;changeNumberDecimal(o.find("[name='detailSubtotal[]'],[name='total'],[name='totalPayment'],[name='paymentMethodValue[]'] ,[name='balance']"),a)},this.updateDetailNumberDecimal=function(e){var a=e?e.find("[name='selCurrencyDetail[]']"):o.find("[name='selCurrencyDetail[]']");a.each(function(){var e=$(this).val()==n.CURRENCY.idr?!0:!1,a=$(this).closest(".transaction-detail-row");changeNumberDecimal(a.find("[name='priceInUnit[]'],[name='detailRowCurrencySubtotal[]']"),e)})},this.calculateTotal=function(){var e=0;o.find("[name='detailSubtotal[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='subtotal']").val(e).blur();var a=e;o.find("[name='total']").val(a).blur();var n=parseFloat(unformatCurrency(o.find("[name='totalPayment']").val())),t=n-a;o.find("[name='balance']").val(t).blur()},this.rebindEl=function(){bindEl(o.find("[name='qty[]'], [name='priceInUnit[]'],  [name='selCurrencyDetail[]']"),"change",function(){t.calculateDetail(this)})},this.loadOnReady=function(){t.updateNumberDecimal(),t.updateDetailNumberDecimal(),o.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<a.length;i++)if($(this).val()==a[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPaymentKey]").change(),o.find("[name=selContainerType]").change(function(){t.updateJobType()}),o.find("[name=selVolumeType]").change(function(){t.updateVolumeType()}),o.find("[name=selCurrency]").change(function(){t.onChangeCurrency()}),o.find(".mnv-active-currency").html(o.find("[name=selCurrency]").find("option:selected").text()),o.find("[name=currencyRate]").change(function(){t.onChangeCurrencyRate()}),t.updateAvailableCurency(),t.updateJobType(),t.rebindEl()}}function CashOut(e,a){var n=this,t=$("#"+e),i=new Array;a?(i.push({object:"hidCostKey[]",value:"pkey"}),i.push({object:"hidCOAKey[]",value:"coakey"})):i.push({object:"hidCOAKey[]",value:"pkey"});var o=i;this.tabID=e,this.useMasterCost=a,this.calculateTotal=function(){var e=0;t.find("[name='amount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='total']").val(e).blur()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindEl(t.find("[name='amount[]'] "),"change",function(){n.calculateTotal()}),n.useMasterCost?bindAutoCompleteForTransactionDetail("CCOName[]",o,"ajax-cost-cash-out.php?action=searchData"):bindAutoCompleteForTransactionDetail("COAName[]",o,"ajax-coa.php?action=searchData")},this.loadOnReady=function(){n.rebindEl()}}function SalesOrderInvoiceReceipt(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidInvoiceKey[]",value:"pkey"}),t.push({object:"invoiceTotal[]",value:"grandtotal"}),t.push({object:"invoiceDate[]",value:"trdate",type:"date"});var i=t;this.tabID=e,this.updateDetail=function(e,n,t){var i=$(e).closest(".transaction-detail-row");a.updateRowInformation(i,n,t),a.calculateTotal()},this.calculateTotal=function(){var a=0;$("#"+e+" [name='chkPick[]']").not(":disabled").each(function(){1==$(this).val()&&(objAmount=$(this).closest(".div-table-row").find("[name='invoiceTotal[]']"),a+=parseInt(unformatCurrency(objAmount.val()))||0)}),n.find("[name='grandTotal']").val(a).blur()},this.updateRowInformation=function(e,a,n){var t;for(t=0;t<a.length;t++)"date"==a[t].type&&(n.item[a[t].value]=moment(n.item[a[t].value]).format(_DATE_FORMAT_)),e.find("[name='"+a[t].object+"']").first().val(n.item[a[t].value]).change().blur();e.find("[name='invoiceCode[]']").first().val(n.item.value)},this.resetDetails=function(){clearAllRows($("#"+e)),a.calculateTotal()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),a.activeAjaxConnections=0;var t=n.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-trucking-service-order-invoice.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e)),a.activeAjaxConnections++},data:"action=searchData&statuskey=2&customerkey="+t,success:function(e){var t,i,e=JSON.parse(e);for(t=0;t<e.length;t++){var o=[];o.push({selector:"hidInvoiceKey",value:e[t].pkey}),o.push({selector:"invoiceCode",value:e[t].code}),o.push({selector:"invoiceDate",value:moment(e[t].trdate).format(_DATE_FORMAT_)}),o.push({selector:"invoiceTotal",value:e[t].grandtotal}),i=addNewTemplateRow("detail-row-template",JSON.stringify(o))}a.rebindEl(),n.find(".inputnumber").change().blur(),n.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(a),n.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(a)}})},this.onChangeChk=function(){a.calculateTotal()},this.updateCustomerInformation=function(e,t,i){var o=0;""!=n.find("[name=hidCurrentCustomerKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){n.find("[name=hidCustomerKey]").val(n.find("[name=hidCurrentCustomerKey]").val()),n.find("[name=customerName]").val(n.find("[name=hidCurrentCustomerName]").val()),$(e).closest("form").bootstrapValidator("revalidateField",$(e).attr("name")),a.rebindEl()},buttons:{OK:function(){null==i.item?(clearAutoCompleteInput(e,"hidCustomerKey"),n.find("[name=hidCurrentCustomerKey]").val(""),n.find("[name=hidCurrentCustomerName]").val("")):(n.find("[name=hidCurrentCustomerKey]").val(i.item.pkey),n.find("[name=hidCurrentCustomerName]").val(i.item.value),o=i.item.termofpaymentkey),a.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==i.item?(clearAutoCompleteInput(e,"hidCustomerKey"),n.find("[name=hidCurrentCustomerKey]").val(""),n.find("[name=hidCurrentCustomerName]").val("")):(n.find("[name=hidCurrentCustomerKey]").val(i.item.pkey),n.find("[name=hidCurrentCustomerName]").val(i.item.value),o=i.item.termofpaymentkey),a.rebindEl())},this.onChangePaymentMethodHandler=function(){a.calculateTotal()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.afterAddNewTemplateRowHandler=function(){},this.rebindEl=function(){var e=[];e.onSelectFunction="getTabObj().updateDetail";var t=n.find("[name=hidCustomerKey]").val();bindAutoCompleteForTransactionDetail("invoiceCode[]",i,"ajax-trucking-service-order-invoice.php?action=searchData&statuskey=2&customerkey="+t,e),bindEl(n.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,a.onChangeChk)})},this.loadOnReady=function(){n.find("[name=btnImport]").on("click",function(){a.importData()}),n.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,a.onChangeChk)}),n.find("[name='chkPick-master']").val(1).change(),a.rebindEl()}}function CreditNote(e,a){var n=this,t=$("#"+e),i=new Array;i.push({object:"hidARKey[]",value:"pkey"}),i.push({object:"amount[]",value:"outstanding"}),i.push({object:"refCode[]",value:"refcode"}),i.push({object:"arDate[]",value:"trdate",type:"date"});var o=i;this.tabID=e,this.updateDetail=function(e,a,n){for(var t=$(e).closest(".transaction-detail-row"),i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).change().blur();t.find("[name='arCode[]']").first().val(n.item.value)},this.calculateTotal=function(){var e=0;t.find("[name='creditTotal[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),t.find("[name='grandTotal']").val(e).blur()},this.resetDetails=function(){clearAllRows($("#"+e)),n.calculateTotal()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.onChangeChk=function(){n.calculateTotal()},this.updateCustomerInformation=function(e,a,i){""!=t.find("[name=hidCurrentCustomerKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){t.find("[name=hidCustomerKey]").val(t.find("[name=hidCurrentCustomerKey]").val()),t.find("[name=customerName]").val(t.find("[name=hidCurrentCustomerName]").val()),$(e).closest("form").bootstrapValidator("revalidateField",$(e).attr("name")),n.rebindEl()},buttons:{OK:function(){null==i.item?(clearAutoCompleteInput(e,"hidCustomerKey"),t.find("[name=hidCurrentCustomerKey]").val(""),t.find("[name=hidCurrentCustomerName]").val("")):(t.find("[name=hidCurrentCustomerKey]").val(i.item.pkey),t.find("[name=hidCurrentCustomerName]").val(i.item.value)),n.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==i.item?(clearAutoCompleteInput(e,"hidCustomerKey"),t.find("[name=hidCurrentCustomerKey]").val(""),t.find("[name=hidCurrentCustomerName]").val("")):(t.find("[name=hidCurrentCustomerKey]").val(i.item.pkey),t.find("[name=hidCurrentCustomerName]").val(i.item.value)),n.rebindEl())},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pelanggan ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){t.find("[name=selCurrency]").val(t.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){t.find("[name=hidCurrentCurrencyKey]").val(t.find("[name=selCurrency]").val()),n.resetDetails();var e=t.find("[name='selCurrency']"),i=e.val()==a.CURRENCY.idr?!0:!1;changeNumberDecimal(t.find("[name='amount[]'],[name='creditTotal[]'],[name='grandTotal']"),i),$(this).dialog("close")},Cancel:function(){t.find("[name=selCurrency]").val(t.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeCurrency=function(){n.rebindEl(),n.updateCurrency()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){var e=[];e.onSelectFunction="getTabObj().updateDetail";var a=t.find("[name=hidCustomerKey]").val(),i=t.find("[name=selCurrency]").val();bindAutoCompleteForTransactionDetail("arCode[]",o,"ajax-ar.php?action=searchData&customerkey="+a+"&currencykey="+i,e),bindEl(t.find("[name='creditTotal[]']"),"change",function(){n.calculateTotal()}),bindEl(t.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,n.onChangeChk)})},this.loadOnReady=function(){t.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,n.onChangeChk)}),t.find("[name=selCurrency]").change(function(){n.onChangeCurrency()}),t.find("[name='chkPick-master']").val(1).change(),n.rebindEl()}}function ChangeItemSN(e){var a=this,n=$("#"+e);this.tabID=e,this.updateSNInformation=function(){var e=n.find("[name=serialNumber]").val();n.find("[name=itemName]").val(""),n.find("[name=hidItemKey]").val(""),n.find("[name=vendorPartNumber]").val(""),n.find("[name=hidVendorPartNumberKey]").val(""),e&&$.ajax({type:"GET",url:"ajax-item-sn.php",data:"action=searchSN&sn="+e}).done(function(e){if(e=JSON.parse(e),0==e.length){alert(phpErrorMsg[213]);var a=n.find("[name=serialNumber]");return a.val(""),void a.closest("form").bootstrapValidator("revalidateField",a.attr("name"))}e=e[0],n.find("[name=itemName]").val(decodeHTMLEntities(e.itemname)),n.find("[name=hidItemKey]").val(e.itemkey),n.find("[name=vendorPartNumber]").val(e.partnumber),n.find("[name=hidVendorPartNumberKey]").val(e.vendorpartnumberkey)})},this.rebindEl=function(){},this.loadOnReady=function(){n.find("[name=serialNumber]").change(function(){a.updateSNInformation()}),a.rebindEl()}}function Car(e){var a=this,n=$("#"+e);this.tabID=e,this.showVendor=function(){var e=n.find("[name=chkIsVendor]").val(),a=n.find(".vendor");1==e?a.show():a.hide()},this.rebindEl=function(){},this.loadOnReady=function(){n.find("[name=chkIsVendor]").on("change",function(){a.showVendor()}),a.rebindEl()}}function APPayment(e,a,n){var t=this,o=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null,this.supplierTax=0,this.tablekey=n.TABLEKEY;var r=new Array;r.push({object:"hidDownpaymentKey[]",value:"pkey"}),r.push({object:"downpaymentAmount[]",value:"outstanding"});var l=r,r=new Array;r.push({object:"hidCostKey[]",value:"pkey"});var d=r,r=new Array;r.push({object:"hidAPKey[]",value:"pkey"}),r.push({object:"refCode[]",value:"refcode"}),r.push({object:"refJOCode[]",value:"refcode2"}),r.push({object:"apAmount[]",value:"amount"}),r.push({object:"outstanding[]",value:"outstanding"}),r.push({object:"amount[]",value:"outstanding"});var c=r;this.resetDetails=function(){clearAllRows(o.find(".mnv-transaction")),clearAllRows(o.find(".mnv-downpayment")),addNewTemplateRow("downpayment-row-template"),t.rebindDownpayment(),t.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(n.item[a[i].value])).change().blur();t.find('[name="apCode[]"]').first().val(n.item.code)},this.checkDownpaymentExist=function(e){var a=!1;return o.find("[name='hidDownpaymentKey[]']").each(function(){return $(this).val()==e?void(a=!0):void 0}),a},this.updateDefaultDownpayment=function(){var e=new Array;o.find("[name='hidAPKey[]']").each(function(){$(this).val()&&e.push($(this).val())});var a=o.find("[name='selCurrency']").val();$.ajax({type:"GET",url:"ajax-supplier-downpayment.php",data:"action=getDownpaymentForAP&apkey="+JSON.stringify(e)+"&currencykey="+a,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++)if(!t.checkDownpaymentExist(e[a].pkey)){var n=[];n.push({selector:"downpaymentCode",value:e[a].code}),n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"downpaymentAmount",value:e[a].outstanding}),updateTemplateRow("downpayment-row-template",JSON.stringify(n))}t.rebindDownpayment(),o.find('[name="downpaymentAmount[]"]').change().blur(),t.calculateTotalDownpayment()}})},this.calculateTotalDownpayment=function(){var e=0;return o.find("[name='downpaymentAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalDownpayment']").val(e).blur(),e},this.calculateTotalCost=function(){var e=0;return o.find("[name='costAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalCost']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=0,n=0,i=0;o.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var t=$(this).closest(".div-table-row").find("[name='amount[]']"),i=$(this).closest(".div-table-row").find("[name='discount[]']"),o=$(this).closest(".div-table-row").find("[name='taxPPH[]']");e+=parseFloat(unformatCurrency(t.val()))||0,n+=parseFloat(unformatCurrency(i.val()))||0,a+=parseFloat(unformatCurrency(o.val()))||0}});var r=e+n;o.find("[name='totalPaid']").val(r).blur(),o.find("[name='totalDiscount']").val(n).blur(),o.find("[name='pph23']").val(a).blur();var l=t.calculateTotalDownpayment(),i=t.calculateTotalCost(),d=e-a-l+i;o.find("[name='total']").val(d).blur();var c=0;o.find("[name='paymentMethodValue[]']").each(function(){c+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(c).blur();var s=c-d;s=Math.round(100*(s+Number.EPSILON))/100,o.find("[name='balance']").val(s).blur()},this.rebindDownpayment=function(){var e=o.find("[name=hidSupplierKey]").val()||0;bindAutoCompleteForTransactionDetail("downpaymentCode[]",l,"ajax-supplier-downpayment.php?action=searchData&supplierkey="+e+"&currencykey="+o.find("[name=selCurrency]").val())
},this.rebindCost=function(){bindAutoCompleteForTransactionDetail("costName[]",d,"ajax-cost-cash-out.php?action=searchData")},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0;var e=o.find("[name=hidRefKey]").val()||0,a=1==o.find("[name=chkDatePeriod]").val()?!0:!1,n="";if(a){var i=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),r=convertDateToStandartFormat(o.find("[name=trEndDate]").val());n="&startdate="+i+"&enddate="+r}var l="action=searchData&currencykey="+o.find("[name=selCurrency]").val()+"&supplierkey="+o.find("[name=hidSupplierKey]").val()+"&&warehousekey="+o.find("[name=selWarehouseKey]").val()+"&refkey2="+e+n;$.ajax({type:"GET",url:"ajax-ap.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:l,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidAPKey",value:e[a].pkey}),n.push({selector:"apCode",value:e[a].code}),n.push({selector:"refCode",value:e[a].refcode}),n.push({selector:"refJOCode",value:e[a].refcode2}),n.push({selector:"apAmount",value:e[a].amount}),n.push({selector:"outstanding",value:e[a].outstanding}),n.push({selector:"amount",value:e[a].outstanding});var i=1==e[a].autotax&&t.supplierTax>0?e[a].amount*t.supplierTax/100:0;n.push({selector:"taxPPH",value:i}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}t.rebindEl(),o.find(".inputnumber").change().blur(),o.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(t),o.find("[name='chkPick-master']").val(1).change(),t.updateDefaultDownpayment()},error:function(){decreaseActiveAjaxConnections(t)}})},this.updateSupplierInformation=function(e,a){var n=this;""!=o.find("[name=hidCurrentSupplierKey]").val()?($("#dialog-message").html("Merubah pemasok akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pemasok",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){o.find("[name=hidSupplierKey]").val(o.find("[name=hidCurrentSupplierKey]").val()),o.find("[name=supplierName]").val(o.find("[name=hidCurrentSupplierName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),t.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),o.find("[name=hidCurrentSupplierKey]").val(""),o.find("[name=hidCurrentSupplierName]").val("")):(o.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),o.find("[name=hidCurrentSupplierName]").val(a.item.value)),t.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),o.find("[name=hidCurrentSupplierKey]").val(""),o.find("[name=hidCurrentSupplierName]").val("")):(o.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),o.find("[name=hidCurrentSupplierName]").val(a.item.value)),t.rebindEl()),t.updateTax(),t.rebindDownpayment()},this.updateTax=function(){$.ajax({type:"GET",url:"ajax-supplier.php",async:!1,data:"action=getTaxInformation&pkey="+o.find("[name=hidSupplierKey]").val(),success:function(e){if(t.supplierTax=0,e){var e=JSON.parse(e);t.supplierTax=e.taxpercentage}}})},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pemasok ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.find("[name=hidCurrentCurrencyKey]").val(o.find("[name=selCurrency]").val()),t.resetDetails(),$(this).dialog("close")},Cancel:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeChk=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal(),t.rebindDownpayment(),t.rebindCost()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangeCurrency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='currencyRate']"),t=!1;e.val()==n.CURRENCY.idr&&(t=!0,a.val(1)),a.prop("readonly",t),o.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}})},this.showRetailPurchase=function(e){var a=$(e).closest(".row-action-panel"),n=$(e).closest(".transaction-detail-row"),t=n.find("[name='hidAPKey[]']").val(),i=a.attr("rel-load"),o=n.find(".transaction-reference-panel");o.show(),1!=i&&$.ajax({type:"GET",url:"ajax-purchase-order.php",data:"action=getDetailByAP&apkey="+t,beforeSend:function(){o.append('<div class="loading-'+t+'">'+_LOADING_ICON_+"</div>")},success:function(e){if(e){var n,e=JSON.parse(e),i=o.find(".reference-row-template");for(n=0;n<e.length;n++)$newRow=i.clone().removeClass("reference-row-template").insertBefore(i.first()),$newRow.find(".purchase-number-row").html(n+1+"."),$newRow.find(".purchase-item").html(e[n].itemname),$newRow.find(".purchase-qty").html(e[n].qty),$newRow.find(".purchase-unit").html(e[n].unitname),$newRow.find(".purchase-price").html(e[n].priceinunit),$newRow.find(".purchase-subtotal").html(e[n].total);o.find(".is-number").formatCurrency(),o.find(".loading-"+t).remove(),a.attr("rel-load",1)}}})},this.showRefDetail=function(e){"show"==$(e).attr("rel-action")?t.showRetailPurchase(e):$(e).closest(".transaction-detail-row").find(".transaction-reference-panel").hide(),$(e).closest(".row-action-panel").find(".row-show-detail").toggleClass("hide")},this.rebindEl=function(){var e=o.find("[name='selCurrency']").val();bindEl(o.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,t.onChangeChk)}),bindEl(o.find("[name='discount[]'], [name='amount[]'], [name='taxPPH[]']"),"change",function(){t.calculateTotal()}),bindAutoCompleteForTransactionDetail("apCode[]",c,"ajax-ap.php?action=searchData&supplierkey="+o.find("[name=hidSupplierKey]").val()+"&currencykey="+e+"&warehousekey="+o.find("[name=selWarehouseKey]").val(),t.updateDetail);var a=o.find(".mnv-downpayment");bindEl(a.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(t,a,"downpayment-row-template")}),bindEl(a.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(t,a,"downpayment-row-template")});var n=o.find(".mnv-cost");bindEl(n.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(t,n,"cost-row-template")}),bindEl(n.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(t,n,"cost-row-template")}),bindEl($(".row-show-detail"),"click",function(){t.showRefDetail(this)}),t.rebindDownpayment(),t.rebindCost()},this.loadOnReady=function(){o.find("[name=selTermOfPayment]").change(),o.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,t.onChangeChk)}),o.find("[name=btnImport]").on("click",function(){t.importData()}),o.find("[name=btnAddPayment]").bind("click",function(){t.onCLickAddPayment()}),o.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=o.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),o.find("[name=chkDatePeriod]").change(),o.find("[name=selCurrency]").change(function(){t.updateCurrency()}),o.find("[name=selWarehouseKey]").change(function(){t.rebindEl()}),o.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(o.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(o.find("[name=trEndDate]").val()));e>a&&o.find("[name=trEndDate]").val(o.find("[name=trStartDate]").val())}),o.find("[name=selCurrency]").change(function(){t.onChangeCurrency()}),o.find("[name='chkPick-master']").val(1).change(),addNewTemplateRow("downpayment-row-template"),addNewTemplateRow("cost-row-template"),t.rebindEl()}}function ARPayment(e,a,n,t){var o=this,r=$("#"+e);this.tabID=e,this.tablekey=a,this.rs=n.length>0?n[0]:null,this.customerTax=0;var l=new Array;l.push({object:"hidDownpaymentKey[]",value:"pkey"}),l.push({object:"downpaymentAmount[]",value:"outstanding"});var d=l,l=new Array;l.push({object:"hidCostKey[]",value:"pkey"});var c=l,l=new Array;l.push({object:"hidARKey[]",value:"pkey"}),l.push({object:"refCode[]",value:"refcode"}),l.push({object:"doNumber[]",value:"refcode2"}),l.push({object:"arAmount[]",value:"amount"}),l.push({object:"outstanding[]",value:"outstanding"}),l.push({object:"amount[]",value:"outstanding"}),l.push({object:"taxPPH[]",value:"tax23value"});var s=l;this.resetDetails=function(){clearAllRows(r.find(".mnv-transaction")),clearAllRows(r.find(".mnv-downpayment")),clearAllRows(r.find(".mnv-payment-method")),addNewTemplateRow("downpayment-row-template"),addNewTemplateRow("payment-method-row-template"),o.rebindARCode(),o.rebindDownpayment(),o.updateVoucher(),o.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).change().blur();t.find('[name="arCode[]"]').first().val(n.item.code)},this.checkDownpaymentExist=function(e){var a=!1;return r.find("[name='hidDownpaymentKey[]']").each(function(){return $(this).val()==e?void(a=!0):void 0}),a},this.updateDefaultDownpayment=function(){var e=new Array;r.find("[name='hidARKey[]']").each(function(){$(this).val()&&e.push($(this).val())});var a=r.find("[name='selCurrency']").val();$.ajax({type:"GET",url:"ajax-customer-downpayment.php",data:"action=getDownpaymentForAR&arkey="+JSON.stringify(e)+"&currencykey="+a,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++)if(!o.checkDownpaymentExist(e[a].pkey)){var n=[];n.push({selector:"downpaymentCode",value:e[a].code}),n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"downpaymentAmount",value:e[a].outstanding}),updateTemplateRow("downpayment-row-template",JSON.stringify(n))}o.rebindDownpayment(),r.find('[name="downpaymentAmount[]"]').change().blur(),o.calculateTotalDownpayment()}})},this.calculateTotalDownpayment=function(){var e=0;return r.find("[name='downpaymentAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),r.find("[name='totalDownpayment']").val(e).blur(),e},this.calculateTotalCost=function(){var e=0;return r.find("[name='costAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),r.find("[name='totalCost']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=0,n=0,t=0;r.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var t=$(this).closest(".div-table-row").find("[name='amount[]']"),i=$(this).closest(".div-table-row").find("[name='discount[]']"),o=$(this).closest(".div-table-row").find("[name='taxPPH[]']");e+=parseFloat(unformatCurrency(t.val()))||0,n+=parseFloat(unformatCurrency(i.val()))||0,a+=parseFloat(unformatCurrency(o.val()))||0}});var i=e+n;r.find("[name='totalReceived']").val(i).blur(),r.find("[name='totalDiscount']").val(n).blur(),r.find("[name='pph23']").val(a).blur();var l=o.calculateTotalDownpayment(),t=o.calculateTotalCost(),d=e-a-l-t;r.find("[name='total']").val(d).blur();var c=0;r.find("[name='paymentMethodValue[]']").each(function(){c+=parseFloat(unformatCurrency($(this).val()))||0}),r.find("[name='totalPayment']").val(c).blur();var s=c-d;s=Math.round(100*(s+Number.EPSILON))/100,r.find("[name='balance']").val(s).blur()},this.rebindDownpayment=function(){var e=r.find("[name=hidCustomerKey]").val()||0;bindAutoCompleteForTransactionDetail("downpaymentCode[]",d,"ajax-customer-downpayment.php?action=searchData&customerkey="+e+"&currencykey="+r.find("[name=selCurrency]").val())},this.rebindARCode=function(){bindAutoCompleteForTransactionDetail("arCode[]",s,"ajax-ar.php?action=searchData&customerkey="+r.find("[name=hidCustomerKey]").val()+"&currencykey="+r.find("[name=selCurrency]").val(),o.updateDetail)},this.updateVoucher=function(){if(t.ADV_FINANCE){var e=(r.find("[name=hidCustomerKey]").val()||0,r.find("[name='selVoucher[]']")),a="action=getAvailableVoucher&customerkey="+r.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-cash-bank.php",async:!1,beforeSend:function(){e.each(function(){$("option",$(this)).remove()})},data:a,success:function(a){if(a){a=JSON.parse(a);var n=a;reInsertSelectBox(e,n,{key:"pkey",label:"voucherlabel",rel:{"rel-amount":"outstanding"}})}}})}},this.rebindCost=function(){bindAutoCompleteForTransactionDetail("costName[]",c,"ajax-cost-cash-out.php?action=searchData")},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),o.activeAjaxConnections=0;var e=1==r.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var n=convertDateToStandartFormat(r.find("[name=trStartDate]").val()),t=convertDateToStandartFormat(r.find("[name=trEndDate]").val());a="&startdate="+n+"&enddate="+t}var i="action=searchData&currencykey="+r.find("[name=selCurrency]").val()+"&customerkey="+r.find("[name=hidCustomerKey]").val()+a;$.ajax({type:"GET",url:"ajax-ar.php",beforeSend:function(){clearAllRows(r.find(".mnv-transaction")),o.activeAjaxConnections++},data:i,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidARKey",value:e[a].pkey}),n.push({selector:"arCode",value:e[a].code}),n.push({selector:"refCode",value:e[a].refcode}),n.push({selector:"doNumber",value:e[a].refcode2}),n.push({selector:"arAmount",value:e[a].amount}),n.push({selector:"outstanding",value:e[a].outstanding}),n.push({selector:"amount",value:e[a].outstanding}),n.push({selector:"taxPPH",value:e[a].tax23value}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}o.rebindEl(),r.find(".inputnumber").change().blur(),r.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(o),r.find("[name='chkPick-master']").val(1).change(),o.updateDefaultDownpayment()},error:function(){decreaseActiveAjaxConnections(o)}})},this.updateCustomerInformation=function(e,a){var n=this;""!=r.find("[name=hidCurrentCustomerKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){r.find("[name=hidCustomerKey]").val(r.find("[name=hidCurrentCustomerKey]").val()),r.find("[name=customerName]").val(r.find("[name=hidCurrentCustomerName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),o.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidCustomerKey"),r.find("[name=hidCurrentCustomerKey]").val(""),r.find("[name=hidCurrentCustomerName]").val("")):(r.find("[name=hidCurrentCustomerKey]").val(a.item.pkey),r.find("[name=hidCurrentCustomerName]").val(a.item.value)),o.resetDetails(),o.updateTax(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidCustomerKey"),r.find("[name=hidCurrentCustomerKey]").val(""),r.find("[name=hidCurrentCustomerName]").val("")):(r.find("[name=hidCurrentCustomerKey]").val(a.item.pkey),r.find("[name=hidCurrentCustomerName]").val(a.item.value)),o.updateVoucher(),o.rebindEl()),o.rebindDownpayment()},this.updateTax=function(){$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getTaxInformation&pkey="+r.find("[name=hidCustomerKey]").val(),success:function(e){if(o.customerTax=0,e){var e=JSON.parse(e);o.customerTax=e.taxpercentage}}})},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pelanggan ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){r.find("[name=selCurrency]").val(r.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){r.find("[name=hidCurrentCurrencyKey]").val(r.find("[name=selCurrency]").val()),o.resetDetails(),$(this).dialog("close")},Cancel:function(){r.find("[name=selCurrency]").val(r.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeChk=function(){o.calculateTotal()},this.onChangePaymentMethodHandler=function(){o.calculateTotal(),o.rebindDownpayment(),o.rebindCost()},this.afterRemoveRowHandler=function(){o.calculateTotal()},this.rebindEl=function(){bindEl(r.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,o.onChangeChk)}),bindEl(r.find("[name='discount[]'], [name='amount[]'], [name='taxPPH[]']"),"change",function(){o.calculateTotal()}),o.rebindARCode();var e=r.find(".mnv-downpayment");bindEl(e.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(o,e,"downpayment-row-template")}),bindEl(e.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(o,e,"downpayment-row-template")});var a=r.find(".mnv-cost");bindEl(a.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(o,a,"cost-row-template")}),bindEl(a.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(o,a,"cost-row-template")});var n=r.find(".mnv-payment-method");bindEl(n.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(o,n,"payment-method-row-template")}),bindEl(n.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(o,n,"payment-method-row-template")}),o.rebindDownpayment(),o.rebindCost(),o.updateTax()},this.onChangeCurrency=function(){var e=r.find("[name='selCurrency']"),a=r.find("[name='currencyRate']"),n=!1;e.val()==t.CURRENCY.idr&&(n=!0,a.val(1)),a.prop("readonly",n),r.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}}),o.updateNumberDecimal()},this.updateNumberDecimal=function(){var e=r.find("[name='selCurrency']"),a=e.val()==t.CURRENCY.idr?!0:!1;changeNumberDecimal(r.find("[name='arAmount[]'],[name='outstanding[]'],[name='discount[]'],[name='amount[]'],[name='taxPPH[]'],[name='totalReceived'],[name='totalDiscount'],[name='pph23'],[name='totalDownpayment'],[name='downpaymentAmount[]'],[name='totalCost'],[name='costAmount[]'],[name='total'],[name='totalPayment'],[name='paymentMethodValue[]'] ,[name='balance']"),a)},this.onChangeVoucher=function(e){var a=e.find("option:selected").attr("rel-amount")||0;e.closest(".transaction-detail-row").find('[name="paymentMethodValue[]"]').val(a).change().blur(),bindEl(r.find('[name="selVoucher[]"]'),"change",function(){o.onChangeVoucher($(this))})},this.loadOnReady=function(){o.updateNumberDecimal(),r.find("[name=selTermOfPayment]").change(),r.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,o.onChangeChk)}),r.find("[name=btnImport]").on("click",function(){o.importData()}),r.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=r.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),r.find("[name=chkDatePeriod]").change(),r.find("[name=selCurrency]").change(function(){o.updateCurrency()}),r.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(r.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(r.find("[name=trEndDate]").val()));e>a&&r.find("[name=trEndDate]").val(r.find("[name=trStartDate]").val())}),r.find("[name=selCurrency]").change(function(){o.onChangeCurrency()}),bindEl(r.find('[name="selVoucher[]"]'),"change",function(){o.onChangeVoucher($(this))}),r.find("[name='chkPick-master']").val(1).change(),addNewTemplateRow("downpayment-row-template"),addNewTemplateRow("cost-row-template"),o.rebindEl()}}function RoutineCost(e){$("#"+e);this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){}}function CustomCode(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null,this.pkey=a.length>0?a[0].pkey:0,this.updateIncrementNumber=function(){var e=0,a=t.find("[name=selResetType]").val(),i=t.find("[name=selWarehouseKey]").val(),o=t.find("[name=chkResetWarehouse]").val();0==o&&(i=0);var r=t.find("[name=increment]");2==a?(e=t.find("[name=selDailyPeriod]").val(),r=t.find("[name=dailyIncrement]")):3==a?(e=t.find("[name=selMonthlyPeriod]").val(),r=t.find("[name=monthlyIncrement]")):4==a&&(e=t.find("[name=selAnnuallyPeriod]").val(),r=t.find("[name=annuallyIncrement]")),$.ajax({type:"POST",url:"ajax-custom-code.php",data:{action:"getRunningNumber",pkey:n.pkey,resetTypeKey:a,warehousekey:i,trDate:e},success:function(e){var e=JSON.parse(e);r.val(e).blur()}})},this.showAutoCode=function(e){1==$(e).val()?t.find(".showAutoCode").show():t.find(".showAutoCode").hide()},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=selResetType]").change(function(){t.find(".increment-number").hide(),t.find(".increment-number."+$(this).val()).show(),n.updateIncrementNumber()}),t.find("[name=selDailyPeriod], [name=selMonthlyPeriod], [name=selAnnuallyPeriod], [name=selWarehouseKey], [name=chkResetWarehouse]").change(function(){n.updateIncrementNumber()}),t.find("[name=selResetType]").change(),t.find("[name=chkIsAutoCode]").on("change",function(){n.showAutoCode(this)}),t.find("[name=chkIsAutoCode]").change()}}function TemplateEMKLPurchaseItem(e){{var a=this;$("#"+e)}this.tabID=e;var n=new Array;n.push({object:"hidCostKey[]",value:"pkey"});var t=n;this.getRowObj=function(e){return e.closest(".div-table-row")},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("costName[]",t,"ajax-item.php?action=searchData&itemtype=3")},this.loadOnReady=function(){a.rebindEl()}}function Supplier(e){{var a=this;$("#"+e)}this.tabID=e;var n=new Array;n.push({object:"hidServiceKey[]",value:"pkey"});var t=n,n=new Array;n.push({object:"hidContainerDetailKey[]",value:"pkey"});var i=n,n=new Array;n.push({object:"hidLocationDetailKey[]",value:"pkey"});var o=n;this.rebindEl=function(){bindAutoCompleteForTransactionDetail("containerDetailName[]",i,"ajax-container.php?action=searchData"),bindAutoCompleteForTransactionDetail("locationDetailName[]",o,"ajax-location.php?action=searchData"),bindAutoCompleteForTransactionDetail("serviceName[]",t,"ajax-item.php?action=searchData&itemtype=3")},this.loadOnReady=function(){a.rebindEl()}}function TemplateCustomer(e){var a=this,n=($("#"+e),new Array);n.push({object:"hidCustomerKey[]",value:"pkey"});var t=n;this.tabID=e,this.rebindEl=function(){bindAutoCompleteForTransactionDetail("customerName[]",t,"ajax-customer.php?action=searchData&statuskey=2")},this.loadOnReady=function(){a.rebindEl()}}function Membership(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function TemplateSupplier(e){var a=this,n=($("#"+e),new Array);n.push({object:"hidSupplierKey[]",value:"pkey"});var t=n;this.tabID=e,this.rebindEl=function(){bindAutoCompleteForTransactionDetail("supplierName[]",t,"ajax-supplier.php?action=searchData")},this.loadOnReady=function(){a.rebindEl()}}function MembershipAttendance(e){var a=this,n=$("#"+e);this.tabID=e,this.updateMembership=function(){var e=n.find("[name=selCustomerMembership]").val();$.ajax({type:"GET",url:"ajax-customer-membership.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){if(e){var e=JSON.parse(e);if(e=e[0],!e)return;n.find("[name=maxAttendance]").val(e.maxattendance),n.find("[name=timeLimit]").val(e.timelimit),n.find("[name=selMembership]").val(e.membershipkey),n.find("[name=attendance]").val(e.attendance),n.find(".inputnumber").change().blur()}})},this.updateCustomer=function(){var e=n.find("[name=hidCustomerKey]").val();e&&$.ajax({type:"GET",url:"ajax-customer-membership.php",async:!1,data:"action=getCustomer&customerkey="+e}).done(function(e){var a=n.find(" [name=selCustomerMembership]");if($("option",a).remove(),e&&(e=JSON.parse(e),e[0])){var t={};for(i=0;i<e.length;i++)t[e[i].pkey]=e[i].code;if(a.prop)var o=a.prop("options");else var o=a.attr("options");$("option",a).remove(),$.each(t,function(e,a){o[o.length]=new Option(a,e)}),a.find("option:eq(0)").prop("selected",!0).change()}})},this.rebindEl=function(){},this.loadOnReady=function(){n.find("[name=selCustomerMembership]").change(function(){a.updateMembership()}),n.find("[name=selCustomerMembership]").val(),a.rebindEl()}}function Item(e,a,n){var t=this,o=$("#"+e);this.tabID=e;var r=(a.uploadImageFolder,a.arrImage?a.arrImage:Array(),a.arrPHPThumbHash?a.arrPHPThumbHash:Array(),a.uploadFileFolder,a.arrFile?a.arrFile:Array(),o.find("[name=hidId]").val()),l=new Array;l.push({object:"hidItemPackageKey[]",value:"pkey"});var d=l,l=new Array;l.push({object:"hidItemSpecificationKey[]",value:"pkey"});var c=l,s={};this.updateMarketplaceAttributes=function(){a.hasActiveMarketplace&&($.ajax({type:"GET",url:"ajax-marketplace.php",async:!1,beforeSend:function(){o.find(".attributes-row").not(".row-template").remove()},data:"action=getMarketplaceCategoryAttributes&categorykey="+o.find("[name=hidCategoryKey]").val(),success:function(e){if(e){var e=JSON.parse(e),a=e.length;for(i=0;a>i;i++)for(var n=e[i].marketplacekey,o=e[i].attributes,r="#"+t.tabID+" .attributes-"+n,l=o.length-1,d=l;d>=0;d--){var c=[];c.push({selector:"hidAttributeDetailKey",value:0}),c.push({selector:"hidMarketplaceKey",value:e[i].marketplacekey}),c.push({selector:"hidCategoryAttributeName",value:o[d].name}),c.push({selector:"hidCategoryAttributeKey",value:o[d].attributekey}),c.push({selector:"hidAttributeLabel",value:o[d].label});var s=o[d].description?'<div class="tag">'+o[d].description+"</div>":"";$newRow=addNewTemplateRow("category-attribute-row-template",JSON.stringify(c),null,null,r),o[d].class&&$newRow.addClass(o[d].class),$newRow.find(".attribute-label").html(o[d].label),$newRow.find(".attribute-value").html(o[d].input+s)}}},error:function(){}}),t.updateVariant())},this.updateItemParent=function(){if(a.usevariant){var e=o.find("[name=hidParentItemKey]").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){if(e){if(e=JSON.parse(e),0==e.length)return void alert(phpErrorMsg[213]);e=e[0],o.find("[name=hidCategoryKey]").val(e.categorykey),o.find("[name=categoryName]").val(e.categoryname),o.find("[name=hidBrandKey]").val(e.brandkey),o.find("[name=brandName]").val(e.brandname)}})}},this.updateVariant=function(e){if(a.usevariant){var n=o.find("[name=hidParentItemKey]").val();$.ajax({type:"GET",url:"ajax-marketplace.php",async:!1,beforeSend:function(){},data:"action=getMarketplaceCategoryVariant&parentkey="+n+"&categorykey="+o.find("[name=hidCategoryKey]").val(),success:function(a){if(a){var a=JSON.parse(a);0!=a.length&&$.each(a,function(n){var i=n,r=a[i];if(r&&!e){var l=o.find('[name="selVariant'+i+'[]"]');reInsertSelectBox(l,r,{key:"key",label:"label"}),t.updateVariantReadonly()}})}},error:function(){}})}},this.updateVariantReadonly=function(){var e=1==o.find("[name=chkIsVariant]").val()?!0:!1,a=o.find(".select-variant");updateComboboxReadonly(a,e)},this.importContentOfPackage=function(){o.find("[name=hidContentOfPackageKey]").val()&&(loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-item-checklist-group.php",async:!1,beforeSend:function(){clearAllRows(o.find(".package-list")),t.activeAjaxConnections++},data:"action=getDetailById&pkey="+o.find("[name=hidContentOfPackageKey]").val(),success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidItemPackageKey",value:e[a].itemkey}),n.push({selector:"itemPackageName",value:e[a].itemname}),n.push({selector:"qty",value:e[a].qty}),$newRow=addNewTemplateRow("detail-content-of-package-row-template",JSON.stringify(n)),$newRow.find(".baseitemunit").html(e[a].baseunitname)}o.find(".inputnumber").change().blur(),t.rebindEl(),decreaseActiveAjaxConnections(t)},error:function(){decreaseActiveAjaxConnections(t)}}))},this.importMarketplaceAttributes=function(){$.ajax({type:"GET",url:"ajax-item.php",async:!1,beforeSend:function(){clearAllRows(o.find(".package-list")),t.activeAjaxConnections++},data:"action=getMarketplaceCategoryAttributes&pkey="+o.find("[name=hidItemImportKey]").val(),success:function(e){if(e){var a,n,e=JSON.parse(e);o.find('[name="attributeValue[]"]').each(function(){a=$(this).closest(".attributes-row").find('[name="hidMarketplaceKey[]"]').val(),n=$(this).closest(".attributes-row").find('[name="hidCategoryAttributeKey[]"]').val(),e[a]&&e[a][n]&&$(this).val(e[a][n])}),o.find(".inputnumber").change().blur(),t.rebindEl(),decreaseActiveAjaxConnections(t)}},error:function(){decreaseActiveAjaxConnections(t)}})},this.updateCommissionDecimal=function(e){var a=$(e).parent().parent(),n=a.find("[name='commissionValue']"),t=$(e).val();n.removeClass("inputnumber").addClass("inputdecimal"),1==t?n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this))}):n.unbind("blur").bind("blur",function(){inputNumberOnBlur($(this),2)}),n.blur()},this.useVariant=function(e){var a=$(e).val(),n=o.find("[name=categoryName]"),i=o.find("[name=brandName]");1==a?(o.find(".isvariant, .variant-option-col").show(),n.prop("readonly",!0),n.closest("div").find(".add-button").hide(),i.prop("readonly",!0),i.closest("div").find(".add-button").hide()):(o.find(".isvariant, .variant-option-col").hide(),n.prop("readonly",!1),n.closest("div").find(".add-button").show(),i.prop("readonly",!1),i.closest("div").find(".add-button").show()),t.updateVariantReadonly()},this.updateChkSync=function(){var e=o.find("[name=chkSyncAllMarketplace]");e.attr("relignore")||(e.attr("relignore",!0),o.find('[name="chkSyncToMarketplace[]"]').val(e.val()).change(),e.removeAttr("relignore"))},this.updateChkSyncToAll=function(){var e=o.find("[name=chkSyncAllMarketplace]");if(!e.attr("relignore")){e.attr("relignore",!0);var a=o.find('[name="chkSyncToMarketplace[]"][value=0]');o.find("[name=chkSyncAllMarketplace]").val(a.length>0?0:1).change(),e.removeAttr("relignore")}},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemPackageName[]",d,"ajax-item-checklist.php?action=searchData"),bindAutoCompleteForTransactionDetail("itemSpecificationName[]",c,"ajax-item-specification.php?action=searchData"),bindEl(o.find("[name=chkSyncAllMarketplace]"),"change",function(){t.updateChkSync()}),bindEl(o.find('[name="chkSyncToMarketplace[]"]'),"change",function(){t.updateChkSyncToAll()})},this.updateMPBrandAttribute=function(){a.hasActiveMarketplace&&$.ajax({type:"GET",url:"ajax-brand.php",async:!1,beforeSend:function(){},data:"action=getBrandUsedForShopee&categorykey="+o.find("[name=hidCategoryKey]").val()+"&brandkey="+o.find("[name=hidBrandKey]").val(),success:function(e){if(e){var e=JSON.parse(e);if(0!=e.length){var a=void 0!=e[0].marketplacebrandname?e[0].marketplacebrandname:"";o.find("[attr-label=brand]").val(a)}}},error:function(){}})},this.updateVariantOpt=function(e){if(a.usevariant){var t=e.attr("attr-marketplacekey"),i=e.val();if(t==n.MARKETPLACE.tokopedia){var o=e.closest(".variant-row").find('[name="selOption'+t+'[]"]');if(null==i)return;
var r=s[t][i];reInsertSelectBox(o,r)}}},this.loadOnReady=function(){a.showItemImage&&(r?(createImageUploader({tabID:t.tabID,name:a.imageUploaderTarget},{folder:a.uploadImageFolder,token:r,arrImage:a.arrImage,phpThumbHash:a.arrPHPThumbHash},!0,!0),createFileUploader(a.fileUploaderTarget,a.uploadFileFolder,r,a.arrFile,!0)):(createImageUploader({tabID:t.tabID,name:a.imageUploaderTarget},{folder:a.uploadImageFolder},!0,!0),createFileUploader(a.fileUploaderTarget,a.uploadFileFolder,"","",!0)),o.find(".image-list ").sortable({placeholder:"sortable-placeholder",stop:function(){updateItemImageArray({tabID:t.tabID,name:a.imageUploaderTarget})}}),o.find(".image-list").disableSelection(),o.find(".file-list").sortable({placeholder:"sortable-placeholder",stop:function(){updateItemFileArray(a.fileUploaderTarget)}}),o.find(".file-list").disableSelection()),a.usevariant&&(o.find("[name=chkIsVariant]").change(function(){t.useVariant(this)}),o.find(" [name=chkIsVariant]").change()),a.showItemDescription&&o.find("[name=btnAddDescription]").on("click",function(){addNewTemplateRow("item-description-row-template")}),o.find("[name=selCommissionType]").on("click",function(){t.updateCommissionDecimal(this)}),o.find("[name=btnImportMarketplaceAttribute]").on("click",function(){t.importMarketplaceAttributes()}),o.find("[name=btnAddUnitConversion]").on("click",function(){addNewTemplateRow("unit-conversion-row-template")}),o.find("[name=btnAddPartNumberRows]").on("click",function(){addNewTemplateRow("vendor-part-number-row-template")}),o.find("[name=btnAddPackageRows]").on("click",function(){addNewTemplateRow("detail-content-of-package-row-template"),t.rebindEl()}),o.find("[name=btnAddSpecificationRows]").on("click",function(){addNewTemplateRow("detail-item-specification-row-template"),t.rebindEl()}),o.find("[name=selBaseUnitKey]").change(function(){o.find(".baseitemunit").html($(this).find("option:selected").text())}),o.find("[name=selBaseUnitKey]").change(),o.find(".section-panel .title").click(function(){$(this).closest(".section-panel").find(".section-panel-content").first().toggle()}),a.showItemDescription&&0==a.rsItemDescription.length&&addNewTemplateRow("item-description-row-template"),a.showMultiUnit&&0==a.rsItemUnitConversion.length&&addNewTemplateRow("unit-conversion-row-template"),a.showContentOfPackage&&0==a.rsItemPackageOfContentDetail.length&&addNewTemplateRow("detail-content-of-package-row-template"),a.showItemSpecification&&0==a.rsItemSpecification.length&&addNewTemplateRow("detail-item-specification-row-template"),a.showTimeUnit&&0==a.rsTimeConversion.length&&addNewTemplateRow("timeconversion-row-template"),t.updateVariant(!0),o.find('[name="chkSyncToMarketplace[]"]').each(function(){var e=$(this).closest("div").find('[name="hidSyncMarketplaceKey[]"]').val();o.find('[name="selVariant'+e+'[]"]').on("change",function(){t.updateVariantOpt($(this))})}),t.rebindEl()}}function Voucher(e,a){var n=this,t=$("#"+e);this.tabID=e;var i=new Array;i.push({object:"hidCityKey[]",value:"pkey"});var o=i,i=new Array;i.push({object:"hidCityCategoryKey[]",value:"pkey"});var r=i,i=new Array;i.push({object:"hidCategoryKey[]",value:"pkey"});var l=i,i=new Array;i.push({object:"hidBrandKey[]",value:"pkey"});var d=i,i=new Array;i.push({object:"hidItemKey[]",value:"pkey"});var c=i;this.onChangeVoucherCategory=function(){},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("cityName[]",o,"ajax-city.php?action=searchData"),bindAutoCompleteForTransactionDetail("cityCategoryName[]",r,"ajax-city-category.php?action=searchData"),bindAutoCompleteForTransactionDetail("categoryName[]",l,"ajax-item-category.php?action=searchData"),bindAutoCompleteForTransactionDetail("brandName[]",d,"ajax-brand.php?action=searchData"),bindAutoCompleteForTransactionDetail("itemName[]",c,"ajax-item.php?action=searchData")},this.loadOnReady=function(){t.find("[name='selDiscountType']").change(function(){updateFinalDiscountDecimal(this,t.find("[name=value]"))}),a.rsCityDetail&&0==a.rsCityDetail.length&&addNewTemplateRow("city-row-template",null,t.find(".city-criteria"),n.rebindEl),a.rsCityCategoryDetail&&0==a.rsCityCategoryDetail.length&&addNewTemplateRow("city-category-row-template",null,t.find(".city-category-criteria"),n.rebindEl),a.rsItemCategoryDetail&&0==a.rsItemCategoryDetail.length&&addNewTemplateRow("category-row-template",null,t.find(".item-category-criteria"),n.rebindEl),a.rsBrandDetail&&0==a.rsBrandDetail.length&&addNewTemplateRow("brand-row-template",null,t.find(".brand-criteria"),n.rebindEl),a.rsItemDetail&&0==a.rsItemDetail.length&&addNewTemplateRow("item-row-template",null,t.find(".item-criteria"),n.rebindEl),bindEl(t.find("[name=selCategory]"),"change",function(){n.onChangeVoucherCategory()}),n.onChangeVoucherCategory(),n.rebindEl()}}function VoucherTransaction(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function CustomerMembership(e){var a=this,n=$("#"+e);this.tabID=e,this.updateMembership=function(){var e=n.find("[name=selMembership]").val();$.ajax({type:"GET",url:"ajax-membership.php",data:"action=getDataRowById&pkey="+e,beforeSend:function(){n.find("[name=maxAttendance]").val(0),n.find("[name=timeLimit]").val(0)},success:function(e){if(e){var e=JSON.parse(e);if(e=e[0],!e)return;e.maxattendance&&n.find("[name=maxAttendance]").val(e.maxattendance),e.timelimit&&n.find("[name=timeLimit]").val(e.timelimit),e.price&&n.find("[name=registrationCost]").val(e.price),n.find(".inputnumber").change().blur()}}})},this.updateVoucher=function(){var e=n.find("[name=selVoucher]").val();$.ajax({type:"GET",url:"ajax-voucher-transaction.php",data:"action=getDataRowById&pkey="+e,beforeSend:function(){},success:function(e){if(e){if(!e)return;var e=JSON.parse(e);e=e[0],e.value&&n.find("[name=discountValue]").val(e.value),n.find(".inputnumber").change().blur()}}})},this.updateCustomer=function(){var e=n.find("[name=hidCustomerKey]").val();e&&$.ajax({type:"GET",url:"ajax-voucher-transaction.php",async:!1,data:"action=getAvailableVoucher&customerkey="+e,beforeSend:function(){n.find("[name=discountValue]").val(0)},success:function(e){if(e){var t=n.find(" [name=selVoucher]");$("option",t).remove();for(var e=JSON.parse(e),i={},o=0;o<e.length;o++)i[e[o].pkey]=e[o].code;var r=t.prop?t.prop("options"):t.attr("options");$("option",t).remove(),$.each(i,function(e,a){r[r.length]=new Option(a,e)}),t.find("option:eq(0)").prop("selected",!0).change()}a.calculateTotal()}})},this.calculateTotal=function(){var e,a=parseInt(unformatCurrency(n.find("[name=discountValue]").val())),t=parseInt(unformatCurrency(n.find("[name=registrationCost]").val()));e=t-a,n.find("[name=balance]").val(e).blur()},this.rebindEl=function(){},this.loadOnReady=function(){n.find("[name=selMembership]").change(function(){a.updateMembership()}),n.find("[name=selVoucher]").change(function(){a.updateVoucher()}),n.find("[name=discountValue],[name=registrationCost]").change(function(){a.calculateTotal()}),a.rebindEl(),n.find("[name=selMembership]").change()}}function Shipment(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidMarketplaceLogisticKey[]",value:"pkey"});var i=t;this.tabID=e;var o=(n.find("[name=hidId]").val(),"");this.rebindEl=function(){bindAutoCompleteForTransactionDetail("marketplaceLogisticName[]",i,"ajax-marketplace.php?action=getMarketplaceLogistics&marketplaceKey="+o),n.find("[name='marketplaceLogisticName[]']").focus(function(){o=$(this).closest(".marketplace-logistic-row").find("[name='hidMarketplaceKey[]']").val(),a.rebindEl()})},this.loadOnReady=function(){n.find("[name='marketplaceLogisticName[]']").focus(function(){o=$(this).closest(".marketplace-logistic-row").find("[name='hidMarketplaceKey[]']").val(),a.rebindEl()}),a.rebindEl()}}function ARAPNetting(e,a,n,t){var o=this,r=$("#"+e);this.tabID=e,this.tablekey=a,this.rs=n.length>0?n[0]:null,this.customerTax=0;var l=new Array;l.push({object:"hidDownpaymentKey[]",value:"pkey"}),l.push({object:"downpaymentAmount[]",value:"outstanding"});var l=new Array;l.push({object:"hidCostKey[]",value:"pkey"});var l=new Array;l.push({object:"hidARKey[]",value:"pkey"}),l.push({object:"refCode[]",value:"refcode"}),l.push({object:"arOutstanding[]",value:"outstanding"}),l.push({object:"arAmount[]",value:"outstanding"});var d=l,l=new Array;l.push({object:"hidAPKey[]",value:"pkey"}),l.push({object:"refAPCode[]",value:"refcode"}),l.push({object:"apOutstanding[]",value:"outstanding"}),l.push({object:"apAmount[]",value:"outstanding"});var c=l;this.resetDetails=function(){o.resetARDetails(),o.resetAPDetails()},this.resetARDetails=function(){clearAllRows(r.find(".mnv-ar")),o.calculateTotalAR()},this.resetAPDetails=function(){clearAllRows(r.find(".mnv-ap")),o.calculateTotalAP()},this.updateDetailAR=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).change().blur();t.find('[name="arCode[]"]').first().val(n.item.code),o.calculateTotalAR()},this.updateDetailAP=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).change().blur();t.find('[name="apCode[]"]').first().val(n.item.code),o.calculateTotalAP()},this.calculateTotal=function(){var e=0,a=0,n=0,t=0;e=parseFloat(unformatCurrency(r.find("[name='totalARAmount']").val())),t=parseFloat(unformatCurrency(r.find("[name='totalTaxARAmount']").val())),a=parseFloat(unformatCurrency(r.find("[name='totalAPAmount']").val())),n=parseFloat(unformatCurrency(r.find("[name='totalTaxAPAmount']").val()));var i=e-t;r.find("[name='grandtotalARAmount']").val(i).blur();var o=a-n;r.find("[name='grandtotalAPAmount']").val(o).blur()},this.calculateTotalTaxAR=function(){var e=0;r.find("[name='hidARKey[]']").each(function(){var a=$(this).closest(".div-table-row").find("[name='arTax23[]']");e+=parseFloat(unformatCurrency(a.val()))||0}),r.find("[name='totalTaxARAmount']").val(e).blur(),o.calculateTotal()},this.calculateTotalTaxAP=function(){var e=0;r.find("[name='hidAPKey[]']").each(function(){var a=$(this).closest(".div-table-row").find("[name='apTax23[]']");e+=parseFloat(unformatCurrency(a.val()))||0}),r.find("[name='totalTaxAPAmount']").val(e).blur(),o.calculateTotal()},this.calculateTotalAR=function(){var e=0;r.find("[name='hidARKey[]']").each(function(){var a=$(this).closest(".div-table-row").find("[name='arAmount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}),r.find("[name='totalARAmount']").val(e).blur(),o.calculateTotal()},this.calculateTotalAP=function(){var e=0;r.find("[name='hidAPKey[]']").each(function(){var a=$(this).closest(".div-table-row").find("[name='apAmount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}),r.find("[name='totalAPAmount']").val(e).blur(),o.calculateTotal()},this.rebindAR=function(){bindEl(r.find("[name='arTax23[]']"),"change",function(){o.calculateTotalTaxAR()}),bindEl(r.find("[name='arAmount[]']"),"change",function(){o.calculateTotalAR()}),bindAutoCompleteForTransactionDetail("arCode[]",d,"ajax-ar.php?action=searchData&customerkey="+r.find("[name=hidCustomerKey]").val(),o.updateDetailAR)},this.rebindAP=function(){bindEl(r.find("[name='apTax23[]']"),"change",function(){o.calculateTotalTaxAP()}),bindEl(r.find("[name='apAmount[]']"),"change",function(){o.calculateTotalAP()}),bindAutoCompleteForTransactionDetail("apCode[]",c,"ajax-ap.php?action=searchData&supplierkey="+r.find("[name=hidSupplierKey]").val(),o.updateDetailAP)},this.importDataAR=function(){var e=1==r.find("[name=chkDatePeriod]").val()?!0:!1,a=r.find("[name=hidCustomerKey]").val();if(a){var n="";if(e){var t=convertDateToStandartFormat(r.find("[name=trStartDate]").val()),i=convertDateToStandartFormat(r.find("[name=trEndDate]").val());n="&startdate="+t+"&enddate="+i}var l="action=searchData&currencykey="+r.find("[name=selCurrency]").val()+"&customerkey="+a+" "+n;$.ajax({type:"GET",url:"ajax-ar.php",data:l}).done(function(e){var e=JSON.parse(e);if(0==e.length)return addNewTemplateRow("ar-row-template"),void alert(phpErrorMsg[213]);var a;for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidARKey",value:e[a].pkey}),n.push({selector:"arCode",value:e[a].code}),n.push({selector:"arRefCode",value:e[a].refcode}),n.push({selector:"arRefCode2",value:e[a].refcode2}),n.push({selector:"arOutstanding",value:e[a].outstanding}),n.push({selector:"arAmount",value:e[a].outstanding}),addNewTemplateRow("ar-row-template",JSON.stringify(n))}o.rebindAR(),r.find(".inputnumber").change().blur(),r.find(".inputdecimal").change().blur(),o.calculateTotalAR()})}},this.importDataAP=function(){var e=1==r.find("[name=chkDatePeriod]").val()?!0:!1,a=r.find("[name=hidSupplierKey]").val();if(a){var n="";if(e){var t=convertDateToStandartFormat(r.find("[name=trStartDate]").val()),i=convertDateToStandartFormat(r.find("[name=trEndDate]").val());n="&startdate="+t+"&enddate="+i}var l="action=searchData&currencykey="+r.find("[name=selCurrency]").val()+"&supplierkey="+a+" "+n;$.ajax({type:"GET",url:"ajax-ap.php",data:l}).done(function(e){var e=JSON.parse(e);if(0==e.length)return addNewTemplateRow("ap-row-template"),void alert(phpErrorMsg[213]);var a;for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidAPKey",value:e[a].pkey}),n.push({selector:"apCode",value:e[a].code}),n.push({selector:"apRefCode",value:e[a].refcode}),n.push({selector:"apRefCode2",value:e[a].refcode2}),n.push({selector:"apOutstanding",value:e[a].outstanding}),n.push({selector:"apAmount",value:e[a].outstanding}),addNewTemplateRow("ap-row-template",JSON.stringify(n))}o.rebindAP(),r.find(".inputnumber").change().blur(),r.find(".inputdecimal").change().blur(),o.calculateTotalAP()})}},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),o.activeAjaxConnections=0,o.activeAjaxConnections++,o.resetDetails(),o.importDataAR(),o.importDataAP(),decreaseActiveAjaxConnections(o)},this.updateCustomerInformation=function(e,a){var n=this;""!=r.find("[name=hidCurrentCustomerKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){r.find("[name=hidCustomerKey]").val(r.find("[name=hidCurrentCustomerKey]").val()),r.find("[name=customerName]").val(r.find("[name=hidCurrentCustomerName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),o.rebindAR()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidCustomerKey"),r.find("[name=hidCurrentCustomerKey]").val(""),r.find("[name=hidCurrentCustomerName]").val("")):(r.find("[name=hidCurrentCustomerKey]").val(a.item.pkey),r.find("[name=hidCurrentCustomerName]").val(a.item.value)),o.resetARDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidCustomerKey"),r.find("[name=hidCurrentCustomerKey]").val(""),r.find("[name=hidCurrentCustomerName]").val("")):(r.find("[name=hidCurrentCustomerKey]").val(a.item.pkey),r.find("[name=hidCurrentCustomerName]").val(a.item.value)),o.rebindAR())},this.updateSupplierInformation=function(e,a){var n=this;""!=r.find("[name=hidCurrentSupplierKey]").val()?($("#dialog-message").html("Merubah pemasok akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pemasok",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){r.find("[name=hidSupplierKey]").val(r.find("[name=hidCurrentSupplierKey]").val()),r.find("[name=supplierName]").val(r.find("[name=hidCurrentSupplierName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),o.rebindAP()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),r.find("[name=hidCurrentSupplierKey]").val(""),r.find("[name=hidCurrentSupplierName]").val("")):(r.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),r.find("[name=hidCurrentSupplierName]").val(a.item.value)),o.resetAPDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),r.find("[name=hidCurrentSupplierKey]").val(""),r.find("[name=hidCurrentSupplierName]").val("")):(r.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),r.find("[name=hidCurrentSupplierName]").val(a.item.value)),o.rebindAP())},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pelanggan ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){r.find("[name=selCurrency]").val(r.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){r.find("[name=hidCurrentCurrencyKey]").val(r.find("[name=selCurrency]").val()),o.resetDetails(),$(this).dialog("close")},Cancel:function(){r.find("[name=selCurrency]").val(r.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.afterRemoveRowHandler=function(){o.calculateTotalAR(),o.calculateTotalAP()},this.rebindEl=function(){},this.onChangeCurrency=function(){var e=r.find("[name='selCurrency']"),a=r.find("[name='currencyRate']"),n=!1;e.val()==t.CURRENCY.idr&&(n=!0,a.val(1)),a.prop("readonly",n),r.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}})},this.loadOnReady=function(){r.find("[name=btnImport]").on("click",function(){o.importData()}),r.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=r.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),r.find("[name=chkDatePeriod]").change(),r.find("[name=selCurrency]").change(function(){o.updateCurrency()}),r.find(".arap-show-detail").on("click",function(){var e=$(this).closest(".arap-col").find(".options-row");e.css("display",e.is(":visible")?"none":"table");var a=$(this).attr("alt");$(this).attr("alt",$(this).html()),$(this).html(a)}),r.find(" [name=btnAddARRows]").on("click",function(){addNewTemplateRow("ar-row-template"),o.rebindAR()}),r.find(" [name=btnAddAPRows]").on("click",function(){addNewTemplateRow("ap-row-template"),o.rebindAP()}),o.calculateTotalAR(),o.calculateTotalAP(),this.rs||(addNewTemplateRow("ar-row-template"),addNewTemplateRow("ap-row-template")),r.find("[name=selCurrency]").change(function(){o.onChangeCurrency()}),o.rebindEl(),o.rebindAR(),o.rebindAP()}}function APEmployeeCommissionPayment(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null;var o=new Array;o.push({object:"hidCostKey[]",value:"pkey"});var r=o,o=new Array;o.push({object:"hidAPKey[]",value:"pkey"}),o.push({object:"refCode[]",value:"refcode"}),o.push({object:"refJOCode[]",value:"refcode2"}),o.push({object:"apAmount[]",value:"amount"}),o.push({object:"outstanding[]",value:"outstanding"}),o.push({object:"amount[]",value:"outstanding"});var l=o;this.resetDetails=function(){clearAllRows($("#"+e)),n.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(n.item[a[i].value])).change().blur();t.find('[name="apCode[]"]').first().val(n.item.code)},this.calculateTotalCost=function(){var e=0;return t.find("[name='costAmount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='totalCost']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=0,i=0,o=0;t.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var n=$(this).closest(".div-table-row").find("[name='amount[]']"),t=$(this).closest(".div-table-row").find("[name='discount[]']"),o=$(this).closest(".div-table-row").find("[name='taxPPH[]']");e+=parseInt(unformatCurrency(n.val()))||0,i+=parseInt(unformatCurrency(t.val()))||0,a+=parseInt(unformatCurrency(o.val()))||0}});var r=e+i;t.find("[name='totalPaid']").val(r).blur(),t.find("[name='totalDiscount']").val(i).blur(),t.find("[name='pph23']").val(a).blur();var o=n.calculateTotalCost(),l=e-a+o;t.find("[name='total']").val(l).blur();var d=0;t.find("[name='paymentMethodValue[]']").each(function(){d+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='totalPayment']").val(d).blur();var c=d-l;t.find("[name='balance']").val(c).blur()},this.rebindCost=function(){bindAutoCompleteForTransactionDetail("costName[]",r,"ajax-cost-cash-out.php?action=searchData")},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0;var e=1==t.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var i=convertDateToStandartFormat(t.find("[name=trStartDate]").val()),o=convertDateToStandartFormat(t.find("[name=trEndDate]").val());a="&datetype=jobsdate&startdate="+i+"&enddate="+o}var r="action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val()+a;$.ajax({type:"GET",url:"ajax-ap-employee-commission.php",beforeSend:function(){clearAllRows(t.find(".mnv-transaction")),n.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidAPKey",value:e[a].pkey}),i.push({selector:"apCode",value:e[a].code}),i.push({selector:"refCode",value:e[a].refcode}),i.push({selector:"refJOCode",value:e[a].refcode2}),i.push({selector:"apAmount",value:e[a].amount}),i.push({selector:"outstanding",value:e[a].outstanding}),i.push({selector:"amount",value:e[a].outstanding}),addNewTemplateRow("detail-row-template",JSON.stringify(i))}n.rebindEl(),t.find(".inputnumber").change().blur(),t.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(n),t.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateEmployeeInformation=function(e,a){var i=this;""!=t.find("[name=hidCurrentEmployeeKey]").val()?($("#dialog-message").html("Merubah pemasok akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pemasok",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){t.find("[name=hidEmployeeKey]").val(t.find("[name=hidCurrentEmployeeKey]").val()),t.find("[name=employeeName]").val(t.find("[name=hidCurrentEmployeeName]").val()),$(i).closest("form").bootstrapValidator("revalidateField",$(i).attr("name")),n.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.rebindEl()),n.updateTax()},this.updateTax=function(){},this.onChangeChk=function(){n.calculateTotal()},this.onChangePaymentMethodHandler=function(){n.calculateTotal(),n.rebindCost()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindEl(t.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,n.onChangeChk)}),bindEl(t.find("[name='discount[]'], [name='amount[]'], [name='taxPPH[]']"),"change",function(){n.calculateTotal()}),bindAutoCompleteForTransactionDetail("apCode[]",l,"ajax-ap-employee-commission.php?action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val(),n.updateDetail);var e=t.find(".mnv-cost");bindEl(e.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(n,e,"cost-row-template")}),bindEl(e.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(n,e,"cost-row-template")}),n.rebindCost()},this.loadOnReady=function(){t.find("[name=selTermOfPayment]").change(),t.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,n.onChangeChk)}),t.find("[name=btnImport]").on("click",function(){n.importData()}),t.find("[name=btnAddPayment]").bind("click",function(){n.onCLickAddPayment()}),t.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=t.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),t.find("[name=chkDatePeriod]").change(),t.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(t.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(t.find("[name=trEndDate]").val()));e>a&&t.find("[name=trEndDate]").val(t.find("[name=trStartDate]").val())}),t.find("[name='chkPick-master']").val(1).change(),addNewTemplateRow("cost-row-template"),n.rebindEl()}}function PaymentConfirmation(e){var a=this,n=$("#"+e);this.tabID=e,this.updateOrderInformation=function(){var e=n.find("[name='hidSalesKey']").val();$.ajax({type:"GET",async:!1,url:"ajax-sales-order.php",data:"action=getDataRowById&pkey="+e+"&statuskey=1"}).done(function(e){e=JSON.parse(e),e=e[0],n.find("[name='customerName']").val(e.customername).blur(),n.find("[name='amount']").val(e.grandtotal).blur()})},this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function ChartOfAccount(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null,this.pkey=a.length>0?a[0].pkey:0,this.updateIncrementNumber=function(){var e=0,a=t.find("[name=selResetType]").val(),i=t.find("[name=inIncrement]"),o=t.find("[name=outIncrement]");2==a?(e=t.find("[name=selDailyPeriod]").val(),i=t.find("[name=inDailyIncrement]"),o=t.find("[name=outDailyIncrement]")):3==a?(e=t.find("[name=selMonthlyPeriod]").val(),i=t.find("[name=inMonthlyIncrement]"),o=t.find("[name=outMonthlyIncrement]")):4==a&&(e=t.find("[name=selAnnuallyPeriod]").val(),i=t.find("[name=inAnnuallyIncrement]"),o=t.find("[name=outAnnuallyIncrement]")),$.ajax({type:"POST",url:"ajax-coa.php",data:{action:"getRunningNumber",pkey:n.pkey,resetTypeKey:a,trDate:e},success:function(e){if(e){var e=JSON.parse(e);e=e[0],i.val(e.counterin).blur(),o.val(e.counterout).blur()}}})},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=chkCashBank]").on("change",function(){t.find(".cashbank").toggle()}),t.find("[name=selResetType]").change(function(){t.find(".increment-number").hide(),t.find(".increment-number."+$(this).val()).show(),n.updateIncrementNumber()}),t.find("[name=selDailyPeriod], [name=selMonthlyPeriod], [name=selAnnuallyPeriod]").change(function(){n.updateIncrementNumber()}),t.find("[name=selResetType]").change(),n.rebindEl()}}function CashBank(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function SalesOrderSubscription(e,a){var n=this,t=$("#"+e);this.tabObj=t;var o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"priceInUnit[]",value:"sellingprice"});var r=o,o=new Array;o.push({object:"hidItemMonthlyKey[]",value:"pkey"}),o.push({object:"priceInUnitMonthly[]",value:"sellingprice"});var l=o;this.tabID=e,this.rs=a.length>0?a[0]:null;this.updateCustomerInformation=function(){var e=t.find("[name=hidCustomerKey]").val();e&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],t.find("[name=selMedia]").val(e.mediakey),t.find("[name=phone]").val(e.phone),t.find("[name=address]").val(e.address),t.find("[name=attention]").val(e.attention),t.find("[name=locationName]").val(e.locationname)})},this.updateDetail=function(e,a,n){{var t=$(e).closest(".transaction-detail-row");t.find('[name="hidItemKey[]"]').first()}for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();t.find('[name="itemName[]"]').first().val(n.item.value)},this.updateDetailMonthly=function(e,a,n){{var t=$(e).closest(".transaction-detail-row");t.find('[name="hidItemMonthlyKey[]"]').first()}for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();t.find('[name="itemMonthlyName[]"]').first().val(n.item.value)},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),t=unformatCurrency(a.find("[name='qty[]']").val()),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=t*i;a.find("[name='detailSubtotal[]']").val(o).blur();var r=unformatCurrency(a.find("[name='qtyMonthly[]']").val()),l=unformatCurrency(a.find("[name='priceInUnitMonthly[]']").val()),d=r*l;a.find("[name='detailSubtotalMonthly[]']").val(d).blur(),n.calculateTotal(),n.calculateTotalMonthly()},this.calculateTotalMonthly=function(){var e=0;t.find("[name='detailSubtotalMonthly[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='subtotalMonthly']").val(e).blur();var a=0;t.find("[name='hidGramasiMonthlySubtotal[]']").each(function(){a+=parseFloat($(this).val())||0});var n=t.find("[name='chkIncludeTaxMonthly']").val(),i=parseFloat(unformatCurrency(t.find("[name='taxPercentageMonthly']").val()))||0;t.find("[name='beforeTaxTotalMonthly']").val(e).blur();var o=0;0==n?(o=e*i/100,e+=o):(o=i/(100+i)*e,t.find("[name='beforeTaxTotalMonthly']").val(e-o).blur()),t.find("[name='taxValueMonthly']").val(o).blur();var r=e;t.find("[name='totalMonthly']").val(r).blur()},this.calculateTotal=function(){var e=0;t.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='subtotal']").val(e).blur();var a=0;t.find("[name='hidGramasiSubtotal[]']").each(function(){a+=parseFloat($(this).val())||0});var n=t.find("[name='chkIncludeTax']").val(),i=parseFloat(unformatCurrency(t.find("[name='taxPercentage']").val()))||0;t.find("[name='beforeTaxTotal']").val(e).blur();var o=0;0==n?(o=e*i/100,e+=o):(o=i/(100+i)*e,t.find("[name='beforeTaxTotal']").val(e-o).blur()),t.find("[name='taxValue']").val(o).blur();var r=e;t.find("[name='total']").val(r).blur()},this.showRecurring=function(){1==t.find("[name='selInvoiceRecurring']").val()?t.find(" .recurring").show():t.find(" .recurring").hide()},this.afterRemoveRowHandler=function(){n.calculateTotal(),n.calculateTotalMonthly()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData",n.updateDetail),bindAutoCompleteForTransactionDetail("itemMonthlyName[]",l,"ajax-item.php?action=searchData",n.updateDetailMonthly),bindEl(t.find("[name='qty[]'], [name='priceInUnit[]']"),"change",function(){n.calculateDetail(this)}),bindEl(t.find("[name='qtyMonthly[]'], [name='priceInUnitMonthly[]']"),"change",function(){n.calculateDetail(this)})},this.loadOnReady=function(){n.rs||addNewTemplateRow("monthly-row-template",null,null,n.rebindEl),t.find("[name=selInvoiceRecurring]").change(function(){n.showRecurring()}),t.find("[name=selInvoiceRecurring]").change(),t.find("[name=beforeTaxTotal], [name=chkIncludeTax],[name=taxPercentage]").change(function(){n.calculateTotal(this)}),t.find("[name=beforeTaxTotalMonthly], [name=chkIncludeTaxMonthly],[name=taxPercentageMonthly]").change(function(){n.calculateTotalMonthly(this)
}),t.find("[name=btnAddRows2]").on("click",function(){addNewTemplateRow("monthly-row-template",null,null,n.rebindEl)}),n.rebindEl()}}function SalesOrderRental(e,a,n){var t=this,o=$("#"+e);this.tabObj=o;var r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"priceInUnit[]",value:"sellingprice"}),r.push({object:"selUnit[]",value:"deftransunitkey"}),r.push({object:"selTimeUnit[]",value:"timeunitkey"}),r.push({object:"hidGramasi[]",value:"gramasi"});var l=r;this.tabID=e,this.rs=a.length>0?a[0]:null,this.isunlimited=n,this.updateDetail=function(e,a,n){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first(),d=o.find('[name="selTimeUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==n.item.weightunitkey&&(n.item[a[i].value]*=1e3),o.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(r,l),t.updateAvailableTimeUnit(r,d),t.updateTimeUnitPrice(d),o.find('[name="itemName[]"]').first().val(n.item.value),t.calculateDetail(r)},this.updateAvailableTimeUnit=function(e,a){var n=($(e).closest(".transaction-detail-row"),$(e).val());n&&$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getAvailableTimeUnit&itemkey="+n,success:function(e){e=JSON.parse(e);var n={};for(i=0;i<e.length;i++)n[e[i].timeunitkey]=e[i].timename;var t=a.prop?a.prop("options"):a.attr("options");$("option",a).remove(),$.each(n,function(e,a){t[t.length]=new Option(a,e)}),a.find("option:eq(0)").prop("selected",!0).change()}})},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=unformatCurrency(a.find("[name='totalDays[]']").val()),r=(unformatCurrency(a.find("[name='discountValueInUnit[]']").val()),unformatCurrency(a.find("[name='selDiscountType[]']").val()),a.find("[name='selUnit[]']")),l=(r.val(),parseFloat(r.find("option:selected").attr("relconversionmultiplier"))),d=parseFloat(a.find("[name='hidGramasi[]']").val()),c=n*i*o;a.find("[name='detailSubtotal[]']").val(c).blur(),a.find("[name='hidGramasiSubtotal[]']").val(d*n*l).blur(),t.calculateTotal()},this.calculateTotal=function(){var e=0;o.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='total']").val(e).blur()},this.updateCustomerInformation=function(){var a=o.find("[name=hidCustomerKey]").val();a&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+a}).done(function(a){a=JSON.parse(a),a=a[0];var n=a.address;o.find("[name=hidCreditLimit]").val(a.creditlimit),$("#"+e+" [name=chkIsDropship]").prop("checked")?(o.find("[name=dropshiperName]").val(a.name),o.find("[name=dropshiperPhone]").val(a.phone),o.find("[name=dropshiperAddress]").val(n)):(o.find("[name=recipientName]").val(a.name),o.find("[name=recipientPhone]").val(a.phone),o.find("[name=recipientEmail]").val(a.email),o.find("[name=recipientAddress]").val(n),o.find("[name=hidRecipientCityKey]").val(a.citykey),o.find("[name=recipientCityName]").val(a.cityandcategoryname)),o.find("[name=selTermOfPaymentKey] option[value='"+a.termofpaymentkey+"']").length>0&&o.find("[name=selTermOfPaymentKey]").val(a.termofpaymentkey).change()})},this.updateUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getTimeUnitSellingPrice&itemkey="+t+"&unitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.updateTimeUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getTimeUnitSellingPrice&itemkey="+t+"&timeunitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.updateSalesman=function(){var e=o.find("[name=hidCustomerKey]").val();o.find("[name=hidSalesKey]").val(""),o.find("[name=salesName]").val(""),$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getSalesman&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),0!=e.length&&(o.find("[name=hidSalesKey]").val(e.pkey),o.find("[name=salesName]").val(e.name)))})},this.updateQuotationInformation=function(){var e=o.find("[name=hidSalesQuotationKey]").val();$.ajax({type:"GET",url:"ajax-sales-rental-quotation.php",data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],console.log(e),o.find("[name=hidCustomerKey]").val(e.customerkey),o.find("[name=customerName]").val(e.customername),o.find("[name=hidLocationKey]").val(e.locationkey),o.find("[name=locationName]").val(e.locationname),o.find("[name=selWarehouseKey]").val(e.warehousekey),o.find("[name=quotationName]").val(e.name),o.find("[name=trDesc]").val(e.trdesc),t.updateSalesman(),t.updateRecipients()})},this.updateQuotationDetail=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0;var e=o.find("[name=hidSalesQuotationKey]").val(),a="action=getDetailById&pkey="+e;$.ajax({type:"GET",url:"ajax-sales-rental-quotation.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:a,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidItemKey",value:e[a].itemkey}),n.push({selector:"itemName",value:e[a].itemname}),n.push({selector:"qty",value:e[a].qty}),n.push({selector:"selUnit",value:e[a].unitkey}),n.push({selector:"priceInUnit",value:e[a].priceinunit}),n.push({selector:"selTimeUnit",value:e[a].timeunitkey}),n.push({selector:"totalDays",value:e[a].totaldays}),n.push({selector:"detailSubtotal",value:e[a].total}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}t.rebindEl(),o.find(".inputnumber").change().blur(),o.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(t)},error:function(){decreaseActiveAjaxConnections(t)}})},this.updateRecipients=function(){var a="",n="",i="",r="";$("#"+e+" [name=chkIsDropship]").prop("checked")?(a=o.find("[name=dropshiperName]").val(),n=o.find("[name=dropshiperPhone]").val(),r=o.find("[name=dropshiperAddress]").val()):(a=o.find("[name=recipientName]").val(),n=o.find("[name=recipientPhone]").val(),i=o.find("[name=recipientEmail]").val(),r=o.find("[name=recipientAddress]").val()),t.updateCustomerInformation()},this.updateTimeUnit=function(e){$(e).closest(".transaction-detail-row").find(".time-unit").html($(e).find("option:selected").text())},this.updateIsUnlimited=function(){var e=o.find("[name=chkIsUnlimited]").val();0==e?(o.find("[name='totalDays[]']").prop("readonly",!1),o.find("[name='totalDays[]']").val(1).blur()):(o.find("[name='totalDays[]']").prop("readonly",!0),o.find("[name='totalDays[]']").val(1).blur()),o.find("[name='totalDays[]']").each(function(){t.calculateDetail($(this))})},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.rebindItem=function(){var e="",a=[1,3];e="ajax-item.php?action=searchData&itemtype="+a+"&serviceCost=0",bindAutoCompleteForTransactionDetail("itemName[]",l,e,t.updateDetail)},this.rebindEl=function(){bindEl(o.find("[name='qty[]'], [name='priceInUnit[]'], [name='totalDays[]']"),"change",function(){t.calculateDetail(this)}),bindEl(o.find("[name='selUnit[]']"),"change",function(){t.calculateDetail(this)}),bindEl(o.find("[name='selTimeUnit[]']"),"change",function(){t.updateTimeUnitPrice(this),t.calculateDetail(this),t.updateTimeUnit(this)}),t.rebindItem()},this.loadOnReady=function(){this.isunlimited&&(o.find("[name=chkIsUnlimited]").change(function(){t.updateIsUnlimited()}),o.find("[name=chkIsUnlimited]").change()),t.rebindEl()}}function Customer(e,a){var n=this,t=$("#"+e);this.tabID=e;{var i=t.find("[name=hidId]").val();a.uploadFileFolder,a.arrFile?a.arrFile:Array()}this.updateMainAccount=function(){t.find(".main-account").toggle(),t.find(".sub-account").toggle()},this.rebindEl=function(){},this.loadOnReady=function(){var e=t.find("[name=chkIsMainAccount]");e&&e.change(function(){n.updateMainAccount()}),a.showItemImage&&(i?createFileUploader(a.fileUploaderTarget,a.uploadFileFolder,i,a.arrFile,!0):createFileUploader(a.fileUploaderTarget,a.uploadFileFolder,"","",!0),t.find(".file-list").sortable({placeholder:"sortable-placeholder",stop:function(){updateItemFileArray(a.fileUploaderTarget)}}),t.find(".file-list").disableSelection()),n.rebindEl()}}function InstallationWorkOrder(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"selUnit[]",value:"deftransunitkey"}),o.push({object:"hidGramasi[]",value:"gramasi"});var r=o,o=new Array;o.push({object:"hidTechnicianKey[]",value:"pkey"});var l=o;this.tabID=e,this.rs=a.length>0?a[0]:null,this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),o=t.find('[name="hidItemKey[]"]').first(),r=t.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==n.item.weightunitkey&&(n.item[a[i].value]*=1e3),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(o,r),t.find('[name="itemName[]"]').first().val(n.item.value)},this.updateDetailTechnician=function(e,a,n){{var t=$(e).closest(".transaction-detail-row");t.find('[name="hidTechnicianKey[]"]').first()}for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();t.find('[name="technicianName[]"]').first().val(n.item.value)},this.updateOutsource=function(e){1==$(e).val()||(t.find("[name=hidSupplierKey]").val(""),t.find("[name=supplierName]").val(""))},this.updateOrderInformation=function(){var e=t.find("[name=hidSalesOrderKey]").val();$.ajax({type:"GET",url:"ajax-sales-order-subscription.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],t.find("[name=customerName]").val(e.customername),t.find("[name=hidCustomerKey]").val(e.customerkey),t.find("[name=hidSalesKey]").val(e.saleskey),t.find("[name=salesName]").val(e.salesname),t.find("[name=selMedia]").val(e.mediakey),t.find("[name=locationName]").val(e.locationname),t.find("[name=phone]").val(e.phone),t.find("[name=address]").val(e.address),t.find("[name=selJobDetails]").val(e.jobdetailskey))})},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail),bindAutoCompleteForTransactionDetail("technicianName[]",l,"ajax-employee.php?action=searchData",n.updateDetailTechnician)},this.loadOnReady=function(){n.rs||addNewTemplateRow("technician-row-template",null,null,n.rebindEl),t.find("[name=btnAddTechnician]").on("click",function(){addNewTemplateRow("technician-row-template",null,null,n.rebindEl)}),n.rebindEl()}}function TicketSupportWorkOrder(e,a){var n=this,t=$("#"+e),i=new Array;i.push({object:"hidItemKey[]",value:"pkey"}),i.push({object:"hidGramasi[]",value:"gramasi"}),i.push({object:"selUnit[]",value:"deftransunitkey"});var o=i,i=new Array;i.push({object:"hidTechnicianKey[]",value:"pkey"});var r=i;this.tabID=e,this.rs=a.length>0?a[0]:null,this.customerData=function(){var e=t.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-customer.php",beforeSend:function(){n.activeAjaxConnections++},data:"action=getDataRowById&pkey="+e,success:function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],t.find("[name=sid]").val(e.sid),t.find("[name=customerName]").val(e.name),t.find("[name=phone]").val(e.phone),t.find("[name=attention]").val(e.attention),t.find("[name=email]").val(e.email),t.find("[name=address]").val(e.address),void t.find("[name=cityName]").val(e.cityname))},complete:function(){decreaseActiveAjaxConnections(n)}})},this.updateTicketInformation=function(){$.ajax({type:"GET",url:"ajax-ticket-support.php",beforeSend:function(){n.activeAjaxConnections++},data:"action=getDataRowById&pkey="+t.find("[name=hidSupportTicketKey]").val(),success:function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],t.find("[name=message]").val(e.message),t.find("[name=hidCustomerKey]").val(e.customerkey),void n.customerData())},complete:function(){decreaseActiveAjaxConnections(n)}})},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",o,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail),bindAutoCompleteForTransactionDetail("technicianName[]",r,"ajax-employee.php?action=searchData",n.updateDetailTechnician)},this.loadOnReady=function(){n.rs||addNewTemplateRow("technician-row-template",null,null,n.rebindEl),t.find("[name=btnAddTechnician]").on("click",function(){addNewTemplateRow("technician-row-template",null,null,n.rebindEl)}),n.rebindEl()}}function TicketSupport(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.importData=function(){$.ajax({type:"GET",url:"ajax-customer.php",beforeSend:function(){t.activeAjaxConnections++},data:"action=getDataRowById&pkey="+i.find("[name=hidCustomerKey]").val(),success:function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],i.find("[name=customerName]").val(e.name),i.find("[name=phone]").val(e.phone),i.find("[name=attention]").val(e.attention),i.find("[name=email]").val(e.email),i.find("[name=address]").val(e.address),void i.find("[name=cityName]").val(e.cityname))},complete:function(){decreaseActiveAjaxConnections(t)}})},this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpThumbHash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!0)}else createImageUploader({tabID:e,name:r},{folder:o},!0);t.rebindEl()}}function StagesProcess(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function TimeUnit(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function PurchaseRequest(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidItemKey[]",value:"pkey"}),t.push({object:"selUnit[]",value:"deftransunitkey"});var o=t;this.tabID=e,this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),o=t.find('[name="hidItemKey[]"]').first(),r=t.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(o,r),t.find('[name="itemName[]"]').first().val(n.item.value)},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),t=unformatCurrency(a.find("[name='priceInUnit[]']").val()),i=(a.find("[name='selUnit[]']").val(),n*t);a.find("[name='detailSubtotal[]']").val(i).blur()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",o,"ajax-item.php?action=searchData&itemtype=1",a.updateDetail),bindEl(n.find("[name='qty[]'], [name='priceInUnit[]'], [name='selUnit[]']"),"change",function(){a.calculateDetail(this)}),bindEl(n.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),a.calculateDetail(this)})},this.loadOnReady=function(){a.rebindEl()}}function SalesRentalQuotation(e,a){var n=this,t=$("#"+e);this.tabObj=t,this.customCodeCache=[];var o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"priceInUnit[]",value:"sellingprice"}),o.push({object:"selUnit[]",value:"deftransunitkey"}),o.push({object:"selTimeUnit[]",value:"timeunitkey"}),o.push({object:"hidGramasi[]",value:"gramasi"});var r=o;this.tabID=e,this.rs=a.length>0?a[0]:null,this.updateDetail=function(e,a,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first(),d=o.find('[name="selTimeUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==t.item.weightunitkey&&(t.item[a[i].value]*=1e3),o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).blur();o.find('[name="selTimeUnit[]"]').find("option:not(:selected)").attr("disabled",!0),o.find('[name="selTimeUnit[]"]').change(),updateAvailableUnit(r,l),n.updateAvailableTimeUnit(r,d),n.updateTimeUnitPrice(d),o.find('[name="itemName[]"]').first().val(t.item.value),n.calculateDetail(r)},this.updateAvailableTimeUnit=function(e,a){var n=($(e).closest(".transaction-detail-row"),$(e).val());n&&$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getAvailableTimeUnit&itemkey="+n,success:function(e){e=JSON.parse(e);var n={};for(i=0;i<e.length;i++)n[e[i].timeunitkey]=e[i].timename;var t=a.prop?a.prop("options"):a.attr("options");$("option",a).remove(),$.each(n,function(e,a){t[t.length]=new Option(a,e)}),a.find("option:eq(0)").prop("selected",!0).change()}})},this.updateTimeUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getTimeUnitSellingPrice&itemkey="+t+"&timeunitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),t=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=unformatCurrency(a.find("[name='totalDays[]']").val()),r=(unformatCurrency(a.find("[name='discountValueInUnit[]']").val()),unformatCurrency(a.find("[name='selDiscountType[]']").val()),a.find("[name='selUnit[]']")),l=(r.val(),parseFloat(r.find("option:selected").attr("relconversionmultiplier"))),d=parseFloat(a.find("[name='hidGramasi[]']").val()),c=t*i*o;a.find("[name='detailSubtotal[]']").val(c).blur(),a.find("[name='hidGramasiSubtotal[]']").val(d*t*l).blur(),n.calculateTotal()},this.calculateTotal=function(){var e=0;t.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='total']").val(e).blur()},this.updateCustomerInformation=function(){var e=t.find("[name=hidCustomerKey]").val();e&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],t.find("[name=recipientName]").val(e.name),t.find("[name=recipientPhone]").val(e.phone),t.find("[name=recipientEmail]").val(e.email),t.find("[name=recipientAddress]").val(e.address),t.find("[name=hidRecipientCityKey]").val(e.citykey),t.find("[name=recipientCityName]").val(e.cityandcategoryname)})},this.updateUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getUnitSellingPrice&itemkey="+t+"&unitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.updateSalesman=function(){var e=t.find("[name=hidCustomerKey]").val();t.find("[name=hidSalesKey]").val(""),t.find("[name=salesName]").val(""),$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getSalesman&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),0!=e.length&&(t.find("[name=hidSalesKey]").val(e.pkey),t.find("[name=salesName]").val(e.name)))})},this.updateRecipients=function(){var e="",a="",i="",o="";e=t.find("[name=recipientName]").val(),a=t.find("[name=recipientPhone]").val(),i=t.find("[name=recipientEmail]").val(),o=t.find("[name=recipientAddress]").val();var r=!1;if((""!=e||""!=a||""!=i||""!=o)&&(r=!0),0==r)n.updateCustomerInformation();else{var l=this;$("#dialog-message").html("Apakah Anda ingin mengganti data pengiriman dengan data default untuk pelanggan ini ?"),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){$(l).closest("form").bootstrapValidator("revalidateField",$(l).attr("name"))},buttons:{OK:function(){n.updateCustomerInformation(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}},this.updateTimeUnit=function(e){$(e).closest(".transaction-detail-row").find(".time-unit").html($(e).find("option:selected").text())},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData",n.updateDetail),bindEl(t.find("[name='qty[]'], [name='priceInUnit[]'], [name='totalDays[]']"),"change",function(){n.calculateDetail(this)}),bindEl(t.find("[name='selUnit[]']"),"change",function(){n.updateUnitPrice(this),n.calculateDetail(this)}),bindEl(t.find("[name='selTimeUnit[]']"),"change",function(){n.updateTimeUnitPrice(this),n.calculateDetail(this),n.updateTimeUnit(this)})},this.loadOnReady=function(){n.rebindEl()}}function Testimonial(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function Partners(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);i.find(".map-panel").click(function(e){var a=$(this).offset(),n=e.pageX-a.left,t=e.pageY-a.top;i.find("[name='txtMapLocation']").val(n+", "+t);var o=-6;i.find(".marker").css({top:t+o+"px",left:n+o+"px",position:"absolute"})}),multiLang(i),t.rebindEl()}}function JobOpportunities(e){var a=this,n=$("#"+e);this.tabID=e;n.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){multiLang(n),a.rebindEl()}}function Article(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val(),s=new Array;s.push({object:"hidCategoryKey[]",value:"pkey"}),s.push({object:"categoryName[]",value:"name"});var u=s;this.rebindEl=function(){bindAutoCompleteForTransactionDetail("categoryName[]",u,"ajax-article-category.php?action=searchData")},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function Page(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function Service(e,a){var n=this,t=$("#"+e);this.tabID=e;var i=t.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){a.showItemImage&&(i?(createImageUploader({tabID:n.tabID,name:a.imageUploaderTarget},{folder:a.uploadImageFolder,token:i,arrImage:a.arrImage,phpThumbHash:a.arrPHPThumbHash}),createImageUploader({tabID:n.tabID,name:a.iconUploaderTarget},{folder:a.uploadIconFolder,token:i,arrImage:a.arrIcon,phpThumbHash:a.arrIconPHPThumbHash},!1)):(createImageUploader({tabID:n.tabID,name:a.imageUploaderTarget},{folder:a.uploadImageFolder}),createImageUploader({tabID:n.tabID,name:a.iconUploaderTarget},{folder:a.uploadIconFolder},!1))),t.find("[name=btnAddDescription]").on("click",function(){addNewTemplateRow("item-description-row-template")}),multiLang(t),n.rebindEl()}}function ManagementTeam(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function CustomerCategory(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function InstallationBAST(e){var a=this,n=$("#"+e);this.tabID=e;n.find("[name=hidId]").val();this.importCustData=function(e){$.ajax({type:"GET",url:"ajax-customer.php",beforeSend:function(){a.activeAjaxConnections++},data:"action=getDataRowById&pkey="+e,success:function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],n.find("[name=customerName]").val(e.name),n.find("[name=phone]").val(e.phone),n.find("[name=attention]").val(e.attention),n.find("[name=email]").val(e.email),n.find("[name=address]").val(e.address),n.find("[name=media]").val(e.medianame),void n.find("[name=locationName]").val(e.locationname))},complete:function(){decreaseActiveAjaxConnections(a)}})},this.importJobDetailData=function(e){$.ajax({type:"GET",url:"ajax-job-detail.php",beforeSend:function(){a.activeAjaxConnections++},data:"action=getDataRowById&pkey="+e,success:function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],void n.find("[name=jobDetails]").val(e.name))},complete:function(){decreaseActiveAjaxConnections(a)}})},this.importData=function(){$.ajax({type:"GET",url:"ajax-sales-order-subscription.php",beforeSend:function(){a.activeAjaxConnections++},data:"action=getDataRowById&pkey="+n.find("[name=hidSalesOrderSubsKey]").val(),success:function(e){return e=JSON.parse(e),0==e.length?void alert(phpErrorMsg[213]):(e=e[0],a.importCustData(e.customerkey),n.find("[name=selJobDetails]").val(e.jobdetailskey),n.find("[name=selWarehouseKey]").val(e.warehousekey),n.find("[name=PICName]").val(e.employeename),void n.find("[name=products]").val(e.product))},complete:function(){decreaseActiveAjaxConnections(a)}})},this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function SalesOrderRentalWorkOrder(e,a){var n=this,t=$("#"+e);this.tabObj=t,this.customCodeCache=[];var o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"selUnit[]",value:"deftransunitkey"});var r=o;this.tabID=e,this.rs=a.length>0?a[0]:null,this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row"),o=t.find('[name="hidItemKey[]"]').first(),r=t.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==n.item.weightunitkey&&(n.item[a[i].value]*=1e3),t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(o,r),t.find('[name="itemName[]"]').first().val(n.item.value)},this.calculateTotal=function(){var e=0;t.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='total']").val(e).blur()},this.updateSalesOrderDetail=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0;var e=t.find("[name=hidSalesOrderKey]").val(),a="action=getDetailById&pkey="+e;$.ajax({type:"GET",url:"ajax-sales-order-rental.php",beforeSend:function(){clearAllRows(t.find(".mnv-transaction")),n.activeAjaxConnections++},data:a,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++)if(!(e[a].outstanding<1)){var i=[];i.push({selector:"hidRefSODetailKey",value:e[a].pkey}),i.push({selector:"hidItemKey",value:e[a].itemkey}),i.push({selector:"itemName",value:e[a].itemname}),i.push({selector:"qty",value:e[a].outstanding}),i.push({selector:"selUnit",value:e[a].baseunitkey}),addNewTemplateRow("detail-row-template",JSON.stringify(i))}t.find('[name="selTimeUnit[]"]').find("option:selected").attr("disabled",!1),t.find('[name="selTimeUnit[]"]').find("option:not(:selected)").attr("disabled",!0),n.rebindEl(),t.find(".inputnumber").change().blur(),t.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(n)},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateCustomerCity=function(e){e&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],t.find("[name=recipientCityName]").val(e.cityandcategoryname),t.find("[name=hidRecipientCityKey]").val(e.citykey)})},this.updateSalesOrderInformation=function(){var e=t.find("[name=hidSalesOrderKey]").val();$.ajax({type:"GET",url:"ajax-sales-order-rental.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],n.updateSalesOrderDetail(),n.updateCustomerCity(e.customerkey),t.find("[name=locationName]").val(e.locationname),t.find("[name=hidLocationKey]").val(e.locationkey),t.find("[name=recipientName]").val(e.recipientname),t.find("[name=hidRecipientKey]").val(e.customerkey),t.find("[name=recipientEmail]").val(e.recipientemail),t.find("[name=recipientPhone]").val(e.recipientphone),t.find("[name=recipientAddress]").val(e.recipientaddress)})},this.afterRemoveRowHandler=function(){},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData",n.updateDetail),bindEl(t.find("[name='selUnit[]']"),"change",function(){n.updateUnitPrice(this)})},this.loadOnReady=function(){n.rebindEl()}}function InvoiceTax(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function Portfolio(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!0)}else createImageUploader({tabID:e,name:r},{folder:o},!0);i.find(".map-panel").click(function(e){var a=$(this).offset(),n=e.pageX-a.left,t=e.pageY-a.top;i.find("[name='txtMapLocation']").val(n+", "+t);var o=-6;i.find(".marker").css({top:t+o+"px",left:n+o+"px",position:"absolute"})}),multiLang(i),t.rebindEl()}}function Campaign(e,a){function n(e){var a=e.val();row=e.closest(".div-table").find(".transaction-detail-row"),1==a?row.hide():row.show()}var t=this,i=$("#"+e);this.tabID=e;var o=new Array;o.push({object:"hidCategoryKey[]",value:"pkey"});var r=o,o=new Array;o.push({object:"hidBrandKey[]",value:"pkey"});var l=o,o=new Array;o.push({object:"hidItemKey[]",value:"pkey"});var d=o,o=new Array;o.push({object:"hidMarketplaceKey[]",value:"pkey"});var c=o;this.rebindEl=function(){bindAutoCompleteForTransactionDetail("categoryName[]",r,"ajax-item-category.php?action=searchData"),bindAutoCompleteForTransactionDetail("brandName[]",l,"ajax-brand.php?action=searchData"),bindAutoCompleteForTransactionDetail("itemName[]",d,"ajax-item.php?action=searchData"),bindAutoCompleteForTransactionDetail("marketplaceName[]",c,"ajax-marketplace.php?action=searchData")},this.loadOnReady=function(){i.find("[name='selDiscountType']").change(function(){updateFinalDiscountDecimal(this,i.find("[name=value]"))}),0==a.rsItemCategoryDetail.length&&addNewTemplateRow("category-row-template",null,i.find(".item-category-criteria"),t.rebindEl),0==a.rsBrandDetail.length&&addNewTemplateRow("brand-row-template",null,i.find(".brand-criteria"),t.rebindEl),0==a.rsItemDetail.length&&addNewTemplateRow("item-row-template",null,i.find(".item-criteria"),t.rebindEl),0==a.rsMarketplaceDetail.length&&addNewTemplateRow("marketplace-row-template",null,i.find(".marketplace-criteria"),t.rebindEl),i.find("[name=chkAllItem], [name=chkAllItemCategory], [name=chkAllBrand], [name=chkAllMarketplace]").change(function(){n($(this))
}),i.find("[name=chkAllItem], [name=chkAllItemCategory], [name=chkAllBrand], [name=chkAllMarketplace]").change(),t.rebindEl()}}function InvoiceOrderSubscription(e,a,n){var t=this,o=$("#"+e);this.tabObj=o;var r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"priceInUnit[]",value:"sellingprice"}),r.push({object:"selUnit[]",value:"deftransunitkey"});var l=r;this.tabID=e,this.rs=a.length>0?a[0]:null;this.getCustomerInformation=function(e){var a=e;a&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+a}).done(function(e){e=JSON.parse(e),e=e[0],o.find("[name=selMedia]").val(e.mediakey),o.find("[name=sidCode]").val(e.sid),o.find("[name=phone]").val(e.phone),o.find("[name=address]").val(e.address),o.find("[name=attention]").val(e.attention),o.find("[name=locationName]").val(e.locationname)})},this.importData=function(){clearAllRows(o.find(".mnv-transaction")),loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-sales-order-subscription.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:"action=getDetailForInvoice&pkey="+o.find("[name=hidSoKey]").val(),success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=[];a.push({selector:"hidRefSODetailKey",value:e[i].pkey}),a.push({selector:"hidItemKey",value:e[i].itemkey}),a.push({selector:"itemName",value:e[i].itemname}),a.push({selector:"qty",value:e[i].qty}),a.push({selector:"priceInUnit",value:e[i].priceinunit}),a.push({selector:"detailSubtotal",value:e[i].total}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(a)),$newRow.find(".baseitemunit").first().html(e[i].baseunitname),t.calculateDetail($newRow)}t.rebindEl(),o.find(".inputnumber, .inputdecimal").blur(),decreaseActiveAjaxConnections(t)}},complete:function(){decreaseActiveAjaxConnections(t)}}),t.calculateTotal()},this.updateSoInformation=function(){var e=o.find("[name=hidSoKey]").val();e&&$.ajax({type:"GET",url:"ajax-sales-order-subscription.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],o.find("[name=customerName]").val(e.customername),o.find("[name=hidCustomerKey]").val(e.customerkey),t.getCustomerInformation(e.customerkey),t.importData()})},this.updateDetail=function(e,a,n){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first();for(i=0;i<a.length;i++)o.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();o.find('[name="itemName[]"]').first().val(n.item.value),t.calculateDetail(r)},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=unformatCurrency(a.find("[name='qty[]']").val()),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=n*i;a.find("[name='detailSubtotal[]']").val(o).blur(),t.calculateTotal()},this.calculateTotal=function(){var e=0;o.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='subtotal']").val(e).blur();var a=parseFloat(unformatCurrency(o.find("[name='finalDiscount']").val()))||0,n=parseInt(unformatCurrency(o.find("[name='selFinalDiscountType']").val()))||0,t=o.find("[name='chkIncludeTax']").val(),i=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;0!=a&&2==n&&(a=a/100*e),e-=a,o.find("[name='beforeTaxTotal']").val(e).blur();var r=0;0==t?(r=e*i/100,e+=r):(r=i/(100+i)*e,o.find("[name='beforeTaxTotal']").val(e-r).blur()),o.find("[name='taxValue']").val(r).blur();var l=e;o.find("[name='total']").val(l).blur();var d=0;o.find("[name='paymentMethodValue[]']").each(function(){d+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(d).blur();var c=d-l;o.find("[name='balance']").val(c).blur()},this.updateUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getUnitSellingPrice&itemkey="+t+"&unitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",l,"ajax-item.php?action=searchData",t.updateDetail),bindEl(o.find("[name='qty[]'], [name='priceInUnit[]']"),"change",function(){t.calculateDetail(this)}),bindEl(o.find("[name='selUnit[]']"),"change",function(){t.updateUnitPrice(this),t.calculateDetail(this)})},this.loadOnReady=function(){o.find("[name=selTermOfPayment]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPayment]").change(),o.find("[name=beforeTaxTotal], [name=chkIncludeTax],[name=taxPercentage], [name=selFinalDiscountType], [name=finalDiscount]").change(function(){t.calculateTotal(this)}),t.rebindEl()}}function ProjectDumper(e){var a=this,n=$("#"+e);this.tabObj=n;var t=new Array;t.push({object:"hidLocationDetailKey[]",value:"pkey"}),t.push({object:"pricePerDistance[]",value:"priceperdistance"});var i=t;this.tabID=e,this.rebindEl=function(){bindAutoCompleteForTransactionDetail("locationDetailName[]",i,"ajax-location.php?action=searchData")},this.loadOnReady=function(){a.rebindEl()}}function SalesOrderDumper(e){var a=this,n=$("#"+e);this.tabID=e;n.find("[name=hidId]").val();this.recalculateTotal=function(){var e=parseFloat(unformatCurrency(n.find("[name='weight']").val()))||0,a=(parseFloat(unformatCurrency(n.find("[name='distance']").val()))||0,parseInt(unformatCurrency(n.find("[name='pricePerDistance']").val()))||0),t=e*a;n.find("[name='totalPrice']").val(t).blur()},this.importDataDetail=function(){$.ajax({type:"GET",url:"ajax-project-dumper.php",async:!1,data:"action=getLocationInformation&pkey="+n.find("[name=hidProjectKey]").val()+"&locationkey="+n.find("[name=selDestination]").val(),success:function(e){if(e){if(e=JSON.parse(e),0==e.length)return void alert(phpErrorMsg[213]);e=e[0],n.find("[name=distance]").val(e.qty).blur(),n.find("[name=pricePerDistance]").val(e.priceperdistance).blur(),a.recalculateTotal()}},complete:function(){}})},this.updateLocation=function(){$.ajax({type:"GET",url:"ajax-project-dumper.php",async:!1,data:"action=getDetailById&pkey="+n.find("[name=hidProjectKey]").val()}).done(function(e){if(e){e=JSON.parse(e);var a={};for(i=0;i<e.length;i++)a[e[i].locationkey]=e[i].locationname;var t=n.find("[name=selDestination]"),o=t.prop?t.prop("options"):t.attr("options");$("option",t).remove(),$.each(a,function(e,a){o[o.length]=new Option(a,e)}),t.find("option:eq(0)").prop("selected",!0).change()}})},this.updateProjectInformation=function(){$.ajax({type:"GET",url:"ajax-project-dumper.php",async:!1,data:"action=getDataRowById&pkey="+n.find("[name=hidProjectKey]").val(),success:function(e){if(e){if(e=JSON.parse(e),0==e.length)return void alert(phpErrorMsg[213]);e=e[0],n.find("[name=location]").val(e.locationname),a.updateLocation()}},complete:function(){}})},this.rebindEl=function(){},this.loadOnReady=function(){n.find("[name=selDestination]").change(function(){a.importDataDetail()}),n.find("[name=selDestination]").change(),n.find("[name=weight], [name=pricePerDistance],[name=distance]").change(function(){a.recalculateTotal()}),a.rebindEl()}}function Termination(e){var a=this,n=$("#"+e);this.tabID=e,this.updateOrderInformation=function(){var e=n.find("[name=hidSalesOrderKey]").val();$.ajax({type:"GET",url:"ajax-sales-order-subscription.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],n.find("[name=customerName]").val(e.customername),n.find("[name=hidCustomerKey]").val(e.customerkey),n.find("[name=hidSalesKey]").val(e.saleskey),n.find("[name=salesName]").val(e.salesname),n.find("[name=selMedia]").val(e.mediakey),n.find("[name=locationName]").val(e.locationname),n.find("[name=phone]").val(e.phone),n.find("[name=address]").val(e.address),n.find("[name=selJobDetails]").val(e.jobdetailskey),n.find("[name=sid]").val(e.sid),n.find("[name=attention]").val(e.attention))})},this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function SalesOrderRentalInvoice(e,a,n){var t=this,o=$("#"+e);this.tabObj=o,this.tabID=e,this.rs=a.length>0?a[0]:null;this.importData=function(){clearAllRows(o.find(".mnv-transaction"));var e="",a=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),n=convertDateToStandartFormat(o.find("[name=trEndDate]").val());e="&startdate="+a+"&enddate="+n,loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-sales-order-rental.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:"action=getDetailForInvoice&pkey="+o.find("[name=hidSoKey]").val()+e,success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=[];e[i].datediff<1||(a.push({selector:"hidRefSODetailKey",value:e[i].pkey}),a.push({selector:"hidItemKey",value:e[i].itemkey}),a.push({selector:"itemName",value:e[i].itemname}),a.push({selector:"qty",value:e[i].qty}),a.push({selector:"priceInUnit",value:e[i].priceinunit}),a.push({selector:"totalDays",value:e[i].datediff}),a.push({selector:"selTimeUnit",value:e[i].timeunitkey}),a.push({selector:"selUnit",value:e[i].unitkey}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(a)),$newRow.find(".baseitemunit").first().html(e[i].baseunitname),t.calculateDetail($newRow))}t.rebindEl(),o.find(".inputnumber, .inputdecimal").blur(),decreaseActiveAjaxConnections(t)}},complete:function(){decreaseActiveAjaxConnections(t)}}),t.calculateTotal()},this.updateSoInformation=function(){var e=o.find("[name=hidSoKey]").val();e&&$.ajax({type:"GET",url:"ajax-sales-order-rental.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],o.find("[name=customerName]").val(e.customername),o.find("[name=hidCustomerKey]").val(e.customerkey)})},this.updateDetail=function(e,a,n){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==n.item.weightunitkey&&(n.item[a[i].value]*=1e3),o.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();updateAvailableUnit(r,l),t.updateUnitPrice(l),o.find('[name="itemName[]"]').first().val(n.item.value),t.calculateDetail(r)},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=unformatCurrency(a.find("[name='totalDays[]']").val()),r=a.find("[name='selUnit[]']"),l=(r.val(),parseFloat(r.find("option:selected").attr("relconversionmultiplier")),n*i*o);a.find("[name='detailSubtotal[]']").val(l).blur(),t.calculateTotal()},this.calculateTotal=function(){var e=0;o.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='subtotal']").val(e).blur();var a=parseFloat(unformatCurrency(o.find("[name='finalDiscount']").val()))||0,n=parseInt(unformatCurrency(o.find("[name='selFinalDiscountType']").val()))||0,t=o.find("[name='chkIncludeTax']").val(),i=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;0!=a&&2==n&&(a=a/100*e),e-=a,o.find("[name='beforeTaxTotal']").val(e).blur();var r=0;0==t?(r=e*i/100,e+=r):(r=i/(100+i)*e,o.find("[name='beforeTaxTotal']").val(e-r).blur()),o.find("[name='taxValue']").val(r).blur();var l=e;o.find("[name='total']").val(l).blur();var d=0;o.find("[name='paymentMethodValue[]']").each(function(){d+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(d).blur();var c=d-l;o.find("[name='balance']").val(c).blur()},this.updateUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getUnitSellingPrice&itemkey="+t+"&unitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.rebindEl=function(){bindEl(o.find("[name='qty[]'], [name='priceInUnit[]'], [name='totalDays[]']"),"change",function(){t.calculateDetail(this)}),bindEl(o.find("[name='selUnit[]']"),"change",function(){t.updateUnitPrice(this),t.calculateDetail(this)})},this.loadOnReady=function(){o.find("[name=selTermOfPayment]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPayment]").change(),o.find("[name=btnImport]").on("click",function(){t.importData()}),o.find("[name=beforeTaxTotal], [name=chkIncludeTax],[name=taxPercentage], [name=selFinalDiscountType], [name=finalDiscount]").change(function(){t.calculateTotal(this)}),t.rebindEl()}}function SalesOrderDumperInvoice(e,a,n){var t=this,o=$("#"+e);this.tabObj=o;var r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"priceInUnit[]",value:"sellingprice"}),r.push({object:"selUnit[]",value:"deftransunitkey"}),r.push({object:"hidGramasi[]",value:"gramasi"});var l=r;this.tabID=e,this.rs=a.length>0?a[0]:null;this.updateProjectInformation=function(){},this.importData=function(){clearAllRows(o.find(".mnv-transaction")),loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0;var e="",a=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),n=convertDateToStandartFormat(o.find("[name=trEndDate]").val());e="&startdate="+a+"&enddate="+n,$.ajax({type:"GET",url:"ajax-project-dumper.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:"action=searchDataForInvoice&pkey="+o.find("[name=hidProjectKey]").val()+e,success:function(e){if(e){var e=JSON.parse(e);for(i=0;i<e.length;i++){var a=[];a.push({selector:"hidRefSOKey",value:e[i].sokey}),a.push({selector:"description",value:e[i].socode}),a.push({selector:"hidItemKey",value:e[i].locationkey}),a.push({selector:"itemName",value:e[i].locationname}),a.push({selector:"ritase",value:e[i].totalritase}),a.push({selector:"weight",value:e[i].totalweight}),a.push({selector:"distance",value:e[i].totaldistance}),a.push({selector:"detailSubtotal",value:e[i].grandtotal}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(a)),t.calculateDetail($newRow)}t.rebindEl(),o.find(".inputnumber, .inputdecimal").blur(),decreaseActiveAjaxConnections(t)}},complete:function(){decreaseActiveAjaxConnections(t)}}),t.calculateTotal()},this.updateProjectInformation=function(){var e=o.find("[name=hidProjectKey]").val();e&&$.ajax({type:"GET",url:"ajax-project-dumper.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],o.find("[name=customerName]").val(e.customername),o.find("[name=hidCustomerKey]").val(e.customerkey),t.importData()})},this.updateDetail=function(e,a,n){{var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first();o.find('[name="selUnit[]"]').first()}for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==n.item.weightunitkey&&(n.item[a[i].value]*=1e3),o.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();o.find('[name="itemName[]"]').first().val(n.item.value),t.calculateDetail(r)},this.calculateDetail=function(){t.calculateTotal()},this.calculateTotal=function(){var e=0;o.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='subtotal']").val(e).blur();var a=parseFloat(unformatCurrency(o.find("[name='finalDiscount']").val()))||0,n=parseInt(unformatCurrency(o.find("[name='selFinalDiscountType']").val()))||0,t=o.find("[name='chkIncludeTax']").val(),i=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;0!=a&&2==n&&(a=a/100*e),e-=a,o.find("[name='beforeTaxTotal']").val(e).blur();var r=0;0==t?(r=e*i/100,e+=r):(r=i/(100+i)*e,o.find("[name='beforeTaxTotal']").val(e-r).blur()),o.find("[name='taxValue']").val(r).blur();var l=e;o.find("[name='total']").val(l).blur();var d=0;o.find("[name='paymentMethodValue[]']").each(function(){d+=parseInt(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(d).blur();var c=d-l;o.find("[name='balance']").val(c).blur()},this.updateUnitPrice=function(){},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",l,"ajax-item.php?action=searchData",t.updateDetail)},this.loadOnReady=function(){o.find("[name=selTermOfPayment]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPayment]").change(),o.find("[name=beforeTaxTotal], [name=chkIncludeTax],[name=taxPercentage], [name=selFinalDiscountType], [name=finalDiscount]").change(function(){t.calculateTotal(this)}),t.rebindEl()}}function EmklJobOrderHeader(e,a,n){var t=this,i=$("#"+e),o=new Array;o.push({object:"hidContainerDetailKey[]",value:"pkey"});this.tabID=e,this.afterRemoveRowHandler=function(){},this.updateJob=function(){var e=i.find("[name=selContainerType]");e.val()==n.EMKL.emklType.fcl||e.val()==n.EMKL.emklType.trucking?(i.find(".lcl").hide(),i.find(".truckingfcl").show()):e.val()==n.EMKL.emklType.lcl?(i.find(".lcl").show(),i.find(".truckingfcl").hide()):(i.find(".lcl").hide(),i.find(".truckingfcl").hide())},this.rebindEl=function(){},this.loadOnReady=function(){i.find("[name=selContainerType]").change(function(){t.updateJob()}),i.find("[name=selContainerType]").change(),a&&a.containerNumberDetail&&0==a.containerNumberDetail.length&&addNewTemplateRow("container-row-template",null,null,t.rebindEl),t.rebindEl()}}function Quiz(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);questionRows=i.find(".question-row"),questionRows.each(function(){var e=$(this).find(".detail-item .transaction-detail-row");0==e.length&&addNewTemplateRow("item-row-template",null,$(this),t.rebindEl)}),descRows=i.find(".desc-row"),descRows.each(function(){var e=$(this).find(".transaction-detail-row");0==e.length&&addNewTemplateRow("desc-row-template",null,$(this),t.rebindEl)}),i.find("[name=btnAddDesc]").on("click",function(){addNewTemplateRow("desc-row-template",null,null,t.rebindEl)}),t.rebindEl()}}function Course(e){var a=this,n=$("#"+e);this.tabID=e;var t=new Array;t.push({object:"hidQuizKey[]",value:"pkey"});{var o=t;n.find("[name=hidId]").val()}this.updateDetail=function(e,a,n){{var t=$(e).closest(".transaction-detail-row");t.find('[name="hidQuizKey[]"]').first()}for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();t.find('[name="quizName[]"]').first().val(n.item.value)},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("quizName[]",o,"ajax-quiz.php?action=searchData","getTabObj().updateDetail")},this.loadOnReady=function(){a.rebindEl()}}function CashIn(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidCOAKey[]",value:"pkey"});var i=t;this.tabID=e,this.calculateTotal=function(){var e=0;n.find("[name='amount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),n.find("[name='total']").val(e).blur()},this.updateRecipientType=function(){},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.rebindEl=function(){bindEl(n.find("[name='amount[]'] "),"change",function(){a.calculateTotal()}),bindAutoCompleteForTransactionDetail("COAName[]",i,"ajax-coa.php?action=searchData")},this.loadOnReady=function(){a.rebindEl()}}function CashBankIn(e){var a=this,n=$("#"+e);this.tabID=e;var t=new Array;t.push({object:"hidCustomerKey[]",value:"pkey"});{var i=t;n.find("[name=hidId]").val()}this.calculateTotal=function(){var e=0;n.find("[name='amount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),n.find("[name='total']").val(e).blur()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.rebindEl=function(){bindEl(n.find("[name='amount[]'] "),"change",function(){a.calculateTotal()}),bindAutoCompleteForTransactionDetail("customerName[]",i,"ajax-customer.php?action=searchData")},this.loadOnReady=function(){a.rebindEl()}}function CashAdvance(e){var a=this,n=$("#"+e);this.tabID=e;n.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function CashAdvanceRealization(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null;var i=new Array;i.push({object:"hidCashAdvanceKey[]",value:"pkey"}),i.push({object:"cashAdvanceAmount[]",value:"amount"}),i.push({object:"cashAdvanceRecipient[]",value:"employeename"});var o=i,i=new Array;i.push({object:"hidServiceKey[]",value:"pkey"});var r=i,i=new Array;i.push({object:"hidJobOrderKey[]",value:"pkey"});var l=i,i=new Array;i.push({object:"hidJobHeaderKey[]",value:"pkey"});var d=i,i=new Array;i.push({object:"hidSupplierKey[]",value:"pkey"});var c=i,i=new Array;i.push({object:"hidContainerDetailKey[]",value:"pkey"});var s=i,i=new Array;i.push({object:"hidContainerHeaderDetailKey[]",value:"pkey"});var u=i,i=new Array;i.push({object:"hidDownpaymentKey[]",value:"pkey"});var m=i,i=new Array;i.push({object:"hidCOAKey[]",value:"pkey"});{var f=i;t.find("[name=hidId]").val()}this.updateCashAdvanceInformation=function(){var e=t.find("[name=hidCashAdvanceKey]").val();$.ajax({type:"GET",url:"ajax-cash-advance.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],t.find("[name=recipient]").val(e.employeename),t.find("[name=amount]").val(e.amount),t.find(".inputnumber").change().blur(),n.calculateTotal())})},this.updateJobType=function(e){var a=$(e).val();$row=$(e).closest(".transaction-detail-row"),$row.find("[class*=type-]").hide(),$row.find(".type-"+a).show();var n=$row.find("[name='hidRefTransKey[]']").val()||0;0==n&&(1==a||4==a?($row.find("[name='taxPercentage[]']").prop("readonly",!1),$row.find("[name='chkIncludeTax[]']").prop("readonly",!1),$row.find("[name='dummychkIncludeTax[]']").prop("readonly",!1),1==a?$row.find("[name='jobOrderCode[]']").prop("readonly",!1):$row.find("[name='jobHeaderCode[]']").prop("readonly",!1),$row.find("[name='containerDetailName[]']").prop("readonly",!1),$row.find("[name='serviceName[]']").prop("readonly",!1),$row.find("[name='supplierName[]']").prop("readonly",!1),$row.find("[name='refCode[]']").prop("readonly",!1)):2==a?($row.find("[name='taxPercentage[]']").prop("readonly",!0),$row.find("[name='chkIncludeTax[]']").prop("readonly",!0),$row.find("[name='dummychkIncludeTax[]']").prop("readonly",!0),$row.find("[name='jobOrderCode[]']").prop("readonly",!0),$row.find("[name='containerDetailName[]']").prop("readonly",!0),$row.find("[name='serviceName[]']").prop("readonly",!0),$row.find("[name='refCode[]']").prop("readonly",!0),$row.find("[name='supplierName[]']").prop("readonly",!1)):($row.find("[name='taxPercentage[]']").prop("readonly",!0),$row.find("[name='chkIncludeTax[]']").prop("readonly",!0),$row.find("[name='dummychkIncludeTax[]']").prop("readonly",!0),$row.find("[name='supplierName[]']").prop("readonly",!0),$row.find("[name='serviceName[]']").prop("readonly",!0),$row.find("[name='refCode[]']").prop("readonly",!0)))},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),t=parseFloat(unformatCurrency(a.find("[name='qty[]']").val()))||0,i=parseFloat(unformatCurrency(a.find("[name='amountDetail[]']").val()))||0,o=parseFloat(unformatCurrency(a.find("[name='taxPercentage[]']").val()))||0,r=a.find("[name='chkIncludeTax[]']").val(),l=t*i,d=0;0==r&&(taxValue=l*o/100,l+=taxValue),d=l,a.find("[name='subtotal[]']").val(d).blur(),n.calculateTotal()},this.calculateTotal=function(){var e=0,a=0;t.find("[name='cashAdvanceAmount[]']").each(function(){a+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='amount']").val(a).blur(),t.find("[name='subtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0});var n=a-e;t.find("[name='total']").val(e).blur(),t.find("[name='balance']").val(n).blur()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindEl(t.find("[name='cashAdvanceAmount[]'],[name='qty[]'], [name='amountDetail[]'], [name='taxPercentage[]'], [name='chkIncludeTax[]']"),"change",function(){n.calculateDetail(this)}),bindEl(t.find("[name='selJobType[]']"),"change",function(){n.updateJobType(this)}),bindAutoCompleteForTransactionDetail("supplierName[]",c,"ajax-supplier.php?action=searchData"),bindAutoCompleteForTransactionDetail("containerDetailName[]",s,"ajax-container.php?action=searchData"),bindAutoCompleteForTransactionDetail("serviceName[]",r,"ajax-item.php?action=searchData&itemtype=3"),bindAutoCompleteForTransactionDetail("jobOrderCode[]",l,"ajax-emkl-job-order.php?action=searchData&statuskey=(1,2,3)&limit=5"),bindAutoCompleteForTransactionDetail("downpaymentCode[]",m,"ajax-supplier-downpayment.php?action=searchData"),bindAutoCompleteForTransactionDetail("COAName[]",f,"ajax-coa.php?action=searchData"),bindAutoCompleteForTransactionDetail("jobHeaderCode[]",d,"ajax-emkl-job-order-header.php?action=searchData&statuskey=1&limit=5"),bindAutoCompleteForTransactionDetail("containerHeaderDetailName[]",u,"ajax-container.php?action=searchData"),bindAutoCompleteForTransactionDetail("cashAdvanceCode[]",o,"ajax-cash-advance.php?action=searchDataAdvance")},this.loadOnReady=function(){t.find("[name=btnAddDetailRow]").on("click",function(){addNewTemplateRow("job-row-template",null,null,n.rebindEl)}),n.rs||addNewTemplateRow("job-row-template",null,null,n.rebindEl);var e=t.find("[name='hidDetailItemKey[]']").length;1>=e&&addNewTemplateRow("detail-row-template",null,null,n.rebindEl),n.rebindEl(),t.find("[name='selJobType[]']").change()}}function CustomerDownpayment(e,a){{var n=this,t=$("#"+e);new Array}this.tabID=e,this.updateTypeKey=function(e){var a=e.item?e.item.tabletypekey:0;t.find("[name='selDPType']").val(a).blur()},this.onCLickAddPayment=function(){$newRow=addNewTemplateRow("payment-method-row-template")},this.calculateTotal=function(){var e=t.find("[name='taxPercentage']"),a=parseInt(unformatCurrency(t.find("[name='amount']").val()))||0,n=1==t.find("[name='chkIncludeTax']").val()?!0:!1,i=parseFloat(unformatCurrency(e.val()))||0,o=parseFloat(unformatCurrency(t.find("[name='prepaidTax23Percentage']").val()))||0,r=a,l=0;0==n?(l=a*i/100,a+=l):(l=i/(100+i)*a,r=a-l);var d=r*o/100;t.find("[name='prepaidTax23']").val(d).blur();var c=r+l-d;t.find("[name='taxValue']").val(l).blur(),t.find("[name='beforeTaxTotal']").val(r).blur(),t.find("[name='subtotal']").val(a).blur(),t.find("[name='payment']").val(c).blur()},this.onChangeCurrency=function(){var e=t.find("[name='selCurrency']"),n=t.find("[name='currencyRate']"),i=!1;e.val()==a.CURRENCY.idr&&(i=!0,n.val(1)),n.prop("readonly",i),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){n.val(1)},success:function(e){if(e){var e=JSON.parse(e);n.val(e[0].rate).blur()}}})},this.afterRemoveRowHandler=function(){},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=btnAddPayment]").on("click",function(){n.onCLickAddPayment()}),t.find("[name=selCurrency]").change(function(){n.onChangeCurrency()}),n.rebindEl()}}function SupplierDownpayment(e,a){{var n=this,t=$("#"+e);new Array}this.tabID=e,this.updateTypeKey=function(e){var a=e.item?e.item.tabletypekey:0;t.find("[name='selDPType']").val(a).blur()},this.onCLickAddPayment=function(){$newRow=addNewTemplateRow("payment-method-row-template")},this.calculateTotal=function(){var e=t.find("[name='taxPercentage']"),a=parseInt(unformatCurrency(t.find("[name='amount']").val()))||0,n=1==t.find("[name='chkIncludeTax']").val()?!0:!1,i=parseFloat(unformatCurrency(e.val()))||0,o=parseFloat(unformatCurrency(t.find("[name='prepaidTax23Percentage']").val()))||0,r=a,l=0;0==n?(l=a*i/100,a+=l):(l=i/(100+i)*a,r=a-l);var d=r*o/100;t.find("[name='prepaidTax23']").val(d).blur();var c=r+l-d;t.find("[name='taxValue']").val(l).blur(),t.find("[name='beforeTaxTotal']").val(r).blur(),t.find("[name='subtotal']").val(a).blur(),t.find("[name='payment']").val(c).blur()},this.onChangeCurrency=function(){var e=t.find("[name='selCurrency']"),n=t.find("[name='currencyRate']"),i=!1;e.val()==a.CURRENCY.idr&&(i=!0,n.val(1)),n.prop("readonly",i),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){n.val(1)},success:function(e){if(e){var e=JSON.parse(e);n.val(e[0].rate).blur()}}})},this.afterRemoveRowHandler=function(){},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=btnAddPayment]").on("click",function(){n.onCLickAddPayment()}),t.find("[name=selCurrency]").change(function(){n.onChangeCurrency()}),n.rebindEl()}}function Terminal(e){var a=this,n=($("#"+e),new Array);n.push({object:"hidItemKey[]",value:"pkey"});var t=n;this.tabID=e,this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",t,"ajax-item.php?action=searchData&itemtype=2&serviceCost=1")},this.loadOnReady=function(){a.rebindEl()}}function Depot(e){var a=this,n=($("#"+e),new Array);n.push({object:"hidItemKey[]",value:"pkey"});var t=n;this.tabID=e,this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",t,"ajax-item.php?action=searchData&itemtype=2&serviceCost=1")},this.loadOnReady=function(){a.rebindEl()}}function Storefront(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function ARDiscountApproval(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function AREmployeePayment(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null;var o=new Array;o.push({object:"hidARKey[]",value:"pkey"}),o.push({object:"refCode[]",value:"refcode"}),o.push({object:"jobOrderCode[]",value:"reftranscode2"}),o.push({object:"customerName[]",value:"customername"}),o.push({object:"refDate[]",value:"refdate",type:"date"}),o.push({object:"arAmount[]",value:"amount"}),o.push({object:"outstanding[]",value:"outstanding"}),o.push({object:"amount[]",value:"outstanding"});var r=o;this.resetDetails=function(){clearAllRows($("#"+e)),n.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(n.item[a[i].value])).change().blur();t.find('[name="arCode[]"]').first().val(n.item.code)},this.calculateTotal=function(){var e=0;t.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var a=$(this).closest(".div-table-row").find("[name='amount[]']");e+=parseInt(unformatCurrency(a.val()))||0}});var a=e;t.find("[name='totalRecieved']").val(a).blur();var n=e;t.find("[name='total']").val(n).blur();var i=0;t.find("[name='paymentMethodValue[]']").each(function(){i+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='totalPayment']").val(i).blur();
var o=i-n;t.find("[name='balance']").val(o).blur()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0;var e=1==t.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var i=convertDateToStandartFormat(t.find("[name=trStartDate]").val()),o=convertDateToStandartFormat(t.find("[name=trEndDate]").val());a="&startdate="+i+"&enddate="+o}var r="action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val()+a;$.ajax({type:"GET",url:"ajax-ar-employee.php",beforeSend:function(){clearAllRows(t.find(".mnv-transaction")),n.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidARKey",value:e[a].pkey}),i.push({selector:"arCode",value:e[a].code}),i.push({selector:"refCode",value:e[a].refcode}),i.push({selector:"jobOrderCode",value:e[a].reftranscode2}),i.push({selector:"customerName",value:e[a].customername}),i.push({selector:"refDate",value:moment(e[a].refdate).format(_DATE_FORMAT_)}),i.push({selector:"arAmount",value:e[a].amount}),i.push({selector:"outstanding",value:e[a].outstanding}),i.push({selector:"amount",value:e[a].outstanding}),addNewTemplateRow("detail-row-template",JSON.stringify(i))}n.rebindEl(),t.find(".inputnumber").change().blur(),t.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(n),t.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateEmployeeInformation=function(e,a){var i=this;""!=t.find("[name=hidCurrentEmployeeKey]").val()?($("#dialog-message").html("Merubah karyawan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Karyawan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){t.find("[name=hidEmployeeKey]").val(t.find("[name=hidCurrentEmployeeKey]").val()),t.find("[name=employeeName]").val(t.find("[name=hidCurrentEmployeeName]").val()),$(i).closest("form").bootstrapValidator("revalidateField",$(i).attr("name")),n.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.rebindEl())},this.onChangeChk=function(){n.calculateTotal()},this.onChangePaymentMethodHandler=function(){n.calculateTotal()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindEl(t.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,n.onChangeChk)}),bindEl(t.find("[name='amount[]']"),"change",function(){n.calculateTotal()}),bindAutoCompleteForTransactionDetail("arCode[]",r,"ajax-ar-employee.php?action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val(),n.updateDetail)},this.loadOnReady=function(){t.find("[name=selTermOfPayment]").change(),t.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,n.onChangeChk)}),t.find("[name=btnImport]").on("click",function(){n.importData()}),t.find("[name=btnAddPayment]").bind("click",function(){n.onCLickAddPayment()}),t.find("[name='chkPick-master']").val(1).change(),n.rebindEl()}}function APEmployee(e){$("#"+e);this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){}}function APEmployeePayment(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null;var o=new Array;o.push({object:"hidAPKey[]",value:"pkey"}),o.push({object:"refCode[]",value:"refcode"}),o.push({object:"jobOrderCode[]",value:"reftranscode2"}),o.push({object:"customerName[]",value:"customername"}),o.push({object:"apAmount[]",value:"amount"}),o.push({object:"refDate[]",value:"refdate",type:"date"}),o.push({object:"outstanding[]",value:"outstanding"}),o.push({object:"amount[]",value:"outstanding"});var r=o;this.resetDetails=function(){clearAllRows($("#"+e)),n.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(n.item[a[i].value])).change().blur();t.find('[name="apCode[]"]').first().val(n.item.code)},this.calculateTotal=function(){var e=0;t.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var a=$(this).closest(".div-table-row").find("[name='amount[]']");e+=parseInt(unformatCurrency(a.val()))||0}});var a=e;t.find("[name='total']").val(a).blur();var n=0;t.find("[name='paymentMethodValue[]']").each(function(){n+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='totalPayment']").val(n).blur();var i=n-a;t.find("[name='balance']").val(i).blur()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0;var e=1==t.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var i=convertDateToStandartFormat(t.find("[name=trStartDate]").val()),o=convertDateToStandartFormat(t.find("[name=trEndDate]").val());a="&startdate="+i+"&enddate="+o}var r="action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val()+a;$.ajax({type:"GET",url:"ajax-ap-employee.php",beforeSend:function(){clearAllRows(t.find(".mnv-transaction")),n.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidAPKey",value:e[a].pkey}),i.push({selector:"apCode",value:e[a].code}),i.push({selector:"refCode",value:e[a].refcode}),i.push({selector:"jobOrderCode",value:e[a].reftranscode2}),i.push({selector:"customerName",value:e[a].customername}),i.push({selector:"refDate",value:moment(e[a].refdate).format(_DATE_FORMAT_)}),i.push({selector:"apAmount",value:e[a].amount}),i.push({selector:"outstanding",value:e[a].outstanding}),i.push({selector:"amount",value:e[a].outstanding}),addNewTemplateRow("detail-row-template",JSON.stringify(i))}n.rebindEl(),t.find(".inputnumber").change().blur(),t.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(n),t.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateEmployeeInformation=function(e,a){var i=this;""!=t.find("[name=hidCurrentEmployeeKey]").val()?($("#dialog-message").html("Merubah karyawan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Karyawan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){t.find("[name=hidEmployeeKey]").val(t.find("[name=hidCurrentEmployeeKey]").val()),t.find("[name=employeeName]").val(t.find("[name=hidCurrentEmployeeName]").val()),$(i).closest("form").bootstrapValidator("revalidateField",$(i).attr("name")),n.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.rebindEl())},this.onChangeChk=function(){n.calculateTotal()},this.onChangePaymentMethodHandler=function(){n.calculateTotal()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindEl(t.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,n.onChangeChk)}),bindEl(t.find("[name='amount[]']"),"change",function(){n.calculateTotal()}),bindAutoCompleteForTransactionDetail("apCode[]",r,"ajax-ap-employee.php?action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val(),n.updateDetail)},this.loadOnReady=function(){t.find("[name=selTermOfPayment]").change(),t.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,n.onChangeChk)}),t.find("[name=btnImport]").on("click",function(){n.importData()}),t.find("[name=btnAddPayment]").bind("click",function(){n.onCLickAddPayment()}),t.find("[name='chkPick-master']").val(1).change(),n.rebindEl()}}function ARAPEmployeeNetting(e,a){var n=this,t=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null,this.customerTax=0;var o=new Array;o.push({object:"hidDownpaymentKey[]",value:"pkey"}),o.push({object:"downpaymentAmount[]",value:"outstanding"});var o=new Array;o.push({object:"hidCostKey[]",value:"pkey"});var o=new Array;o.push({object:"hidARKey[]",value:"pkey"}),o.push({object:"refCode[]",value:"refcode"}),o.push({object:"arOutstanding[]",value:"outstanding"}),o.push({object:"arAmount[]",value:"outstanding"}),o.push({object:"arRefCode[]",value:"refcode"}),o.push({object:"arRefCode2[]",value:"refcode2"}),o.push({object:"arTransRefCode[]",value:"reftranscode2"}),o.push({object:"arCustomerName[]",value:"customername"});var r=o,o=new Array;o.push({object:"hidAPKey[]",value:"pkey"}),o.push({object:"refAPCode[]",value:"refcode"}),o.push({object:"apOutstanding[]",value:"outstanding"}),o.push({object:"apAmount[]",value:"outstanding"}),o.push({object:"apRefCode[]",value:"refcode"}),o.push({object:"apRefCode2[]",value:"refcode2"}),o.push({object:"apTransRefCode[]",value:"reftranscode2"}),o.push({object:"apCustomerName[]",value:"customername"});var l=o;this.resetDetails=function(){n.resetARDetails(),n.resetAPDetails()},this.resetARDetails=function(){clearAllRows(t.find(".mnv-ar")),n.calculateTotalAR()},this.resetAPDetails=function(){clearAllRows(t.find(".mnv-ap")),n.calculateTotalAP()},this.updateDetailAR=function(e,a,t){var o=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(t.item[a[i].value]=moment(t.item[a[i].value]).format(_DATE_FORMAT_)),o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).change().blur();o.find('[name="arCode[]"]').first().val(t.item.code),n.calculateTotalAR()},this.updateDetailAP=function(e,a,t){var o=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(t.item[a[i].value]=moment(t.item[a[i].value]).format(_DATE_FORMAT_)),o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).change().blur();o.find('[name="apCode[]"]').first().val(t.item.code),n.calculateTotalAP()},this.calculateTotal=function(){var e=0,a=0;e=parseFloat(unformatCurrency(t.find("[name='totalARAmount']").val())),a=parseFloat(unformatCurrency(t.find("[name='totalAPAmount']").val()));var n=e;t.find("[name='grandtotalARAmount']").val(n).blur();var i=a;t.find("[name='grandtotalAPAmount']").val(i).blur()},this.calculateTotalAR=function(){var e=0;t.find("[name='hidARKey[]']").each(function(){var a=$(this).closest(".div-table-row").find("[name='arAmount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}),t.find("[name='totalARAmount']").val(e).blur(),n.calculateTotal()},this.calculateTotalAP=function(){var e=0;t.find("[name='hidAPKey[]']").each(function(){var a=$(this).closest(".div-table-row").find("[name='apAmount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}),t.find("[name='totalAPAmount']").val(e).blur(),n.calculateTotal()},this.rebindAR=function(){bindEl(t.find("[name='arAmount[]']"),"change",function(){n.calculateTotalAR()}),bindAutoCompleteForTransactionDetail("arCode[]",r,"ajax-ar-employee.php?action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val(),n.updateDetailAR)},this.rebindAP=function(){bindEl(t.find("[name='apAmount[]']"),"change",function(){n.calculateTotalAP()}),bindAutoCompleteForTransactionDetail("apCode[]",l,"ajax-ap-employee.php?action=searchData&employeekey="+t.find("[name=hidEmployeeKey]").val(),n.updateDetailAP)},this.importDataAR=function(){n.activeAjaxConnections++;var e=1==t.find("[name=chkDatePeriod]").val()?!0:!1,a=t.find("[name=hidEmployeeKey]").val();if(a){var i="";if(e){var o=convertDateToStandartFormat(t.find("[name=trStartDate]").val()),r=convertDateToStandartFormat(t.find("[name=trEndDate]").val());i="&startdate="+o+"&enddate="+r}var l="action=searchData&employeekey="+a+i;$.ajax({type:"GET",url:"ajax-ar-employee.php",data:l}).done(function(e){var e=JSON.parse(e);if(0==e.length)addNewTemplateRow("ar-row-template");else{var a;for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidARKey",value:e[a].pkey}),i.push({selector:"arCode",value:e[a].code}),i.push({selector:"arRefCode",value:e[a].refcode}),i.push({selector:"arRefCode2",value:e[a].refcode2}),i.push({selector:"arOutstanding",value:e[a].outstanding}),i.push({selector:"arAmount",value:e[a].outstanding}),i.push({selector:"arTransRefCode",value:e[a].reftranscode2}),i.push({selector:"arCustomerName",value:e[a].customername}),addNewTemplateRow("ar-row-template",JSON.stringify(i))}n.rebindAR()}t.find(".inputnumber, .inputdecimal").blur(),n.calculateTotalAR(),decreaseActiveAjaxConnections(n)})}},this.importDataAP=function(){n.activeAjaxConnections++;var e=1==t.find("[name=chkDatePeriod]").val()?!0:!1,a=t.find("[name=hidEmployeeKey]").val();if(a){var i="";if(e){var o=convertDateToStandartFormat(t.find("[name=trStartDate]").val()),r=convertDateToStandartFormat(t.find("[name=trEndDate]").val());i="&startdate="+o+"&enddate="+r}var l="action=searchData&employeekey="+a+i;$.ajax({type:"GET",url:"ajax-ap-employee.php",data:l}).done(function(e){var e=JSON.parse(e);if(0==e.length)addNewTemplateRow("ap-row-template");else{var a;for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidAPKey",value:e[a].pkey}),i.push({selector:"apCode",value:e[a].code}),i.push({selector:"apRefCode",value:e[a].refcode}),i.push({selector:"apRefCode2",value:e[a].refcode2}),i.push({selector:"apOutstanding",value:e[a].outstanding}),i.push({selector:"apAmount",value:e[a].outstanding}),i.push({selector:"apTransRefCode",value:e[a].reftranscode2}),i.push({selector:"apCustomerName",value:e[a].customername}),addNewTemplateRow("ap-row-template",JSON.stringify(i))}n.rebindAP()}t.find(".inputnumber, .inputdecimal").blur(),n.calculateTotalAP(),decreaseActiveAjaxConnections(n)})}},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,n.resetDetails(),n.importDataAR(),n.importDataAP()},this.updateEmployeeInformation=function(e,a){var i=this;""!=t.find("[name=hidCurrentEmployeeKey]").val()?($("#dialog-message").html("Merubah karyawan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Karyawan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){t.find("[name=hidEmployeeKey]").val(t.find("[name=hidCurrentEmployeeKey]").val()),t.find("[name=employeeName]").val(t.find("[name=hidCurrentEmployeeName]").val()),$(i).closest("form").bootstrapValidator("revalidateField",$(i).attr("name")),n.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(i,"hidEmployeeKey"),t.find("[name=hidCurrentEmployeeKey]").val(""),t.find("[name=hidCurrentEmployeeName]").val("")):(t.find("[name=hidCurrentEmployeeKey]").val(a.item.pkey),t.find("[name=hidCurrentEmployeeName]").val(a.item.value)),n.rebindAR(),n.rebindAP())},this.afterRemoveRowHandler=function(){n.calculateTotalAR(),n.calculateTotalAP()},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=btnImport]").on("click",function(){n.importData()}),t.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=t.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),t.find("[name=chkDatePeriod]").change(),t.find("[name=selCurrency]").change(function(){n.updateCurrency()}),t.find(".arap-show-detail").on("click",function(){var e=$(this).closest(".arap-col").find(".options-row");e.css("display",e.is(":visible")?"none":"table");var a=$(this).attr("alt");$(this).attr("alt",$(this).html()),$(this).html(a)}),t.find(" [name=btnAddARRows]").on("click",function(){addNewTemplateRow("ar-row-template"),n.rebindAR()}),t.find(" [name=btnAddAPRows]").on("click",function(){addNewTemplateRow("ap-row-template"),n.rebindAP()}),n.calculateTotalAR(),n.calculateTotalAP(),this.rs||(addNewTemplateRow("ar-row-template"),addNewTemplateRow("ap-row-template")),n.rebindEl(),n.rebindAR(),n.rebindAP()}}function InvoicePeriod(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function RentalTimeSheet(e,a){var n=this,t=$("#"+e);this.tabObj=t;var o={},r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"priceInUnit[]",value:"sellingprice"}),r.push({object:"selUnit[]",value:"deftransunitkey"}),r.push({object:"selTimeUnit[]",value:"timeunitkey"}),r.push({object:"hidGramasi[]",value:"gramasi"});this.tabID=e,this.rs=a.length>0?a[0]:null,this.updateDetail=function(e,a,t){{var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first();o.find('[name="selUnit[]"]').first()}for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==t.item.weightunitkey&&(t.item[a[i].value]*=1e3),o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).blur();n.calculateDetail(r)},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),n=unformatCurrency(a.find("[name='workTime[]']").val()),t=unformatCurrency(a.find("[name='workHour[]']").val()),i=n-t;a.find("[name='overTime[]']").val(i).blur()},this.updateCustomerCity=function(e){e&&$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],t.find("[name=recipientCityName]").val(e.cityandcategoryname),t.find("[name=hidRecipientCityKey]").val(e.citykey)})},this.updateSOInformation=function(){$.ajax({type:"GET",url:"ajax-sales-order-rental.php",async:!1,data:"action=getDetailById&pkey="+t.find("[name=hidRefkey]").val()}).done(function(e){for(e=JSON.parse(e),i=0;i<e.length;i++){var a=e[i].pkey,n={};n.minimaltime=e[i].minimaltime,n.itemkey=e[i].itemkey,n.itemname=e[i].itemname,o[a]=n}var r={};for(i=0;i<e.length;i++)r[e[i].pkey]=e[i].label;var l=t.find("[name=selJODetailKey]");if(l.prop)var d=l.prop("options");else var d=l.attr("options");$("option",l).remove(),$.each(r,function(e,a){d[d.length]=new Option(a,e)}),l.find("option:eq(0)").prop("selected",!0).change(),console.log(o)})},this.updateSalesOrderInformation=function(){var e=t.find("[name=hidRefkey]").val();$.ajax({type:"GET",url:"ajax-sales-order-rental.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e=JSON.parse(e),e=e[0],t.find("[name=recipientName]").val(e.recipientname),t.find("[name=hidRecipientKey]").val(e.customerkey),t.find("[name=recipientEmail]").val(e.recipientemail),t.find("[name=recipientPhone]").val(e.recipientphone),t.find("[name=recipientAddress]").val(e.recipientaddress),n.updateCustomerCity(e.customerkey),n.updateSOInformation()})},this.updateTimeUnit=function(e){$(e).closest(".transaction-detail-row").find(".time-unit").html($(e).find("option:selected").text())},this.updateStartDate=function(e){var a=$(e).closest(".transaction-detail-row"),i=t.find("[name=hidWorkHour]").val(),o=a.find("[name='trStartDate[]']").val(),r=a.find("[name='trStartDate2[]']").val(),l=a.find("[name='trRestDate[]']").val(),d=a.find("[name='trEndDate[]']").val(),c="&startdate="+o+"&startdate2="+r+"&restdate="+l+"&enddate="+d;$.ajax({type:"GET",url:"ajax-sales-order-rental.php",async:!1,data:"action=getCalculateDate"+c}).done(function(e){if(e){if(0==e.length)return void alert(phpErrorMsg[213]);e=JSON.parse(e),e=e[0],a.find("[name='workTime[]']").val(e.worktime).blur(),i>0&&a.find("[name='workHour[]']").val(i).blur(),n.calculateDetail(a)}})},this.updateWorkHour=function(){var e=t.find("[name=selJODetailKey]").val();o[e].minimaltime&&t.find("[name=hidWorkHour]").val(o[e].minimaltime)},this.updateDate=function(e){var a="",n=$(e).closest(".transaction-detail-row"),t=n.find("[name='trStartDate[]']").val(),i=n.find("[name='trStartDate2[]']").val(),o=n.find("[name='trRestDate[]']").val(),r=n.find("[name='trRestDate2[]']").val(),l=n.find("[name='trEndDate[]']").val();a="&startdate="+t+"&startdate2="+i+"&restdate="+o+"&restdate2="+r+"&enddate="+l,$.ajax({type:"GET",url:"ajax-sales-order-rental.php",async:!1,data:"action=getCalculateDate"+a}).done(function(e){})},this.updateDatex=function(e){var a=$(e).closest(".transaction-detail-row"),n=a.find("[name='trStartDate[]']").val(),t=a.find("[name='trStartDate2[]']").val(),i=a.find("[name='trRestDate[]']").val(),o=a.find("[name='trRestDate2[]']").val(),r=a.find("[name='trEndDate[]']").val();dateParam="&startdate="+n+"&startdate2="+t+"&restdate="+i+"&restdate2="+o+"&enddate="+r,$.ajax({type:"GET",url:"ajax-sales-order-rental.php",data:"action=getCalculateDate"+dateParam,success:function(e){console.log(e)}})},this.afterRemoveRowHandler=function(){},this.rebindEl=function(){bindEl(t.find("[name='workTime[]'], [name='workHour[]']"),"change",function(){n.calculateDetail(this)}),t.find(".input-datetime").removeClass("hasDatepicker"),t.find(".input-datetime").removeAttr("id"),t.find(".input-datetime").datetimepicker({currentText:"Now",dateFormat:"dd / mm / yy",changeMonth:!0,changeYear:!0}),bindEl(t.find("[name='trEndDate[]']"),"change",function(){n.updateStartDate(this)})},this.loadOnReady=function(){t.find("[name=selJODetailKey]").change(function(){n.updateWorkHour()}),n.rebindEl()}}function ItemUploadReciept(e,a){var n=this,t=$("#"+e);this.tabID=e,this.closeTab=function(){selectedTab.newTab[0].remove(),$tabs.tabs("refresh");var e=findTabIndexByTitle(a.parentTitle);$tabs.tabs("option","active",e),updateData(!1,a.parentPanelId)},this.showCancelReason=function(){var e=$("[name=selStatus]").val();3!=e&&$("[name=selCancelReasonKey]").val(0)},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=selStatus] option:first").attr("disabled",!0),t.find("[name=selStatus]").change(function(){n.showCancelReason(this)}),n.rebindEl()}}function CancelReason(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function FAQ(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function Download(e,a){var n=this,t=$("#"+e);this.tabID=e;{var i=t.find("[name=hidId]").val();a.uploadImageFolder,a.arrImage?a.arrImage:Array(),a.arrPHPThumbHash?a.arrPHPThumbHash:Array(),a.uploadFileFolder,a.arrFile?a.arrFile:Array()}this.rebindEl=function(){},this.loadOnReady=function(){i?(createImageUploader({tabID:n.tabID,name:a.imageUploaderTarget},{folder:a.uploadImageFolder,token:i,arrImage:a.arrImage,phpThumbHash:a.arrPHPThumbHash},!1),createFileUploader(a.fileUploaderTarget,a.uploadFileFolder,i,a.arrFile,!1)):(createImageUploader({tabID:n.tabID,name:a.imageUploaderTarget},{folder:a.uploadImageFolder},!1),createFileUploader(a.fileUploaderTarget,a.uploadFileFolder,"","",!1)),t.find(".image-list ").sortable({placeholder:"sortable-placeholder",stop:function(){updateItemImageArray({tabID:n.tabID,name:a.imageUploaderTarget})}}),t.find(".image-list").disableSelection(),t.find(".file-list").sortable({placeholder:"sortable-placeholder",stop:function(){updateItemFileArray(a.fileUploaderTarget)}}),t.find(".file-list").disableSelection(),t.find("[name=chkExternal]").change(function(){1==$(this).val()?(t.find(".isexternal").show(),t.find(".isinternal").hide()):(t.find(".isexternal").hide(),t.find(".isinternal").show())}),t.find("[name=chkExternal]").change(),n.rebindEl()}}function ItemConversion(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function CareerField(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function CareerCategory(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function APCommission(e,a){var n=this,t=$("#"+e);this.tablekey=a.tablekey,this.tabID=e,this.updateCurrency=function(e){e=$(e);var n=t.find("[name=amount]"),i=t.find("[name=outstanding]");e.val()==a.CURRENCY.idr?(changeNumberDecimal(n,!0),changeNumberDecimal(i,!0)):(changeNumberDecimal(n,!1),changeNumberDecimal(i,!1)),n.blur(),i.blur()},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=selCurrency]").on("change",function(){n.updateCurrency(this)}),t.find("[name=selCurrency]").change()}}function APCommissionPayment(e,a,n){var t=this,o=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null,this.supplierTax=0,this.tablekey=n.tablekey;var r=new Array;r.push({object:"hidDownpaymentKey[]",value:"pkey"}),r.push({object:"downpaymentAmount[]",value:"outstanding"});var l=r,r=new Array;r.push({object:"hidCostKey[]",value:"pkey"});var d=r,r=new Array;r.push({object:"hidAPKey[]",value:"pkey"}),r.push({object:"refCode[]",value:"refcode"}),r.push({object:"refJOCode[]",value:"refcode2"}),r.push({object:"apAmount[]",value:"amount"}),r.push({object:"outstanding[]",value:"outstanding"}),r.push({object:"amount[]",value:"outstanding"});var c=r;this.resetDetails=function(){clearAllRows(o.find(".mnv-transaction")),clearAllRows(o.find(".mnv-downpayment")),addNewTemplateRow("downpayment-row-template"),t.rebindDownpayment(),t.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(n.item[a[i].value])).change().blur();t.find('[name="apCode[]"]').first().val(n.item.code)},this.checkDownpaymentExist=function(e){var a=!1;return o.find("[name='hidDownpaymentKey[]']").each(function(){return $(this).val()==e?void(a=!0):void 0}),a},this.updateDefaultDownpayment=function(){var e=new Array;o.find("[name='hidAPKey[]']").each(function(){$(this).val()&&e.push($(this).val())});var a=o.find("[name='selCurrency']").val();$.ajax({type:"GET",url:"ajax-supplier-downpayment.php",data:"action=getDownpaymentForAP&apkey="+JSON.stringify(e)+"&currencykey="+a,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++)if(!t.checkDownpaymentExist(e[a].pkey)){var n=[];n.push({selector:"downpaymentCode",value:e[a].code}),n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"downpaymentAmount",value:e[a].outstanding}),updateTemplateRow("downpayment-row-template",JSON.stringify(n))}t.rebindDownpayment(),o.find('[name="downpaymentAmount[]"]').change().blur(),t.calculateTotalDownpayment()}})},this.calculateTotalDownpayment=function(){var e=0;return o.find("[name='downpaymentAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalDownpayment']").val(e).blur(),e},this.calculateTotalCost=function(){var e=0;return o.find("[name='costAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalCost']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=0,n=0,i=0;o.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var t=$(this).closest(".div-table-row").find("[name='amount[]']"),i=$(this).closest(".div-table-row").find("[name='discount[]']"),o=$(this).closest(".div-table-row").find("[name='taxPPH[]']");e+=parseFloat(unformatCurrency(t.val()))||0,n+=parseFloat(unformatCurrency(i.val()))||0,a+=parseFloat(unformatCurrency(o.val()))||0}});var r=e+n;o.find("[name='totalPaid']").val(r).blur(),o.find("[name='totalDiscount']").val(n).blur(),o.find("[name='pph23']").val(a).blur();var l=t.calculateTotalDownpayment(),i=t.calculateTotalCost(),d=e-a-l+i;o.find("[name='total']").val(d).blur();var c=0;o.find("[name='paymentMethodValue[]']").each(function(){c+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(c).blur();var s=c-d;o.find("[name='balance']").val(s).blur()},this.rebindDownpayment=function(){var e=o.find("[name=hidSupplierKey]").val()||0;bindAutoCompleteForTransactionDetail("downpaymentCode[]",l,"ajax-supplier-downpayment.php?action=searchData&supplierkey="+e+"&currencykey="+o.find("[name=selCurrency]").val())},this.rebindCost=function(){bindAutoCompleteForTransactionDetail("costName[]",d,"ajax-cost-cash-out.php?action=searchData")},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0;var e=1==o.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var n=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),i=convertDateToStandartFormat(o.find("[name=trEndDate]").val());a="&startdate="+n+"&enddate="+i}var r="action=searchData&currencykey="+o.find("[name=selCurrency]").val()+"&supplierkey="+o.find("[name=hidSupplierKey]").val()+"&&warehousekey="+o.find("[name=selWarehouseKey]").val()+a;$.ajax({type:"GET",url:"ajax-ap-commission.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidAPKey",value:e[a].pkey}),n.push({selector:"apCode",value:e[a].code}),n.push({selector:"refCode",value:e[a].refcode}),n.push({selector:"refJOCode",value:e[a].refcode2}),n.push({selector:"apAmount",value:e[a].amount}),n.push({selector:"outstanding",value:e[a].outstanding}),n.push({selector:"amount",value:e[a].outstanding});var i=1==e[a].autotax&&t.supplierTax>0?e[a].amount*t.supplierTax/100:0;n.push({selector:"taxPPH",value:i}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}t.rebindEl(),o.find(".inputnumber").change().blur(),o.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(t),o.find("[name='chkPick-master']").val(1).change(),t.updateDefaultDownpayment()},error:function(){decreaseActiveAjaxConnections(t)}})},this.updateSupplierInformation=function(e,a){var n=this;""!=o.find("[name=hidCurrentSupplierKey]").val()?($("#dialog-message").html("Merubah pemasok akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pemasok",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){o.find("[name=hidSupplierKey]").val(o.find("[name=hidCurrentSupplierKey]").val()),o.find("[name=supplierName]").val(o.find("[name=hidCurrentSupplierName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),t.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),o.find("[name=hidCurrentSupplierKey]").val(""),o.find("[name=hidCurrentSupplierName]").val("")):(o.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),o.find("[name=hidCurrentSupplierName]").val(a.item.value)),t.resetDetails(),$(this).dialog("close")
},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),o.find("[name=hidCurrentSupplierKey]").val(""),o.find("[name=hidCurrentSupplierName]").val("")):(o.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),o.find("[name=hidCurrentSupplierName]").val(a.item.value)),t.rebindEl()),t.updateTax(),t.rebindDownpayment()},this.updateTax=function(){$.ajax({type:"GET",url:"ajax-supplier.php",async:!1,data:"action=getTaxInformation&pkey="+o.find("[name=hidSupplierKey]").val(),success:function(e){if(t.supplierTax=0,e){var e=JSON.parse(e);t.supplierTax=e.taxpercentage}}})},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pemasok ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.find("[name=hidCurrentCurrencyKey]").val(o.find("[name=selCurrency]").val()),t.resetDetails(),$(this).dialog("close")},Cancel:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeChk=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal(),t.rebindDownpayment(),t.rebindCost()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangeCurrency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='currencyRate']"),t=!1;e.val()==n.CURRENCY.idr&&(t=!0,a.val(1)),a.prop("readonly",t),o.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}})},this.rebindEl=function(){var e=o.find("[name='selCurrency']").val();bindEl(o.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,t.onChangeChk)}),bindEl(o.find("[name='discount[]'], [name='amount[]'], [name='taxPPH[]']"),"change",function(){t.calculateTotal()}),bindAutoCompleteForTransactionDetail("apCode[]",c,"ajax-ap-commission.php?action=searchData&supplierkey="+o.find("[name=hidSupplierKey]").val()+"&currencykey="+e+"&warehousekey="+o.find("[name=selWarehouseKey]").val(),t.updateDetail);var a=o.find(".mnv-downpayment");bindEl(a.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(t,a,"downpayment-row-template")}),bindEl(a.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(t,a,"downpayment-row-template")});var n=o.find(".mnv-cost");bindEl(n.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(t,n,"cost-row-template")}),bindEl(n.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(t,n,"cost-row-template")}),t.rebindDownpayment(),t.rebindCost()},this.loadOnReady=function(){o.find("[name=selTermOfPayment]").change(),o.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,t.onChangeChk)}),o.find("[name=btnImport]").on("click",function(){t.importData()}),o.find("[name=btnAddPayment]").bind("click",function(){t.onCLickAddPayment()}),o.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=o.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),o.find("[name=chkDatePeriod]").change(),o.find("[name=selCurrency]").change(function(){t.updateCurrency()}),o.find("[name=selWarehouseKey]").change(function(){t.rebindEl()}),o.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(o.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(o.find("[name=trEndDate]").val()));e>a&&o.find("[name=trEndDate]").val(o.find("[name=trStartDate]").val())}),o.find("[name=selCurrency]").change(function(){t.onChangeCurrency()}),o.find("[name='chkPick-master']").val(1).change(),addNewTemplateRow("downpayment-row-template"),addNewTemplateRow("cost-row-template"),t.rebindEl()}}function Recruitment(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-file-uploader",l=Array(),d=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(d){for($i=0;$i<n.length;$i++)l.push(n[$i].file);createFileUploader(r,o,d,l,!0)}else createFileUploader(r,o,"","",!0);multiLang(i),t.rebindEl()}}function Gallery(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!0)}else createImageUploader({tabID:e,name:r},{folder:o},!0);multiLang(i),t.rebindEl()}}function GalleryHumanResource(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!0)}else createImageUploader({tabID:e,name:r},{folder:o},!0);multiLang(i),t.rebindEl()}}function GalleryCategory(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function GalleryHRCategory(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);multiLang(i),t.rebindEl()}}function OfferSimulator(e,a){var n=this,t=$("#"+e);this.tabObj=t;var o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"priceInUnit[]",value:"sellingprice"}),o.push({object:"selUnit[]",value:"deftransunitkey"}),o.push({object:"hidGramasi[]",value:"gramasi"});var r=o;this.tabID=e,this.rs=a.length>0?a[0]:null,this.updateDetail=function(e,a,t){var o=$(e).closest(".transaction-detail-row"),r=o.find('[name="hidItemKey[]"]').first(),l=o.find('[name="selUnit[]"]').first();for(i=0;i<a.length;i++)"hidGramasi[]"==a[i].object&&2==t.item.weightunitkey&&(t.item[a[i].value]*=1e3),o.find("[name='"+a[i].object+"']").first().val(t.item[a[i].value]).blur();updateAvailableUnit(r,l),n.updateUnitPrice(l),o.find('[name="itemName[]"]').first().val(t.item.value),n.calculateDetail(r)},this.calculateDetail=function(e){var a=$(e).closest(".transaction-detail-row"),t=(a.find("[name='hidItemKey[]']").val(),unformatCurrency(a.find("[name='qty[]']").val())),i=unformatCurrency(a.find("[name='priceInUnit[]']").val()),o=a.find("[name='selUnit[]']"),r=(o.val(),parseFloat(o.find("option:selected").attr("relconversionmultiplier"))),l=parseFloat(a.find("[name='hidGramasi[]']").val()),d=t*i;a.find("[name='detailSubtotal[]']").val(d).blur(),a.find("[name='hidGramasiSubtotal[]']").val(l*t*r).blur(),n.calculateTotal()},this.calculateTotal=function(){var e=0;t.find("[name='detailSubtotal[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='total']").val(e).blur()},this.updateUnitPrice=function(e){var a=$(e).closest(".transaction-detail-row"),n=$(e).val(),t=a.find("[name='hidItemKey[]']").val();$.ajax({type:"GET",url:"ajax-item.php",async:!1,data:"action=getUnitSellingPrice&itemkey="+t+"&unitkey="+n}).done(function(e){e=JSON.parse(e),a.find("[name='priceInUnit[]']").val(e).blur()})},this.onChangePaymentMethodHandler=function(){n.calculateTotal()},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData",n.updateDetail),bindEl(t.find("[name='qty[]'], [name='priceInUnit[]']"),"change",function(){n.calculateDetail(this)}),bindEl(t.find("[name='selUnit[]']"),"change",function(){n.updateUnitPrice(this),n.calculateDetail(this)})},this.loadOnReady=function(){n.rebindEl()}}function NewsletterSubscription(e){var a=$("#"+e);this.tabID=e;a.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){}}function DiscountScheme(e,a){var n=this,t=$("#"+e),o=new Array;o.push({object:"hidItemKey[]",value:"pkey"}),o.push({object:"sellingPrice[]",value:"sellingprice"});var r=o;this.tabID=e,this.rs=a.length>0?a[0]:null,this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),n.activeAjaxConnections=0,$.ajax({type:"GET",url:"ajax-item.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e)),n.activeAjaxConnections++},data:"action=searchData&categorykey="+t.find("[name=selCategoryKey]").val()+"&getQOH=1&itemtype=1&warehousekey="+t.find("[name=selWarehouseKey]").val(),success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var i=[];i.push({selector:"hidItemKey",value:e[a].pkey}),i.push({selector:"itemName",value:e[a].value}),i.push({selector:"sellingPrice",value:e[a].sellingprice}),$newRow=addNewTemplateRow("detail-row-template",JSON.stringify(i))}n.rebindEl(),t.find(".inputnumber").change().blur(),decreaseActiveAjaxConnections(n)},error:function(){decreaseActiveAjaxConnections(n)}})},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).change().blur();if(""!=n.item.value){var o=t.find('[name="itemName[]"]').first();o.val(n.item.value)}},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("itemName[]",r,"ajax-item.php?action=searchData&itemtype=1",n.updateDetail)},this.loadOnReady=function(){t.find("[name=btnImport]").on("click",function(){var e=!1,a=t.find('[name="hidItemKey[]"]');a.each(function(){0!=$(this).val()&&""!=$(this).val()&&(e=!0)});var i=$(this);i.prop("disabled",!0),1==e?($("#dialog-message").html("Import data akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Import Data",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){},buttons:{OK:function(){n.importData(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):n.importData(),i.prop("disabled",!1)}),n.rebindEl()}}function MedicalRecord(e,a){var n=this,t=$("#"+e);this.tabID=e;var o=new Array;o.push({object:"hidEmployeeKey[]",value:"pkey"});var r=o;this.rs=a.length>0?a[0]:null;t.find("[name=hidId]").val();this.updateDetail=function(e,a,n){{var t=$(e).closest(".transaction-detail-row");t.find('[name="hidEmployeeKey[]"]').first()}for(i=0;i<a.length;i++)t.find("[name='"+a[i].object+"']").first().val(n.item[a[i].value]).blur();t.find('[name="employeeName[]"]').first().val(n.item.value)},this.updateCustomerInformation=function(){var e=t.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],t.find("[name=customerCode]").val(e.code),t.find("[name=address]").val(e.address),t.find("[name=medicineAllergy]").val(e.description))})},this.updateSalesMan=function(){var e=t.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getSalesman&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),0!=e.length&&(t.find("[name=hidEmployeeKey]").val(e.pkey),t.find("[name=employeeName]").val(e.name)))})},this.updateAgeCustomer=function(){var e=t.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-customer.php",async:!1,data:"action=getCustomersAge&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),0!=e.length&&t.find("[name=age]").val(e))})},this.rebindEl=function(){bindAutoCompleteForTransactionDetail("employeeName[]",r,"ajax-employee.php?action=searchData",n.updateDetail)},this.loadOnReady=function(){if(!n.rs){var e=addNewTemplateRow("medical-row-template",null,null,n.rebindEl);e.find(".input-datetime").removeClass("hasDatepicker"),e.find(".input-datetime").removeAttr("id"),e.find(".input-datetime").datetimepicker({currentText:"Now",dateFormat:"dd / mm / yy",changeMonth:!0,changeYear:!0})}t.find("[name=btnAddMedical]").on("click",function(){var e=addNewTemplateRow("medical-row-template",null,null,n.rebindEl);e.find(".input-datetime").removeClass("hasDatepicker"),e.find(".input-datetime").removeAttr("id"),e.find(".input-datetime").datetimepicker({currentText:"Now",dateFormat:"dd / mm / yy",changeMonth:!0,changeYear:!0})}),n.rebindEl()}}function EMKLInvoiceReceipt(e){var a=this,n=$("#"+e),t=new Array;t.push({object:"hidInvoiceKey[]",value:"pkey"}),t.push({object:"invoiceTotal[]",value:"grandtotal"}),t.push({object:"invoiceDate[]",value:"trdate",type:"date"});var i=t;this.tabID=e,this.updateDetail=function(e,n,t){var i=$(e).closest(".transaction-detail-row");a.updateRowInformation(i,n,t),a.calculateTotal()},this.calculateTotal=function(){var a=0;$("#"+e+" [name='chkPick[]']").not(":disabled").each(function(){1==$(this).val()&&(objAmount=$(this).closest(".div-table-row").find("[name='invoiceTotal[]']"),a+=parseFloat(unformatCurrency(objAmount.val()))||0)}),n.find("[name='grandTotal']").val(a).blur()},this.updateRowInformation=function(e,a,n){var t;for(t=0;t<a.length;t++)"date"==a[t].type&&(n.item[a[t].value]=moment(n.item[a[t].value]).format(_DATE_FORMAT_)),e.find("[name='"+a[t].object+"']").first().val(n.item[a[t].value]).change().blur();e.find("[name='invoiceCode[]']").first().val(n.item.value)},this.resetDetails=function(){clearAllRows($("#"+e)),a.calculateTotal()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),a.activeAjaxConnections=0;var t=n.find("[name=hidCustomerKey]").val();$.ajax({type:"GET",url:"ajax-emkl-order-invoice.php",beforeSend:function(){clearAllRows($("#defaultForm-"+e)),a.activeAjaxConnections++},data:"action=searchData&statuskey=2&customerkey="+t,success:function(e){var t,i,e=JSON.parse(e);for(t=0;t<e.length;t++){var o=[];o.push({selector:"hidInvoiceKey",value:e[t].pkey}),o.push({selector:"invoiceCode",value:e[t].code}),o.push({selector:"invoiceDate",value:moment(e[t].trdate).format(_DATE_FORMAT_)}),o.push({selector:"invoiceTotal",value:e[t].grandtotal}),i=addNewTemplateRow("detail-row-template",JSON.stringify(o))}a.rebindEl(),n.find(".inputnumber").change().blur(),n.find(".inputdecimal").change().blur(),a.calculateTotal(),decreaseActiveAjaxConnections(a),n.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(a)}})},this.onChangeChk=function(){a.calculateTotal()},this.updateCustomerInformation=function(e,t,i){var o=0;""!=n.find("[name=hidCurrentCustomerKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){n.find("[name=hidCustomerKey]").val(n.find("[name=hidCurrentCustomerKey]").val()),n.find("[name=customerName]").val(n.find("[name=hidCurrentCustomerName]").val()),$(e).closest("form").bootstrapValidator("revalidateField",$(e).attr("name")),a.rebindEl()},buttons:{OK:function(){null==i.item?(clearAutoCompleteInput(e,"hidCustomerKey"),n.find("[name=hidCurrentCustomerKey]").val(""),n.find("[name=hidCurrentCustomerName]").val("")):(n.find("[name=hidCurrentCustomerKey]").val(i.item.pkey),n.find("[name=hidCurrentCustomerName]").val(i.item.value),o=i.item.termofpaymentkey),a.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==i.item?(clearAutoCompleteInput(e,"hidCustomerKey"),n.find("[name=hidCurrentCustomerKey]").val(""),n.find("[name=hidCurrentCustomerName]").val("")):(n.find("[name=hidCurrentCustomerKey]").val(i.item.pkey),n.find("[name=hidCurrentCustomerName]").val(i.item.value),o=i.item.termofpaymentkey),a.rebindEl())},this.onChangePaymentMethodHandler=function(){a.calculateTotal()},this.afterRemoveRowHandler=function(){a.calculateTotal()},this.afterAddNewTemplateRowHandler=function(){},this.rebindEl=function(){var e=[];e.onSelectFunction="getTabObj().updateDetail";var t=n.find("[name=hidCustomerKey]").val();bindAutoCompleteForTransactionDetail("invoiceCode[]",i,"ajax-emkl-order-invoice.php?action=searchData&statuskey=2&customerkey="+t,e),bindEl(n.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,a.onChangeChk)})},this.loadOnReady=function(){n.find("[name=btnImport]").on("click",function(){a.importData()}),n.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,a.onChangeChk)}),n.find("[name='chkPick-master']").val(1).change(),a.rebindEl()}}function CustomerDownpaymentSettlement(e,a,n,t){var i=this,o=$("#"+e);this.tabID=e,this.tablekey=a,this.rs=n.length>0?n[0]:null,this.customerTax=0;var r=new Array;r.push({object:"hidCostKey[]",value:"pkey"});var l=r,r=new Array;r.push({object:"hidDownpaymentKey[]",value:"pkey"}),r.push({object:"dpCode[]",value:"code"}),r.push({object:"dpAmount[]",value:"amount"}),r.push({object:"outstanding[]",value:"outstanding"}),r.push({object:"amount[]",value:"outstanding"});var d=r;this.resetDetails=function(){clearAllRows(o.find(".mnv-transaction")),clearAllRows(o.find(".mnv-payment-method")),addNewTemplateRow("payment-method-row-template"),i.calculateTotal()},this.updateDPType=function(){var e=o.find("[name=selDPSettlementType]"),a=(o.find(".mnv-cost"),o.find(".mnv-payment-method")),n=o.find(".mnv-coa"),t=e.val();1==t?(a.show(),n.hide()):(a.hide(),n.show()),i.calculateTotal()},this.calculateTotalCOA=function(){var e=0,e=parseFloat(unformatCurrency(o.find("[name='subtotalCOA']").val()))||0;return o.find("[name='totalCOA']").val(e).blur(),e},this.calculateTotalCost=function(){var e=0;return o.find("[name='costAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalCost']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=0,n=o.find("[name=selDPSettlementType]").val();o.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var a=$(this).closest(".div-table-row").find("[name='amount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}});var t=e;o.find("[name='totalReceived']").val(t).blur();var a=i.calculateTotalCost(),r=e-a;o.find("[name='total']").val(r).blur();var l=0;o.find("[name='paymentMethodValue[]']").each(function(){l+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(l).blur();var d=i.calculateTotalCOA(),c=0;c=1==n?l-r:d-r,c=Math.round(100*c)/100,o.find("[name='balance']").val(c).blur()},this.rebindDownpaymentCode=function(){bindAutoCompleteForTransactionDetail("dpCode[]",d,"ajax-customer-downpayment.php?action=searchData&customerkey="+o.find("[name=hidCustomerKey]").val()+"&currencykey="+o.find("[name=selCurrency]").val(),i.updateDetail)},this.rebindCost=function(){bindAutoCompleteForTransactionDetail("costName[]",l,"ajax-cost-cash-out.php?action=searchData")},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),i.activeAjaxConnections=0;var e=1==o.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var n=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),t=convertDateToStandartFormat(o.find("[name=trEndDate]").val());a="&startdate="+n+"&enddate="+t}var r="action=searchData&currencykey="+o.find("[name=selCurrency]").val()+"&customerkey="+o.find("[name=hidCustomerKey]").val()+a;$.ajax({type:"GET",url:"ajax-customer-downpayment.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),i.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"dpCode",value:e[a].value}),n.push({selector:"dpAmount",value:e[a].amount}),n.push({selector:"outstanding",value:e[a].outstanding}),n.push({selector:"amount",value:e[a].outstanding}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}i.rebindEl(),o.find(".inputnumber").change().blur(),o.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(i),o.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(i)}})},this.updateCustomerInformation=function(e,a){var n=this;""!=o.find("[name=hidCurrentCustomerKey]").val()?($("#dialog-message").html("Merubah pelanggan akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Pelanggan",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){o.find("[name=hidCustomerKey]").val(o.find("[name=hidCurrentCustomerKey]").val()),o.find("[name=customerName]").val(o.find("[name=hidCurrentCustomerName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),i.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidCustomerKey"),o.find("[name=hidCurrentCustomerKey]").val(""),o.find("[name=hidCurrentCustomerName]").val("")):(o.find("[name=hidCurrentCustomerKey]").val(a.item.pkey),o.find("[name=hidCurrentCustomerName]").val(a.item.value)),i.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidCustomerKey"),o.find("[name=hidCurrentCustomerKey]").val(""),o.find("[name=hidCurrentCustomerName]").val("")):(o.find("[name=hidCurrentCustomerKey]").val(a.item.pkey),o.find("[name=hidCurrentCustomerName]").val(a.item.value)),i.rebindEl())},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pelanggan ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.find("[name=hidCurrentCurrencyKey]").val(o.find("[name=selCurrency]").val()),i.resetDetails(),$(this).dialog("close")},Cancel:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeChk=function(){i.calculateTotal()},this.onChangePaymentMethodHandler=function(){i.calculateTotal(),i.rebindCost()},this.afterRemoveRowHandler=function(){i.calculateTotal()},this.rebindEl=function(){bindEl(o.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,i.onChangeChk)}),bindEl(o.find(" [name='amount[]']"),"change",function(){i.calculateTotal()}),i.rebindDownpaymentCode();var e=o.find(".mnv-cost");bindEl(e.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(i,e,"cost-row-template")}),bindEl(e.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(i,e,"cost-row-template")});var a=o.find(".mnv-coa");bindEl(a.find("[name=subtotalCOA]"),"change",function(){i.calculateTotal()});var n=o.find(".mnv-payment-method");bindEl(n.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(i,n,"payment-method-row-template")}),bindEl(n.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(i,n,"payment-method-row-template")}),i.rebindCost()},this.onChangeCurrency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='currencyRate']"),n=!1;e.val()==t.CURRENCY.idr&&(n=!0,a.val(1)),a.prop("readonly",n),o.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}}),i.updateNumberDecimal()},this.updateNumberDecimal=function(){var e=o.find("[name='selCurrency']"),a=e.val()==t.CURRENCY.idr?!0:!1;changeNumberDecimal(o.find("[name='dpAmount[]'],[name='outstanding[]'],[name='amount[]'],[name='totalReceived'],[name='totalCost'],[name='costAmount[]'],[name='total'],[name='totalPayment'],[name='paymentMethodValue[]'] ,[name='balance']"),a)},this.loadOnReady=function(){i.updateNumberDecimal(),o.find("[name=selTermOfPayment]").change(),o.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,i.onChangeChk)}),o.find("[name=btnImport]").on("click",function(){i.importData()}),o.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=o.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),o.find("[name=chkDatePeriod]").change(),o.find("[name=selCurrency]").change(function(){i.updateCurrency()}),o.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(o.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(o.find("[name=trEndDate]").val()));e>a&&o.find("[name=trEndDate]").val(o.find("[name=trStartDate]").val())}),o.find("[name=selDPSettlementType]").change(function(){i.updateDPType()}),o.find("[name=selCurrency]").change(function(){i.onChangeCurrency()}),o.find("[name='chkPick-master']").val(1).change(),i.rebindEl()}}function SupplierDownpaymentSettlement(e,a,n,t){var i=this,o=$("#"+e);this.tabID=e,this.tablekey=a,this.rs=n.length>0?n[0]:null,this.customerTax=0;var r=new Array;r.push({object:"hidCostKey[]",value:"pkey"});var l=r,r=new Array;r.push({object:"hidDownpaymentKey[]",value:"pkey"}),r.push({object:"dpCode[]",value:"code"}),r.push({object:"dpAmount[]",value:"amount"}),r.push({object:"outstanding[]",value:"outstanding"}),r.push({object:"amount[]",value:"outstanding"});var d=r;this.resetDetails=function(){clearAllRows(o.find(".mnv-transaction")),clearAllRows(o.find(".mnv-payment-method")),addNewTemplateRow("payment-method-row-template"),i.rebindDownpaymentCode(),i.calculateTotal()},this.updateDPType=function(){var e=o.find("[name=selDPSettlementType]"),a=(o.find(".mnv-cost"),o.find(".mnv-payment-method")),n=o.find(".mnv-coa"),t=e.val();2==t?(a.hide(),n.show()):(a.show(),n.hide()),i.calculateTotal()},this.calculateTotalCOA=function(){var e=0,e=parseFloat(unformatCurrency(o.find("[name='subtotalCOA']").val()))||0;return o.find("[name='totalCOA']").val(e).blur(),e},this.calculateTotalCost=function(){var e=0;return o.find("[name='costAmount[]']").each(function(){e+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalCost']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=0,n=o.find("[name=selDPSettlementType]").val();o.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var a=$(this).closest(".div-table-row").find("[name='amount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}});var t=e;o.find("[name='totalReceived']").val(t).blur();var a=i.calculateTotalCost(),r=e-a;o.find("[name='total']").val(r).blur();var l=0;o.find("[name='paymentMethodValue[]']").each(function(){l+=parseFloat(unformatCurrency($(this).val()))||0}),o.find("[name='totalPayment']").val(l).blur();var d=i.calculateTotalCOA(),c=0;c=2==n?d-r:l-r,c=Math.round(100*c)/100,o.find("[name='balance']").val(c).blur()},this.rebindDownpaymentCode=function(){bindAutoCompleteForTransactionDetail("dpCode[]",d,"ajax-supplier-downpayment.php?action=searchData&supplierkey="+o.find("[name=hidSupplierKey]").val()+"&currencykey="+o.find("[name=selCurrency]").val(),i.updateDetail)},this.rebindCost=function(){bindAutoCompleteForTransactionDetail("costName[]",l,"ajax-cost-cash-out.php?action=searchData")},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),i.activeAjaxConnections=0;var e=1==o.find("[name=chkDatePeriod]").val()?!0:!1,a="";if(e){var n=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),t=convertDateToStandartFormat(o.find("[name=trEndDate]").val());a="&startdate="+n+"&enddate="+t}var r="action=searchData&currencykey="+o.find("[name=selCurrency]").val()+"&supplierkey="+o.find("[name=hidSupplierKey]").val()+a;$.ajax({type:"GET",url:"ajax-supplier-downpayment.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),i.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidDownpaymentKey",value:e[a].pkey}),n.push({selector:"dpCode",value:e[a].value}),n.push({selector:"dpAmount",value:e[a].amount}),n.push({selector:"outstanding",value:e[a].outstanding}),n.push({selector:"amount",value:e[a].outstanding}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}i.rebindEl(),o.find(".inputnumber").change().blur(),o.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(i),o.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(i)}})},this.updateSupplierInformation=function(e,a){var n=this;""!=o.find("[name=hidCurrentSupplierKey]").val()?($("#dialog-message").html("Merubah pemasok akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Supplier",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){o.find("[name=hidSupplierKey]").val(o.find("[name=hidCurrentSupplierKey]").val()),o.find("[name=supplierName]").val(o.find("[name=hidCurrentSupplierName]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),i.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),o.find("[name=hidCurrentSupplierKey]").val(""),o.find("[name=hidCurrentSupplierName]").val("")):(o.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),o.find("[name=hidCurrentSupplierName]").val(a.item.value)),i.resetDetails(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidSupplierKey"),o.find("[name=hidCurrentSupplierKey]").val(""),o.find("[name=hidCurrentSupplierName]").val("")):(o.find("[name=hidCurrentSupplierKey]").val(a.item.pkey),o.find("[name=hidCurrentSupplierName]").val(a.item.value)),i.rebindEl())},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pelanggan ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.find("[name=hidCurrentCurrencyKey]").val(o.find("[name=selCurrency]").val()),i.resetDetails(),$(this).dialog("close")},Cancel:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeChk=function(){i.calculateTotal()},this.onChangePaymentMethodHandler=function(){i.calculateTotal(),i.rebindCost()},this.afterRemoveRowHandler=function(){i.calculateTotal()},this.rebindEl=function(){bindEl(o.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,i.onChangeChk)
}),bindEl(o.find(" [name='amount[]']"),"change",function(){i.calculateTotal()}),i.rebindDownpaymentCode();var e=o.find(".mnv-cost");bindEl(e.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(i,e,"cost-row-template")}),bindEl(e.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(i,e,"cost-row-template")});var a=o.find(".mnv-coa");bindEl(a.find("[name=subtotalCOA]"),"change",function(){i.calculateTotal()});var n=o.find(".mnv-payment-method");bindEl(n.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(i,n,"payment-method-row-template")}),bindEl(n.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(i,n,"payment-method-row-template")}),i.rebindCost()},this.onChangeCurrency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='currencyRate']"),n=!1;e.val()==t.CURRENCY.idr&&(n=!0,a.val(1)),a.prop("readonly",n),o.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}}),i.updateNumberDecimal()},this.updateNumberDecimal=function(){var e=o.find("[name='selCurrency']"),a=e.val()==t.CURRENCY.idr?!0:!1;changeNumberDecimal(o.find("[name='dpAmount[]'],[name='outstanding[]'],[name='amount[]'],[name='totalReceived'],[name='totalCost'],[name='costAmount[]'],[name='total'],[name='totalPayment'],[name='paymentMethodValue[]'] ,[name='balance']"),a)},this.loadOnReady=function(){i.updateNumberDecimal(),o.find("[name=selTermOfPayment]").change(),o.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,i.onChangeChk)}),o.find("[name=btnImport]").on("click",function(){i.importData()}),o.find("[name=chkDatePeriod]").bind("change",function(){var e=1==$(this).val()?!0:!1,a=o.find("[name=trStartDate], [name=trEndDate]");a.removeClass("force-readonly"),a.datepicker(e?"enable":"disable"),e||a.addClass("force-readonly")}),o.find("[name=chkDatePeriod]").change(),o.find("[name=selCurrency]").change(function(){i.updateCurrency()}),o.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(o.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(o.find("[name=trEndDate]").val()));e>a&&o.find("[name=trEndDate]").val(o.find("[name=trStartDate]").val())}),o.find("[name=selDPSettlementType]").change(function(){i.updateDPType()}),o.find("[name=selCurrency]").change(function(){i.onChangeCurrency()}),o.find("[name='chkPick-master']").val(1).change(),i.rebindEl()}}function PrepaidExpense(e,a){var n=this,t=$("#"+e);this.tabID=e,this.updateCurrency=function(e){e=$(e);var n=t.find("[name=amount]"),i=t.find("[name=outstanding]");e.val()==a.CURRENCY.idr?(changeNumberDecimal(n,!0),changeNumberDecimal(i,!0)):(changeNumberDecimal(n,!1),changeNumberDecimal(i,!1)),n.blur(),i.blur()},this.updateAmount=function(){amountObj=t.find("[name=amount]");var e=Math.abs(unformatCurrency(amountObj.val()));amountObj.val(e).blur()},this.rebindEl=function(){},this.loadOnReady=function(){t.find("[name=selCurrency]").on("change",function(){n.updateCurrency(this)}),t.find("[name=selCurrency]").change()}}function CostReconsile(e,a,n){var t=this,o=$("#"+e);this.tabID=e,this.rs=a.length>0?a[0]:null;var r=new Array;r.push({object:"hidReconsileKey[]",value:"pkey"}),r.push({object:"refCode[]",value:"refcode"}),r.push({object:"hidServiceKey[]",value:"costkey"}),r.push({object:"serviceName[]",value:"servicename"}),r.push({object:"reconsileAmount[]",value:"amount"}),r.push({object:"outstanding[]",value:"outstanding"}),r.push({object:"amount[]",value:"outstanding"});var l=r;this.resetDetails=function(){clearAllRows(o.find(".mnv-transaction")),t.calculateTotal()},this.updateDetail=function(e,a,n){var t=$(e).closest(".transaction-detail-row");for(i=0;i<a.length;i++)"date"==a[i].type&&(n.item[a[i].value]=moment(n.item[a[i].value]).format(_DATE_FORMAT_)),t.find("[name='"+a[i].object+"']").first().val(decodeHTMLEntities(n.item[a[i].value])).change().blur();t.find('[name="reconsileCode[]"]').first().val(n.item.code)},this.calculateTotal=function(){var e=0;o.find("[name='chkPick[]']").not(":disabled").each(function(){if(1==$(this).val()){var a=$(this).closest(".div-table-row").find("[name='amount[]']");e+=parseFloat(unformatCurrency(a.val()))||0}});var a=e;o.find("[name='total']").val(a).blur()},this.importData=function(){loadOverlayScreen({content:_LOADING_TEMPLATE_}),t.activeAjaxConnections=0;var e=(o.find("[name=hidRefKey]").val()||0,1==o.find("[name=chkDatePeriod]").val()?!0:!1),a="";if(e){var n=convertDateToStandartFormat(o.find("[name=trStartDate]").val()),i=convertDateToStandartFormat(o.find("[name=trEndDate]").val());a="&startdate="+n+"&enddate="+i}var r="action=getCostReconsileByInvoice&currencykey="+o.find("[name=selCurrency]").val()+"&pkey="+o.find("[name=hidInvoiceKey]").val()+"&warehousekey="+o.find("[name=selWarehouseKey]").val()+a;$.ajax({type:"GET",url:"ajax-emkl-order-invoice.php",beforeSend:function(){clearAllRows(o.find(".mnv-transaction")),t.activeAjaxConnections++},data:r,success:function(e){var a,e=JSON.parse(e);for(a=0;a<e.length;a++){var n=[];n.push({selector:"hidReconsileKey",value:e[a].pkey}),n.push({selector:"reconsileCode",value:e[a].code}),n.push({selector:"refCode",value:e[a].refcode}),n.push({selector:"hidServiceKey",value:e[a].costkey}),n.push({selector:"serviceName",value:e[a].servicename}),n.push({selector:"reconsileAmount",value:e[a].amount}),n.push({selector:"outstanding",value:e[a].outstanding}),n.push({selector:"amount",value:e[a].outstanding}),addNewTemplateRow("detail-row-template",JSON.stringify(n))}t.rebindEl(),o.find(".inputnumber").change().blur(),o.find(".inputdecimal").change().blur(),decreaseActiveAjaxConnections(t),o.find("[name='chkPick-master']").val(1).change()},error:function(){decreaseActiveAjaxConnections(t)}})},this.updateInvoiceInformation=function(e,a){var n=this;""!=o.find("[name=hidCurrentInvoiceKey]").val()?($("#dialog-message").html("Merubah invoice akan mereset detail transaksi."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data Invoice",open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},close:function(){o.find("[name=hidInvoiceKey]").val(o.find("[name=hidCurrentInvoiceKey]").val()),o.find("[name=invoiceCode]").val(o.find("[name=hidCurrentInvoiceCode]").val()),$(n).closest("form").bootstrapValidator("revalidateField",$(n).attr("name")),t.rebindEl()},buttons:{OK:function(){null==a.item?(clearAutoCompleteInput(n,"hidInvoiceKey"),o.find("[name=hidCurrentInvoiceKey]").val(""),o.find("[name=hidCurrentInvoiceCode]").val("")):(o.find("[name=hidCurrentInvoiceKey]").val(a.item.pkey),o.find("[name=hidCurrentInvoiceCode]").val(a.item.value)),t.resetDetails(),t.updateDetailInvoiceInformation(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})):(null==a.item?(clearAutoCompleteInput(n,"hidInvoiceKey"),o.find("[name=hidCurrentInvoiceKey]").val(""),o.find("[name=hidCurrentInvoiceCode]").val("")):(o.find("[name=hidCurrentInvoiceKey]").val(a.item.pkey),o.find("[name=hidCurrentInvoiceCode]").val(a.item.value)),t.updateDetailInvoiceInformation(),t.rebindEl())},this.updateCurrency=function(){$("#dialog-message").html("Apakah Anda ingin mengganti mata uang untuk pemasok ini ?<br>Semua detail transaksi akan dihapus jika Anda mengganti mata uang."),$("#dialog-message").dialog({width:300,modal:!0,title:"Konfirmasi Perubahan Data mata uang",close:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val())},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:last").focus()},buttons:{OK:function(){o.find("[name=hidCurrentCurrencyKey]").val(o.find("[name=selCurrency]").val()),t.resetDetails(),$(this).dialog("close")},Cancel:function(){o.find("[name=selCurrency]").val(o.find("[name=hidCurrentCurrencyKey]").val()),$(this).dialog("close")}}})},this.onChangeChk=function(){t.calculateTotal()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.onChangeCurrency=function(){var e=o.find("[name='selCurrency']"),a=o.find("[name='currencyRate']"),i=!1;e.val()==n.CURRENCY.idr&&(i=!0,a.val(1)),a.prop("readonly",i),o.find(".active-currency").html(e.find("option:selected").text()),a.change().blur(),$.ajax({type:"GET",url:"ajax-currency-rate.php",data:"action=getLastRate&currencykey="+e.val(),beforeSend:function(){a.val(1)},success:function(e){if(e){var e=JSON.parse(e);a.val(e[0].rate).blur()}}}),t.updateNumberDecimal()},this.updateDetailInvoiceInformation=function(){var e=o.find("[name='hidInvoiceKey']").val();$.ajax({type:"GET",url:"ajax-emkl-order-invoice.php",data:"action=getItemDetailByHeader&invoicekey="+e,beforeSend:function(){o.find(".invoice-row").remove()},success:function(e){if(e){if(!e)return;var e=JSON.parse(e);if(e.length<=0)return;for($template=o.find(".invoice-row-template"),i=0;i<e.length;i++)$newRow=$template.clone().addClass("invoice-row").show().insertBefore($template.first()),$newRow.find(".qty").text(parseFloat(unformatCurrency(e[i].qtyinbaseunit))).formatCurrency({roundToDecimalPlace:2}),$newRow.find(".services").text(e[i].itemname),$newRow.find(".amount").text(parseFloat(unformatCurrency(e[i].total))).formatCurrency({roundToDecimalPlace:2})}}})},this.updateNumberDecimal=function(){var e=o.find("[name='selCurrency']"),a=e.val()==n.CURRENCY.idr?!0:!1;changeNumberDecimal(o.find("[name='reconsileAmount[]'],[name='outstanding[]'],[name='amount[]'],[name='total']"),a)},this.rebindEl=function(){var e=o.find("[name='selCurrency']").val(),a=o.find("[name='hidInvoiceKey']").val();bindEl(o.find("[name='dummychkPick[]']"),"change",function(){updateChkMaster(this,t.onChangeChk)}),bindEl(o.find("[name='amount[]']"),"change",function(){t.calculateTotal()}),bindAutoCompleteForTransactionDetail("reconsileCode[]",l,"ajax-prepaid-expense.php?action=searchData&invoicekey="+a+"&currencykey="+e+"&warehousekey="+o.find("[name=selWarehouseKey]").val(),t.updateDetail)},this.loadOnReady=function(){t.updateNumberDecimal(),o.find("[name=dummychkPick-master]").change(function(){updateChkPick(this,t.onChangeChk)}),o.find("[name=btnImport]").on("click",function(){t.importData()}),o.find("[name=selCurrency]").change(function(){t.updateCurrency()}),o.find("[name=selWarehouseKey]").change(function(){t.rebindEl()}),o.find("[name=trStartDate], [name=trEndDate]").bind("change",function(){var e=Date.parse(convertDateToStandartFormat(o.find("[name=trStartDate]").val())),a=Date.parse(convertDateToStandartFormat(o.find("[name=trEndDate]").val()));e>a&&o.find("[name=trEndDate]").val(o.find("[name=trStartDate]").val())}),o.find("[name=selCurrency]").change(function(){t.onChangeCurrency()}),o.find("[name='chkPick-master']").val(1).change(),t.rebindEl()}}function PointCashback(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function ContactCategory(e){var a=this,n=$("#"+e);this.tabID=e;n.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){multiLang(n),a.rebindEl()}}function MembershipSubscription(e,a,n){var t=this,o=$("#"+e);this.tabObj=o;var r=new Array;r.push({object:"hidItemKey[]",value:"pkey"}),r.push({object:"priceInUnit[]",value:"sellingprice"});this.tabID=e,this.rs=a.length>0?a[0]:null,this.calculateTotal=function(e){e||(e=!0);var a=parseFloat(unformatCurrency(o.find("[name='subtotal']").val()))||0,n=parseFloat(unformatCurrency(o.find("[name='finalDiscount']").val()))||0,t=parseInt(unformatCurrency(o.find("[name='selFinalDiscountType']").val()))||0,i=parseInt(unformatCurrency(o.find("[name='pointValue']").val()))||0,r=parseInt(unformatCurrency(o.find("[name='shipmentFee']").val()))||0,l=parseInt(unformatCurrency(o.find("[name='etcCost']").val()))||0,d=o.find("[name='chkIncludeTax']").val(),c=parseFloat(unformatCurrency(o.find("[name='taxPercentage']").val()))||0;0!=n&&2==t&&(n=n/100*a),a-=n,a-=i,o.find("[name='beforeTaxTotal']").val(a).blur();var s=0;0==d?(s=a*c/100,a+=s):(s=c/(100+c)*a,o.find("[name='beforeTaxTotal']").val(a-s).blur()),o.find("[name='taxValue']").val(s).blur();var u=a+r+l;o.find("[name='total']").val(u).blur();var m=parseInt(unformatCurrency(o.find("[name='totalPayment']").val())),f=m-u;o.find("[name='balance']").val(f).blur()},this.onChangePaymentMethodHandler=function(){t.calculateTotal()},this.afterRemoveRowHandler=function(){t.calculateTotal()},this.updatePointValue=function(){$.ajax({type:"GET",url:"ajax-point.php?action=getPointValue&point="+o.find("[name=point]").val(),success:function(e){e&&(o.find("[name='pointValue']").val(e).blur(),t.calculateTotal())},error:function(){}})},this.updatePrice=function(){$.ajax({type:"GET",url:"ajax-membership-subscription.php?action=getMembershipLevel&membershipLevelKey="+o.find("[name=selMembershipLevel]").val(),beforeSend:function(){},success:function(e){if(e){var e=JSON.parse(e),a=e[0].sellingprice?e[0].sellingprice:0;o.find("[name='subtotal']").val(a).blur(),t.calculateTotal()}},error:function(){}})},this.rebindEl=function(){bindEl(o.find("[name='qty[]'], [name='priceInUnit[]'], [name='discountValueInUnit[]']"),"change",function(){t.calculateTotal()}),bindEl(o.find("[name='selDiscountType[]']"),"change",function(){updateDecimal(this),t.calculateTotal()}),bindEl(o.find("[name='selMembershipLevel']"),"change",function(){t.updatePrice()}),bindEl(o.find("[name='point']"),"change",function(){t.updatePointValue()})},this.loadOnReady=function(){o.find("[name=selTermOfPaymentKey]").change(function(){for(i=0;i<n.length;i++)if($(this).val()==n[i])return o.find(".payment-detail-row.transaction-detail-row").find(".remove-button").each(function(){$(this).click()}),void o.find(".cashTOP").hide();o.find(".cashTOP").show()}),o.find("[name=selTermOfPaymentKey]").change(),o.find("[name=selFinalDiscountType], [name=finalDiscount], [name=beforeTaxTotal], [name=chkIncludeTax],[name=shipmentFee], [name=etcCost], [name=taxPercentage]").change(function(){t.calculateTotal()}),o.find("[name=selFinalDiscountType]").change(function(){updateFinalDiscountDecimal(this)}),t.rebindEl()}}function SalesOrderProperty(e,a){var n=this,t=$("#"+e);this.tabObj=t,this.rs=a.length>0?a[0]:null;var i=new Array;i.push({object:"hidDownpaymentKey[]",value:"pkey"}),i.push({object:"downpaymentAmount[]",value:"outstanding"});var o=i;this.tabID=e,this.calculateTotalDownpayment=function(){var e=0;return t.find("[name='downpaymentAmount[]']").each(function(){e+=parseInt(unformatCurrency($(this).val()))||0}),t.find("[name='totalDownpayment']").val(e).blur(),e},this.calculateTotal=function(){var e=0,a=parseFloat(unformatCurrency(t.find("[name='transactionTotal']").val()))||0,i=parseFloat(unformatCurrency(t.find("[name='bankTotal']").val()))||0,o=parseFloat(unformatCurrency(t.find("[name='closingFee']").val()))||0,r=parseFloat(unformatCurrency(t.find("[name='cashReward']").val()))||0,l=n.calculateTotalDownpayment(),d=parseFloat(unformatCurrency(t.find("[name='agencyPercentage']").val()))||0,c=parseFloat(unformatCurrency(t.find("[name='agentFeePercentage']").val()))||0,s=parseFloat(unformatCurrency(t.find("[name='officeFeePercentage']").val()))||0,u=parseFloat(unformatCurrency(t.find("[name='adminFeePercentage']").val()))||0,m=parseFloat(unformatCurrency(t.find("[name='taxFeePercentage']").val()))||0,f=parseFloat(unformatCurrency(t.find("[name='orLeadPercentage']").val()))||0,h=parseFloat(unformatCurrency(t.find("[name='bankProvisionPercentage']").val()))||0,p=parseFloat(unformatCurrency(t.find("[name='agentFeeBankPercentage']").val()))||0,v=parseFloat(unformatCurrency(t.find("[name='officeFeeBankPercentage']").val()))||0,y=a*d/100,b=a*f/100,g=y,C=g*s/100,w=g*c/100,D=i*h/100,k=D*v/100,T=D*p/100,$=C*m/100;e=w;var A=e*u/100,I=C+k+A+b,N=w+T+o+r;t.find("[name='agencyFee']").val(y).blur(),t.find("[name='officeFee']").val(C).blur(),t.find("[name='agentFee']").val(w).blur(),t.find("[name='bankProvision']").val(D).blur(),t.find("[name='officeFeeBank']").val(k).blur(),t.find("[name='agentFeeBank']").val(T).blur(),t.find("[name='totalCommissionCompany']").val(C).blur(),t.find("[name='totalBankProvisionCompany']").val(k).blur(),t.find("[name='totalCommissionAgent']").val(w).blur(),t.find("[name='totalBankProvisionAgent']").val(T).blur(),t.find("[name='adminFee']").val(A).blur(),t.find("[name='orLead']").val(b).blur(),t.find("[name='taxFee']").val($).blur(),t.find("[name='totalCompanyRevenue']").val(I).blur(),t.find("[name='totalAgentRevenue']").val(N).blur();var j=l>0?l-(y+b):0;t.find("[name='downpaymentSettlement']").val(j).blur();var R=a-l;t.find("[name='balance']").val(R).blur()},this.updatePercentageAgent=function(){var e=t.find("[name=hidEmployeeKey]").val();$.ajax({type:"GET",url:"ajax-employee.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],0!=e.length&&(t.find("[name=agentFeePercentage]").val(e.commissionpercentage).change().blur(),t.find("[name=agentFeeBankPercentage]").val(e.commissionpercentage).change().blur()))})},this.updatePercentageType=function(){var e=t.find("[name=selType]").val();$.ajax({type:"GET",url:"ajax-sales-order-property-type.php",async:!1,data:"action=getDataRowById&pkey="+e}).done(function(e){e&&(e=JSON.parse(e),e=e[0],0!=e.length&&t.find("[name=agencyPercentage]").val(e.percentagevalue).blur())})},this.afterRemoveRowHandler=function(){n.calculateTotal()},this.onChangeBuyer=function(){n.rebindDownpayment()},this.afterAddNewTemplateRowHandler=function(){n.rebindDownpayment()},this.rebindDownpayment=function(){var e=t.find("[name=hidBuyerKey]").val()||0;bindAutoCompleteForTransactionDetail("downpaymentCode[]",o,"ajax-customer-downpayment.php?action=searchData&customerkey="+e),t.find('[name="downpaymentAmount[]"]').bind("change",function(){n.calculateTotal()})},this.rebindEl=function(){var e=t.find(".mnv-downpayment");bindEl(e.find(".mnv-detail-field"),"change",function(){onChangePaymentMethodHandler(n,e,"downpayment-row-template")}),bindEl(e.find(".remove-button"),"click",function(){removeDetailRows(this),onChangePaymentMethodHandler(n,e,"downpayment-row-template")}),n.rebindDownpayment()},this.loadOnReady=function(){t.find("[name=transactionTotal], [name=agencyPercentage], [name=officeFeePercentage],[name=agentFeePercentage], [name=adminFeePercentage], [name=orLeadPercentage], [name=bankProvisionPercentage],[name=taxFeePercentage],[name=officeFeeBankPercentage],[name=officeFeeBank],[name=bankTotal],[name=agentFeeBankPercentage],[name=agentFeeBank],[name=totalCommissionCompany],[name=totalBankProvisionCompany],[name=totalCompanyRevenue],[name=totalCommissionAgent],[name=totalBankProvisionAgent],[name=closingFee],[name=cashReward],[name=totalAgentRevenue]").change(function(){n.calculateTotal(this)}),t.find("[name=selType]").change(function(){n.updatePercentageType()}),t.find("[name=officeFeePercentage]").change(function(){if($(this).attr("dont-change")&&1==$(this).attr("dont-change"))return void $(this).attr("dont-change",0);t.find("[name=agentFeePercentage]").attr("dont-change",1);var e=parseFloat(unformatCurrency($(this).val()))||0;e>100&&(e=100),0>e&&(e=0),t.find("[name=agentFeePercentage]").val(100-e).change().blur()}),t.find("[name=agentFeePercentage]").change(function(){if($(this).attr("dont-change")&&1==$(this).attr("dont-change"))return void $(this).attr("dont-change",0);t.find("[name=officeFeePercentage]").attr("dont-change",1);var e=parseFloat(unformatCurrency($(this).val()))||0;e>100&&(e=100),0>e&&(e=0),t.find("[name=officeFeePercentage]").val(100-e).change().blur()}),t.find("[name=officeFeeBankPercentage]").change(function(){if($(this).attr("dont-change")&&1==$(this).attr("dont-change"))return void $(this).attr("dont-change",0);t.find("[name=agentFeeBankPercentage]").attr("dont-change",1);var e=parseFloat(unformatCurrency($(this).val()))||0;e>100&&(e=100),0>e&&(e=0),t.find("[name=agentFeeBankPercentage]").val(100-e).change().blur()}),t.find("[name=agentFeeBankPercentage]").change(function(){if($(this).attr("dont-change")&&1==$(this).attr("dont-change"))return void $(this).attr("dont-change",0);t.find("[name=officeFeeBankPercentage]").attr("dont-change",1);var e=parseFloat(unformatCurrency($(this).val()))||0;e>100&&(e=100),0>e&&(e=0),t.find("[name=officeFeeBankPercentage]").val(100-e).change().blur()}),this.rs||t.find("[name=selType]").change(),0==t.find(".downpayment-row").length&&addNewTemplateRow("downpayment-row-template"),n.rebindEl()}}function SalesOrderPropertyType(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function BusinessCategory(e){var a=this,n=$("#"+e);this.tabID=e;n.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){multiLang(n),a.rebindEl()}}function CustomerFeatures(e){{var a=this;$("#"+e)}this.tabID=e,this.rebindEl=function(){},this.loadOnReady=function(){a.rebindEl()}}function MembershipLevel(e,a,n){var t=this,i=$("#"+e);this.tabID=e;var o=a,r="item-image-uploader",l=Array(),d=Array(),c=i.find("[name=hidId]").val();this.rebindEl=function(){},this.loadOnReady=function(){if(c){for($i=0;$i<n.length;$i++)l.push(n[$i].file),d.push(n[$i].phpthumbhash);createImageUploader({tabID:e,name:r},{folder:o,token:c,arrImage:l,phpThumbHash:d},!1)}else createImageUploader({tabID:e,name:r},{folder:o},!1);t.rebindEl()}}