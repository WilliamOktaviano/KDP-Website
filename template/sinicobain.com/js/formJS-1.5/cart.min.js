function Cart(e){var t=this,a=void 0!=e.errMsg?e.errMsg:new Array,n=void 0!=e.lang?e.lang:new Array,r=void 0!=e.shipmentService?e.shipmentService:new Array;DECIMAL=e.decimal,this.updateCartTotalSummary=function(){var e=parseFloat(unformatCurrency($(".mnv-cart-table-subtotal").text()))||0,t=parseFloat(unformatCurrency($("[name=shippingCost]").val()))||0,a=parseFloat(unformatCurrency($(".mnv-cart-discount").text()))||0,n=$(".mnv-cart-voucher-label").closest(".div-table-row").find("[name='hidVoucherKey[]']").val()||0,i=0;0!=n&&$.ajax({type:"POST",url:"/ajax-voucher-transaction.php",async:!1,beforeSend:function(){},data:{action:"calculateVoucherValue",voucherkey:n,totalsales:e},success:function(e){i=-1*parseFloat(e),$(".mnv-cart-voucher").text(i).formatCurrency({roundToDecimalPlace:DECIMAL})}});var r=e+a+i,o=.1*r;$(".mnv-cart-tax").text(o).formatCurrency({roundToDecimalPlace:DECIMAL});var c=r+o+t;$(".mnv-cart-total").text(c).formatCurrency({roundToDecimalPlace:DECIMAL})},this.updateCartListSummary=function(){var e=0,t="",a="",n="",i=0;$(".mnv-cart-table").find(".transaction-row").each(function(){i=parseFloat(unformatCurrency($(this).find("[name='qty[]']").val())),a=$(this).find(".mnv-item-name").text(),n=$(this).find(".mnv-unit").text(),e+=i,t+="<li>"+i+" "+n+" "+a+"</li>"}),t.length>0&&(t="<ul>"+t+"</ul>"),$(".summary-qty")||$(".summary-qty").text(e).formatCurrency({roundToDecimalPlace:DECIMAL}),$(".mnv-cart-total-sales").text($(".mnv-cart-table-subtotal").text()),$(".summary-description").html(t)},this.updateShipmentSummary=function(){$(".mnv-recipient-name").html("").hide(),$("[name=recipientName]").val()&&$(".mnv-recipient-name").text($("[name=recipientName]").val()).show(),$(".mnv-recipient-phone").html("").hide(),$("[name=recipientPhone]").val()&&$(".mnv-recipient-phone").text($("[name=recipientPhone]").val()).show(),$(".mnv-recipient-email").html("").hide(),$("[name=recipientEmail]").val()&&$(".mnv-recipient-email").text($("[name=recipientEmail]").val()).show(),$(".mnv-recipient-city").html("").hide(),$("[name=cityName]").val()&&$(".mnv-recipient-city").text($("[name=cityName]").val()).show(),$(".mnv-recipient-address").html("").hide(),$("[name=recipientAddress]").val()&&$(".mnv-recipient-address").html($("[name=recipientAddress]").val().replace(/\n/g,"<br />")).show(),$(".mnv-recipient-zipcode").html("").hide(),$("[name=recipientZipcode]").val()&&$(".mnv-recipient-zipcode").html($("[name=recipientZipcode]").val()).show();var e=1==$("[name=useInsurance]").val()?"("+n.insurance+")":"";$(".mnv-shipping").text($("[name=selShipmentService] option:selected").html()+e),$(".mnv-total-weight").text($("[name=totalWeight]").val()),$(".mnv-cart-shipping-cost").text($("[name=shippingCost]").val()),this.updateCartTotalSummary()},this.openNextAccordionPanel=function(e,t,a){t||(t="h2");var n=e.accordion("option","active"),i=n+1===e.find(t).length?0:n+1;e.accordion("option","active",i),a&&$("html, body").stop(!0,!1).animate({scrollTop:a})},this.updateShippingInformation=function(){$("#mnv-form-cart").find("[name=hidRecipientCityKey]").val();var e=$("#mnv-form-cart").find("[name=selShipmentService]").val(),n=$("#mnv-form-cart").find("[name=totalWeight]").val(),r=parseFloat(unformatCurrency($(".mnv-cart-table-subtotal").text())),o=$("#mnv-form-cart").find("[name=useInsurance]").val(),c=$("#mnv-form-cart").find("[name=hidLatLng]").val(),l=$("#mnv-form-cart").find("[name=recipientZipcode]").val(),m=[],s=$("#mnv-form-cart").find('[name="hidItemKey[]"]');s.each(function(){m.push($(this).val())});var u=[];$("#mnv-form-cart").find('[name="qty[]"]').each(function(){u.push($(this).val())}),totalItem=s.length;var p=c.split(","),d=[],v={latlng:{lat:p[0],lng:p[1]},zipcode:l};for(i=0;i<totalItem;i++)d.push({itemkey:m[i],qty:u[i]});if(""!=l.trim())return $.ajax({type:"POST",url:"/ajax-shipment.php",asyn:!0,beforeSend:function(){disableButton($("[name=btnSave]")),$("[name=shippingCost]").val("Updating....")},data:{action:"getShippingInformation",destination:v,serviceKey:e,weight:n,totalValue:r,useInsurance:o,items:d},success:function(e){$("[name=shippingCost]").val(0).blur(),disableButton($("[name=btnSave]"),!1),e&&(0!=(e=JSON.parse(e)).length?($("[name=shippingCost]").val(e.price).blur(),t.updateShipmentSummary()):alert(a.shipment[4]))}}),[];alert(a.zipcode[1])},this.recalculateShippingCost=function(){var e=0;$(".mnv-cart-table").find(".transaction-row").each(function(){e+=parseFloat(unformatCurrency($(this).find("[name='qty[]']").val()))*parseFloat(unformatCurrency($(this).find("[name='hidItemWeight[]']").val()))}),$("#mnv-form-cart").find("[name=totalWeight]").val(e/1e3).blur();t.updateShippingInformation()},this.recalculateCartTotal=function(e){e||(e=$(".mnv-cart-table"));var a=e.find(".mnv-cart-table-subtotal");subtotal=0,e.find(".transaction-row").each(function(){subtotal+=parseFloat(unformatCurrency($(this).find(".mnv-detail-subtotal").text()))}),a.text(subtotal).formatCurrency({roundToDecimalPlace:DECIMAL}),$(".mnv-cart-total-sales").text(subtotal).formatCurrency({roundToDecimalPlace:DECIMAL}),updateCartStatus(),t.recalculateShippingCost(),t.updateCartTotalSummary()},this.updateOrderQty=function(e){var a=$(e).closest(".transaction-row"),n=a.find("[name='hidItemKey[]']").val(),i=parseInt(unformatCurrency($(e).val())),r=parseFloat(unformatCurrency(a.find(".mnv-price").text()));$.ajax({type:"POST",url:"/ajax-cart.php",data:{action:"updateQty",itemkey:n,qty:i},success:function(e){a.find(".mnv-detail-subtotal").text(i*r).formatCurrency({roundToDecimalPlace:DECIMAL}),t.recalculateCartTotal()}})},this.updateQty=function(e){var t=parseInt($(e).attr("rel-ctr"))||0,a=$(e).closest(".transaction-row").find("[name='qty[]']"),n=parseInt(unformatCurrency(a.val()))||0;(n+=t)<=0&&(n=1),a.val(n).change().blur()},this.updateShipmentServices=function(){var e=r[$("[name=selCourier]").val()]||[];reInsertSelectBox($("[name=selShipmentService]"),e,{key:"servicekey",label:"servicename"}),1==e[0].needlocation?$(".dropoff-loc").show():$(".dropoff-loc").hide()},this.loadOnReady=function(){jQuery.ui.autocomplete.prototype._resizeMenu=function(){this.menu.element.outerWidth(this.element.outerWidth())},$(".mnv-cart-panel").accordion({heightStyle:"content",beforeActivate:function(e,t){t.newHeader.find(".summary").hide()},activate:function(e,a){switch(a.oldHeader.attr("relkey")){case"cartList":t.updateCartListSummary();break;case"shipment":t.updateShipmentSummary()}a.oldHeader.find(".summary").show()}}),$("[name=btnNext]").click(function(){t.openNextAccordionPanel($(".mnv-cart-panel"),"h2","+=200px")}),$("[name=selShipmentService],[name=recipientZipcode], [name=dummyuseInsurance]").change(function(){t.recalculateShippingCost()}),$("[name=selCourier]").change(function(){t.updateShipmentServices()}),$("[name='qty[]'").change(function(){t.updateOrderQty(this)}),$(".ctr-btn").click(function(){t.updateQty(this)}),$(".mnv-delete-cart-row, .mobile-delete-col").click(function(){$(this).closest(".transaction-row").remove();var e=$(this).closest(".transaction-row").find("[name='hidItemKey[]']").val();$.ajax({type:"POST",url:"/ajax-cart.php",data:{action:"delete",itemkey:e},success:function(e){t.recalculateCartTotal()}}),renumbering($(".row-number"))}),$(".choose-voucher").click(function(){var e=new Array;e.url="/popup-voucher.php",loadOverlayScreen(e)}),$("#mnv-form-cart").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{recipientName:{validators:{notEmpty:{message:a.name[1]}}},recipientPhone:{validators:{notEmpty:{message:a.phone[1]}}},recipientEmail:{validators:{notEmpty:{message:a.email[1]},emailAddress:{message:a.email[3]}}},recipientAddress:{validators:{notEmpty:{message:a.address[1]}}},recipientZipcode:{validators:{notEmpty:{message:a.zipcode[1]}}}}}).on("success.form.bv",function(e){$("[name=btnSave]").prop("disabled",!0).addClass("btn-primary-loading"),e.preventDefault();var t=$(e.target);t.data("bootstrapValidator");disableButton(t.find("[name=btnSave]")),$.post(t.attr("action"),t.serialize(),function(e){disableButton(t.find("[name=btnSave]"),!1),$("[name=btnSave]").removeClass("btn-primary-loading");var a="";for(i=0;i<e.length;i++)a=a+"<li>"+e[i].message+"</li>";""!=a&&(a='<ul class="message-dialog-ul">'+a+"</ul>");var n=t.find(".notification-msg");n.html(a).hide().fadeToggle("fast"),e[0].valid?(setStatusColorNotification(n,2),location.href="/payment-process/sales-order/"+e[0].data.pkey):(setStatusColorNotification(n,1),t.data("bootstrapValidator").resetForm(),scrollToTopForm(t),grecaptcha.reset())},"json")}),$("#mnv-form-cart").bind("keyup keypress",function(e){if(13==(e.keyCode||e.which)){if(!$(e.target).is("textarea"))return e.preventDefault(),!1}})}}