function Simulator(opt){var thisObj=this,errMsg=opt.errMsg,lang=opt.lang;DECIMAL=opt.decimal,DOMAIN_NAME=opt.domainName;var tabParam={},objAndValue=new Array;objAndValue.push({object:"hidItemKey[]",value:"pkey"}),objAndValue.push({object:"priceInUnit[]",value:"sellingprice"});var objAndValueForDetailAutoComplete=objAndValue;this.bindEl=function(t,e,n){t.unbind(e).on(e,n)},this.updateDetail=function(t,e,n){var a=$(t).closest(".transaction-detail-row"),o=a.find('[name="hidItemKey[]"]').first();for(i=0;i<e.length;i++)a.find("[name='"+e[i].object+"']").first().val(n.item[e[i].value]).blur(),a.find(".image-panel").css("background-image","url('/phpthumb/phpThumb.php?src=/../_upload/"+DOMAIN_NAME+"/item/"+n.item.pkey+"/"+n.item.file+"&w=200&h=200&hash="+n.item.phpThumbHash+"')");a.find('[name="itemName[]"]').first().val(n.item.value),thisObj.calculateDetail(o),thisObj.updateCartList()},this.calculateDetail=function(t){var e=$(t).closest(".transaction-detail-row"),n=(e.find("[name='hidItemKey[]']").val(),unformatCurrency(e.find("[name='qty[]']").val())),i=unformatCurrency(e.find("[name='priceInUnit[]']").val());e.find(".price-text").text("");var a=n*i;e.find("[name='detailSubtotal[]'], [name='detailSubtotalMobile[]']").val(a).blur(),0==i?e.find(".mobile-price").removeClass(".price-text"):e.find(".price-text").text(i).formatCurrency({roundToDecimalPlace:DECIMAL}),thisObj.calculateTotal()},this.calculateTotal=function(){var t=0;$("[name='detailSubtotal[]']").each(function(){t+=parseInt(unformatCurrency($(this).val()))||0});var e=t>=0?t:0;$("[name='total']").val(e).blur(),thisObj.updateCartList()},this.bindAutoCompleteForTransactionDetail=function bindAutoCompleteForTransactionDetail(targetObj,objAndValue,searchFile,handlingFunction){var objTarget=$("[name='"+targetObj+"']"),onSelectFunction="",onChangeFunction="";$.isArray(handlingFunction)?(onSelectFunction=handlingFunction.onSelectFunction,onChangeFunction=handlingFunction.onChangeFunction):onSelectFunction=handlingFunction,objTarget.autocomplete({source:searchFile,autoFocus:!0,minLength:1,open:function(t,e){$(this).attr("isbarcode")&&($(this).attr("isbarcode",0),$(this).data("ui-autocomplete").menu.element.children().first().click(),$(this).closest("div").next().find("input").focus())},select:function(event,ui){if(void 0!=onSelectFunction&&""!=onSelectFunction)"string"==jQuery.type(onSelectFunction)?eval(onSelectFunction+"(this,objAndValue,ui)"):onSelectFunction(this,objAndValue,ui),event.preventDefault();else{var tableRow=$(this).closest(".div-table-row");for(i=0;i<objAndValue.length;i++){var elObj=tableRow.find("[name='"+objAndValue[i].object+"']").first(),elVal=ui.item[objAndValue[i].value];"date"==objAndValue[i].type&&(elVal=moment(elVal).format(_DATE_FORMAT_)),elObj.val(elVal).change()}tableRow.find(".inputnumber, .inputdecimal, .inputautodecimal").blur()}},search:function(t,e){},change:function(event,ui){var nextInput=$(this).closest("div").next().find("input"),chkPick=$(this).closest(".div-table-row").find("[name='chkPick[]']");if(null==ui.item){for(chkPick.prop("checked",!1),i=0;i<objAndValue.length;i++)$(this).closest(".div-table-row").find("[name='"+objAndValue[i].object+"']").first().val("").blur();$(this).val("").change()}else chkPick.prop("checked",!0);chkPick.change(),void 0!=onChangeFunction&&""!=onChangeFunction&&eval(onChangeFunction+"(this,objAndValue,ui)"),nextInput.focus()}})},this.updateCartList=function(){$.ajax({type:"POST",async:!1,url:"/ajax-simulator.php",data:$("#defaultForm").serialize()+"&action=updateCartList",success:function(t){}})},this.onUpdateQtyMobile=function(t){$(t).closest(".transaction-detail-row").find("[name='qty[]']").val($(t).val()).change()},this.rebindEl=function(){thisObj.bindEl($(".transaction-detail-row").find(" [name='qty[]'], [name='priceInUnit[]']"),"change",function(){thisObj.calculateDetail(this)}),thisObj.bindEl($(".transaction-detail-row").find(" [name='qtyMobile[]']"),"change",function(){thisObj.onUpdateQtyMobile(this)})},this.loadOnReady=function(){jQuery.ui.autocomplete.prototype._resizeMenu=function(){this.menu.element.outerWidth(this.element.outerWidth())};thisObj.bindEl($(".remove-button, .mobile-remove-button"),"click",function(){removeDetailRows(this),thisObj.calculateTotal()}),addNewTemplateRow("detail-row-template",null,null,thisObj.rebindEl),$("#defaultForm").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{name:{validators:{notEmpty:{message:errMsg.name[1]}}}}}).on("success.form.bv",function(t){$("[name=btnSave]").prop("disabled",!0).addClass("btn-primary-loading"),t.preventDefault();var e=$(t.target);e.data("bootstrapValidator");disableButton(e.find("[name=btnSave]")),$.post(e.attr("action"),e.serialize(),function(t){disableButton(e.find("[name=btnSave]"),!1),$("[name=btnSave]").removeClass("btn-primary-loading");var n="";for(i=0;i<t.length;i++)n=n+"<li>"+t[i].message+"</li>";""!=n&&(n='<ul class="message-dialog-ul">'+n+"</ul>"),$(".notification-msg").html(n).hide().fadeToggle("fast"),t[0].valid?($(".notification-msg").removeClass("bg-red-cardinal").addClass("bg-green-avocado"),alert(t[0].message),location.href="/simulator-list"):($(".notification-msg").removeClass("bg-green-avocado").addClass("bg-red-cardinal"),e.data("bootstrapValidator").resetForm(),scrollToTopForm(e))},"json")})}}